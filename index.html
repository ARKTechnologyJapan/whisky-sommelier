<!DOCTYPE html>
<!-- saved from url=(0128)https://gensparkpublicblob.blob.core.windows.net/user-upload-image/page/tooluse_NJ8ntK10Sn-xOpBtw-o5FQ/index_complete_fixed.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¼ã®æœˆã€‚AIã‚½ãƒ ãƒªã‚¨</title>
    <link href="./index_files/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./index_files/all.min.css">
    <script src="./index_files/chart.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></script>
    <!-- Leaflet.jsåœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <link rel="stylesheet" href="./index_files/leaflet.css" crossorigin="">
    <script src="./index_files/leaflet.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" crossorigin=""></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Noto Sans JP', sans-serif;
        }
        .header-container {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo {
            width: 50px;
            height: 50px;
            position: absolute;
            left: 20px;
            object-fit: contain;
            border-radius: 8px;
            background: rgba(78, 205, 197, 0);
            border: 2px solid #4ecdc500;
            padding: 5px;
        }
        
        .header-title {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }
        .container-custom {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px 20px;
        }
        .taste-matrix {
            width: 300px;
            height: 300px;
            border: 2px solid #fff;
            position: relative;
            background: linear-gradient(to right, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%), 
                        linear-gradient(to top, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%);
        }
        .taste-dot {
            width: 16px;
            height: 16px;
            background-color: #ff6b6b;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        .dual-matrix-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 20px;
        }
        .matrix-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .matrix-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #4ecdc4;
        }
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }
        .whisky-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .whisky-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: #4ecdc4;
            transform: translateY(-2px);
        }
        .whisky-card.selected {
            background: rgba(78, 205, 196, 0.15);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        .whisky-card.featured {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 215, 0, 0.10));
            border: 2px solid #FFA500;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.4);
            animation: pulse-orange 2s infinite;
        }
        @keyframes pulse-orange {
            0% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.6); }
            100% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.4); }
        }
        .featured-label {
            position: absolute;
            top: -10px;
            right: 10px;
            background: linear-gradient(45deg, #FFA500, #FFD700);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .loading {
            display: none;
            text-align: center;
            color: #4ecdc4;
        }
        .progress-container {
            display: none;
            margin-top: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.3s ease;
        }
        .progress-text {
            color: #4ecdc4;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .progress-percentage {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        .success {
            color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        .price-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            margin: 10px 0;
        }
        .price-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
        }
        .price-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
            border: none;
        }
        .voice-input-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .voice-input-btn:hover {
            background: rgba(78, 205, 196, 0.3);
        }
        .voice-input-btn.recording {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .split-layout {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å‡ç­‰ã«åˆ†å‰²ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ */
            gap: 20px;
            align-items: start;
        }
        
        .recommendations-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .chart-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 120px;
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(78, 205, 196, 0.5) rgba(255, 255, 255, 0.1);
        }
        
        .chart-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .chart-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .chart-panel::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 4px;
        }
        
        .chart-container {
            height: 500px;
            width: 100%;
            position: relative;
        }
        .chart-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #4ecdc4;
            font-size: 16px;
        }
        .chart-canvas {
            height: 400px !important;
            width: 100% !important;
        }
        #combinedProfileChart {
            height: 400px !important;
            width: 100% !important;
        }
        .recommendation-summary {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            color: #4ecdc4;
        }
        
        .custom-footer {
            display: none;
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 40px;
        }
        
        .whisky-overview {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(255, 107, 107, 0.1));
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .whisky-overview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .whisky-overview h2 {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .whisky-overview .subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            margin-bottom: 15px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .whisky-overview .description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            z-index: 1;
        }
        
        .whisky-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            position: relative;
            z-index: 1;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }
        
        .taste-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            fill: #4ecdc4;
        }

        .chat-section {
            margin-top: 30px;
        }

        .chat-examples {
            background: rgba(78, 205, 196, 0.05);
            border: 1px solid rgba(78, 205, 196, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .question-example {
            display: block;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 6px;
            color: #4ecdc4;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question-example:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateY(-1px);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
        }

        .chat-history {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 14px;
        }

        .ai-message {
            background: rgba(78, 205, 196, 0.15);
            border-left: 3px solid #4ecdc4;
            color: #fff;
        }

        .user-message {
            background: rgba(255, 107, 107, 0.15);
            border-left: 3px solid #ff6b6b;
            color: #fff;
        }

        .chat-history::-webkit-scrollbar {
            width: 6px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 3px;
        }
        
        @media (max-width: 1024px) {
            .split-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chart-panel {
                position: static;
            }
            
            .whisky-overview h2 {
                font-size: 2rem;
            }
            
            .whisky-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .dual-matrix-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .custom-footer {
                display: block;
            }
            
            .whisky-overview h2 {
                font-size: 1.8rem;
            }
            
            .whisky-overview .subtitle {
                font-size: 1rem;
            }
            
            .whisky-overview .description {
                font-size: 1rem;
            }
        }
        
        .recommendations-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .recommendations-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .recommendations-panel::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 4px;
        }
        
        .recommendations-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.7);
        }

        /* æ–°è¦è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« - è’¸ç•™æ‰€ãƒãƒƒãƒ—ã¨æƒ…å ±ãƒ‘ãƒãƒ« */
        .distillery-section {
            margin-top: 20px;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.8s ease, height 0.8s ease;
        }

        .distillery-section.active {
            opacity: 1;
            height: auto;
        }

        .distillery-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-container {
            height: 350px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(78, 205, 196, 0.4);
            background-color: #1a1a1a;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 100%;
        }

        #distilleryMap {
            height: 100%;
            width: 100%;
            background-color: #2a2a2a;
        }

        .distillery-info {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 12px;
            padding: 16px;
            color: #fff;
        }

        .distillery-info h3 {
            color: #4ecdc4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(78, 205, 196, 0.3);
            padding-bottom: 8px;
        }

        .distillery-info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            margin-top: 15px;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }

        .info-value {
            color: rgba(255, 255, 255, 0.9);
        }

        .distillery-description {
            margin-top: 15px;
            line-height: 1.6;
        }

        .status-active {
            color: #4ecdc4;
            font-weight: bold;
        }

        .status-closed {
            color: #ff6b6b;
            font-weight: bold;
        }

        .status-unknown {
            color: #ffb347;
            font-weight: bold;
        }

        /* Leafletãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .leaflet-container {
            background-color: #f0f0f0 !important;
        }
        .leaflet-tile-pane {
            opacity: 0.9;
        }
        .leaflet-popup-content-wrapper {
            background-color: rgba(40, 44, 52, 0.95) !important;
            color: #fff !important;
            border: 1px solid rgba(78, 205, 196, 0.5);
        }
        .leaflet-popup-tip {
            background-color: rgba(40, 44, 52, 0.95) !important;
        }
        .leaflet-control-zoom a {
            background-color: rgba(40, 44, 52, 0.8) !important;
            color: #fff !important;
            border-color: rgba(78, 205, 196, 0.3) !important;
        }
        .leaflet-control-zoom a:hover {
            background-color: rgba(78, 205, 196, 0.3) !important;
        }

        /* å›ºå®šé«˜ã•ã‚³ãƒ³ãƒ†ãƒŠ */
        .fixed-height-container {
            min-height: 400px;
            position: relative;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’å›ºå®šä½ç½®ã« */
        .progress-container {
            position: relative;
            margin: 20px 0;
            height: 60px;  /* å›ºå®šé«˜ã• */
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ */
        .nav-links {
            position: absolute;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 6px;
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .nav-link:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: rgba(78, 205, 196, 0.4);
            border-color: rgba(78, 205, 196, 0.6);
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }
    </style>
<style>
    .genspark-notice-dialog {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10001;
      align-items: center;
      justify-content: center;
    }

    .genspark-notice-content {
      background-color: white;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      box-sizing: border-box;
      padding: 10px 30px 30px 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      font-size: 16px;
    }

    .genspark-notice-title {
      color: #000;
      font-family: Arial;
      font-size: 20px;
      font-style: normal;
      font-weight: 700;
      line-height: 150%; 
    }

    .genspark-notice-list {
      margin: 24px 0;
      
      color: #606366;
      font-family: Arial;
      font-size: 14px;
      font-style: normal;
      font-weight: 400;
      line-height: 150%;
      padding-left: 12px;
    }

    .genspark-notice-list li {
      margin-bottom: 12px;
      list-style-type: disc;
    }

    .genspark-notice-list li a {
      color: #606366;
      text-decoration: underline;
    }

    .genspark-notice-checkbox {
      display: flex;
      align-items: center;
      margin-top: 20px;
      gap: 10px;

      color: #232425;

      font-family: Arial;
      font-size: 14px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
    }

    .genspark-notice-actions {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
      
    .genspark-notice-ok {
      color: #232425;

      text-align: center;
      font-family: Arial;
      font-size: 16px;
      font-style: normal;
      font-weight: 700;
      line-height: 150%; 

      cursor: pointer;
      display: flex;
      height: 40px;
      padding: 6px 14px;
      justify-content: center;
      align-items: center;
      gap: 10px;
      align-self: stretch;
      border-radius: 8px;
      border: 1px solid #000;
      box-sizing: border-box;
      width: 100%;
    }
  </style></head>
<body>
    <div class="header-container">
        <img class="logo" src="./index_files/NH_bar_logo_fin_white.png" alt="æ˜¼ã®æœˆãƒãƒ¼ãƒ­ã‚´">
        <h1 class="header-title">æ˜¼ã®æœˆã€‚AIã‚½ãƒ ãƒªã‚¨</h1>
        <div class="nav-links">
            <a href="index.html" class="nav-link active" id="homeLink">ğŸ  AIã‚½ãƒ ãƒªã‚¨</a>
            <a href="whisky_list.html" class="nav-link" id="listLink">ğŸ¥ƒ ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ä¸€è¦§</a>
        </div>
    </div>
    
    <div class="container-custom">
        <div class="whisky-overview">
            <h2>ğŸ· ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div class="subtitle">æœ¬æ—¥ã¯å³é¸ã•ã‚ŒãŸ<span id="whiskyCount">6</span>æœ¬ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‹ã‚‰</div>
            <div class="description">
                <strong>ã‚ãªãŸã®å‘³è¦šã«å®Œç’§ã«ãƒãƒƒãƒã™ã‚‹</strong>æœ€é«˜ã®ä¸€æœ¬ã‚’<br>
                AIæŠ€è¡“ã§åˆ†æãƒ»ææ¡ˆã„ãŸã—ã¾ã™
            </div>
            <div class="whisky-stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalWhiskies">6</span>
                    <div class="stat-label">å³é¸éŠ˜æŸ„</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="uniqueRegions">4</span>
                    <div class="stat-label">ç”£åœ°</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number">AI</span>
                    <div class="stat-label">åˆ†ææŠ€è¡“</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">
                ğŸ’ ä¾¡æ ¼å¸¯è¨­å®š
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block mb-2">ä¸‹é™ä¾¡æ ¼: <span id="minPriceDisplay">Â¥5,000</span></label>
                    <input type="range" id="minPrice" class="price-slider" min="1" max="80" value="5" step="1">
                </div>
                <div>
                    <label class="block mb-2">ä¸Šé™ä¾¡æ ¼: <span id="maxPriceDisplay">Â¥50,000</span></label>
                    <input type="range" id="maxPrice" class="price-slider" min="1" max="80" value="50" step="1">
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">
                ğŸ‘… å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
            </h2>
            <p class="mb-6">2ã¤ã®å››è§’å†…ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã‚Œãã‚Œã®å¥½ã¿ã®ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            
            <div class="dual-matrix-container">
                <div class="matrix-wrapper">
                    <div class="matrix-title">ğŸ¥ƒ åŸºæœ¬çš„ãªå‘³ã®å‚¾å‘</div>
                    <div class="relative">
                        <div class="taste-matrix" id="tasteMatrix1">
                            <div class="taste-dot" id="tasteDot1" style="left: 56.7614%; top: 66.2121%;"></div>
                        </div>
                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-sm">ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼</div>
                        <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-sm">ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼</div>
                        <div class="absolute -left-12 top-1/2 transform -translate-y-1/2 text-sm">ãƒ©ã‚¤ãƒˆ</div>
                        <div class="absolute -right-12 top-1/2 transform -translate-y-1/2 text-sm">ãƒ˜ãƒ“ãƒ¼</div>
                    </div>
                    <div class="text-center mt-4">
                        <span id="coordinates1" class="text-xs text-gray-400">åº§æ¨™: X: 0.57, Y: 0.66</span>
                    </div>
                </div>
                
                <div class="matrix-wrapper">
                    <div class="matrix-title">ğŸ¯ è¤‡é›‘ã•ã®å¥½ã¿</div>
                    <div class="relative">
                        <div class="taste-matrix" id="tasteMatrix2">
                            <div class="taste-dot" id="tasteDot2" style="left: 22.7282%; top: 62.5455%;"></div>
                        </div>
                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-sm">ã¾ã‚ã‚„ã‹</div>
                        <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-sm">å¼·çƒˆ</div>
                        <div class="absolute -left-12 top-1/2 transform -translate-y-1/2 text-sm">è‹¥ã„</div>
                        <div class="absolute -right-12 top-1/2 transform -translate-y-1/2 text-sm">ç†Ÿæˆ</div>
                    </div>
                    <div class="text-center mt-4">
                        <span id="coordinates2" class="text-xs text-gray-400">åº§æ¨™: X: 0.23, Y: 0.63</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card chat-section">
            <h2 class="text-2xl font-bold mb-4">
                ğŸ¤– AIã‚½ãƒ ãƒªã‚¨ã¨ãƒãƒ£ãƒƒãƒˆï¼ˆä½•åº¦ã§ã‚‚ãŠæ°—è»½ã«ï¼ï¼‰
            </h2>
            
            <div class="chat-examples">
                <div class="mb-3 text-sm text-gray-300">è³ªå•ä¾‹ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ï¼‰ï¼š</div>
                <div class="question-example" data-question="ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼ˆæœ€é«˜é¡80,400å††ï¼‰ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦">ğŸ’ ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼ˆæœ€é«˜é¡80,400å††ï¼‰ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦</div>
                <div class="question-example" data-question="3000å††ä»¥ä¸‹ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¢ã‚¤ãƒ©å³¶ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¯ã‚ã‚‹ï¼Ÿ">ğŸŒŠ 3000å††ä»¥ä¸‹ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¢ã‚¤ãƒ©å³¶ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¯ã‚ã‚‹ï¼Ÿ</div>
                <div class="question-example" data-question="æ—¥æœ¬ã®è»½äº•æ²¢ã‚„é•·æ¿±ãªã©ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã¦">ğŸ¯ æ—¥æœ¬ã®è»½äº•æ²¢ã‚„é•·æ¿±ãªã©ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã¦</div>
                <div class="question-example" data-question="5000å††å‰å¾Œã§complexity5ç‚¹ã®è¤‡é›‘ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ãŠã™ã™ã‚ã¯ï¼Ÿ">â­ 5000å††å‰å¾Œã§complexity5ç‚¹ã®è¤‡é›‘ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ãŠã™ã™ã‚ã¯ï¼Ÿ</div>
            </div>

            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
                <button id="voiceInputBtn" class="voice-input-btn">
                    ğŸ¤
                </button>
                <button id="sendChatBtn" class="btn-primary">ğŸ’¬ è³ªå•ã™ã‚‹</button>
            </div>

            <div id="chatHistory" class="chat-history" style="display: none;"></div>
        </div>
        
        <div class="text-center mb-8">
            <button id="getRecommendation" class="btn-primary text-lg mr-4">ğŸ¯ AIã‚¦ã‚£ã‚¹ã‚­ãƒ¼ææ¡ˆã‚’å—ã‘ã‚‹</button>
            <button id="refreshRecommendation" class="btn-secondary text-lg">
                ğŸ”„ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦å†ææ¡ˆ
            </button>
        </div>
        
        <div id="fixedHeightContainer" class="fixed-height-container" style="display: none;">
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="animate-spin text-4xl mb-4">ğŸ¥ƒ</div>
                <p class="mt-2">AIãŒæœ€é©ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’åˆ†æä¸­...</p>
            </div>
            
            <div id="progressContainer" class="progress-container" style="display: none;">
                <div id="progressText" class="progress-text">æœ€é©åŒ–å‡¦ç†ä¸­...</div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 100%;"></div>
                </div>
                <div id="progressPercentage" class="progress-percentage">100%</div>
            </div>
        </div>
        
        <div id="splitLayoutContainer" style="display: grid;" class="split-layout">
            <div class="recommendations-panel">
                <h2 class="text-2xl font-bold mb-4">
                    ğŸ¯ AIææ¡ˆçµæœ
                </h2>
                <div id="preferencesSummary" class="recommendation-summary" style="display: block;">
                <h3 class="text-lg font-bold mb-3">ğŸ¯ ã‚ãªãŸã®å¥½ã¿ã®å‚¾å‘</h3>
                <div class="space-y-2 text-sm">
                    <div><strong>åŸºæœ¬çš„ãªå‘³ã®å‚¾å‘:</strong> <span id="tasteDescription">ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªå‘³ã‚ã„ã‚’å¥½ã‚€</span></div>
                    <div><strong>è¤‡é›‘ã•ã®å¥½ã¿:</strong> <span id="complexityDescription">è‹¥ã„ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã§ä¸­ç¨‹åº¦ã®è¤‡é›‘ã•ã‚’å¥½ã‚€</span></div>
                    <div><strong>ä¾¡æ ¼å¸¯:</strong> <span id="priceRangeDescription">Â¥5,000 - Â¥50,000</span></div>
            
                    <div class="mt-3 pt-2 border-t border-gray-600">
                        ã“ã®ç·åˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ã„ã¦ã€æœ€é©ãªéŠ˜æŸ„ã‚’å³é¸ã—ã¾ã—ãŸã€‚
                    </div>
                </div>
            </div>
                <div id="recommendationContent"><div class="whisky-card featured"><div class="featured-label">â­ æœ€ã‚‚ãŠã™ã™ã‚</div><h3 class="text-xl font-bold mb-2">è»½äº•æ²¢25å¹´</h3><div class="flex justify-between items-center mb-2">
                    <span class="text-lg font-semibold text-green-400">Â¥25,000</span>
                    <span class="text-sm bg-blue-600 px-2 py-1 rounded">Japan</span>
                </div><p class="text-sm text-gray-300 mb-2">Japanese Whisky</p><p class="text-sm mb-3">æ—¥æœ¬ã®ç¹Šç´°ã•ã¨æœå®Ÿã®è±Šã‹ã•ãŒè¦‹äº‹ã«èª¿å’Œã—ãŸå¸Œå°‘ãªé€¸å“ã€‚è¤‡é›‘ã§æ·±ã„å‘³ã‚ã„ã€‚æŸ‘æ©˜ç³»ã®æŸ”ã‚‰ã‹ãªé¦™ã‚Šã‹ã‚‰å§‹ã¾ã‚Šã€ç†Ÿã—ãŸæ´‹æ¢¨ã€æ¡ƒã€èœ‚èœœã®ç”˜ã•ã¸ã¨å¤‰åŒ–ã—ã¦ã„ãã¾ã™ã€‚å£ã«å«ã‚€ã¨ã€å¾®å¦™ãªã‚¹ãƒ‘ã‚¤ã‚¹ã€ã‚µãƒ³ãƒ€ãƒ«ã‚¦ãƒƒãƒ‰ã€ãƒãƒ‹...</p><div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">é©åˆåº¦: 70%</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full">
                        <div class="h-full bg-gradient-to-r from-red-500 to-green-500 rounded-full" style="width: 70%"></div>
                    </div>
                </div></div><div class="whisky-card selected"><h3 class="text-xl font-bold mb-2">ãƒœã‚¦ãƒ¢ã‚¢26å¹´ãƒ€ãƒ³ã‚«ãƒ³ãƒ†ã‚¤ãƒ©ãƒ¼</h3><div class="flex justify-between items-center mb-2">
                    <span class="text-lg font-semibold text-green-400">Â¥15,000</span>
                    <span class="text-sm bg-blue-600 px-2 py-1 rounded">Scotland, Islay</span>
                </div><p class="text-sm text-gray-300 mb-2">Single Malt Scotch Whisky</p><p class="text-sm mb-3">ä¼èª¬çš„ãªãƒœãƒˆãƒ©ãƒ¼ã€ãƒ€ãƒ³ã‚«ãƒ³ãƒ»ãƒ†ã‚¤ãƒ©ãƒ¼ã«ã‚ˆã£ã¦ãƒœãƒˆãƒªãƒ³ã‚°ã•ã‚ŒãŸã“ã®ãƒœã‚¦ãƒ¢ã‚¢26å¹´ã¯ã€ã‚¢ã‚¤ãƒ©å³¶ã®ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªãƒ”ãƒ¼ãƒˆæ„Ÿã¨æ´—ç·´ã•ã‚ŒãŸè¤‡é›‘ã•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ãƒãƒ‹ãƒ©ã‚¯ãƒªãƒ¼ãƒ ã€ç†Ÿã—ãŸæ¡ƒã€æŸ‘æ©˜é¡ã®å±¤ã®ä¸‹ã«ã€å„ªã—ããƒãƒ©...</p><div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">é©åˆåº¦: 70%</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full">
                        <div class="h-full bg-gradient-to-r from-red-500 to-green-500 rounded-full" style="width: 70%"></div>
                    </div>
                </div></div><div class="whisky-card"><h3 class="text-xl font-bold mb-2">ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³ 25å¹´ one of only bottles</h3><div class="flex justify-between items-center mb-2">
                    <span class="text-lg font-semibold text-green-400">Â¥20,400</span>
                    <span class="text-sm bg-blue-600 px-2 py-1 rounded">Scotland, Islay</span>
                </div><p class="text-sm text-gray-300 mb-2">Single Malt Scotch Whisky</p><p class="text-sm mb-3">ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³25å¹´ã¯å¸Œå°‘ã§é«˜ãè©•ä¾¡ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ©ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€å¼·ã„æµ·æ´‹æ€§ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ã€‚è¤‡é›‘ãªæ³¥ç‚­ã®ç…™ã€æµ·å¡©ã€ãƒ¨ãƒ¼ãƒ‰ã®å±¤ãŒæŸ‘æ©˜é¡ã®çš®ã€ãƒãƒ‹ãƒ©ã€å¾®å¦™ãªãƒˆãƒ­ãƒ”ã‚«ãƒ«ãƒ•ãƒ«ãƒ¼ãƒ„ã¨ãƒãƒ©ãƒ³ã‚¹ã‚ˆãèª¿å’Œã—ã¦ã„ã¾ã™ã€‚é•·ã„...</p><div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">é©åˆåº¦: 65%</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full">
                        <div class="h-full bg-gradient-to-r from-red-500 to-green-500 rounded-full" style="width: 65%"></div>
                    </div>
                </div></div></div>
                <div class="text-center mt-6">
                    <button id="getAnotherRecommendation" class="btn-secondary">
                        ğŸ”„ åˆ¥ã®ææ¡ˆ
                    </button>
                </div>
            </div>
            
            <div class="chart-panel">
                <h2 class="text-2xl font-bold mb-4">
                    ğŸ“Š å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ¯”è¼ƒ
                </h2>
                <div class="chart-container">
                    <h3 id="chartTitle">ã‚ãªãŸã®å¥½ã¿ vs ãƒœã‚¦ãƒ¢ã‚¢26å¹´ãƒ€ãƒ³ã‚«ãƒ³ãƒ†ã‚¤ãƒ©ãƒ¼</h3>
                    <canvas id="combinedProfileChart" class="chart-canvas" style="box-sizing: border-box; display: block; height: 500px; width: 519px;" width="571" height="550"></canvas>
                </div>
                <div class="text-center mt-4">
                    <p class="text-sm text-gray-400">ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®éŠ˜æŸ„ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚ãªãŸã®å¥½ã¿ã¨é‡ã­ã¦è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
                
                <!-- è’¸ç•™æ‰€ãƒãƒƒãƒ—ã¨æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div id="distillerySection" class="distillery-section active">
                    <h2 class="text-xl font-bold mb-3 text-center">
                        ğŸŒ è’¸ç•™æ‰€æƒ…å ±
                    </h2>
                    <div class="distillery-container">
                        <div class="map-container">
                            <div id="distilleryMap" class="leaflet-container leaflet-touch leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0" style="position: relative; background-color: rgb(51, 51, 51);"><div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);"><div class="leaflet-pane leaflet-tile-pane"><div class="leaflet-layer " style="z-index: 1; opacity: 0.8;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 19; transform: translate3d(0px, 0px, 0px) scale(1);"><img alt="" src="./index_files/4@2x.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-141px, -214px, 0px); opacity: 1;"></div></div></div><div class="leaflet-pane leaflet-overlay-pane"></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-marker-pane"></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(1933.06px, 1237.54px, 0px) scale(8);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="https://gensparkpublicblob.blob.core.windows.net/user-upload-image/page/tooluse_NJ8ntK10Sn-xOpBtw-o5FQ/index_complete_fixed.html#" title="Zoom in" role="button" aria-label="Zoom in" aria-disabled="false"><span aria-hidden="true">+</span></a><a class="leaflet-control-zoom-out" href="https://gensparkpublicblob.blob.core.windows.net/user-upload-image/page/tooluse_NJ8ntK10Sn-xOpBtw-o5FQ/index_complete_fixed.html#" title="Zoom out" role="button" aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true">âˆ’</span></a></div><div class="leaflet-control-attribution leaflet-control"><a href="https://leafletjs.com/" title="A JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a> <span aria-hidden="true">|</span> Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors Â© <a href="https://carto.com/attributions">CARTO</a></div></div></div></div>
                        </div>
                        
                        <div class="distillery-info" id="distilleryInfo">
                            <h3 id="distilleryName">ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ , Islay</h3>
                            <div class="distillery-info-grid" id="distilleryDetails"><div class="info-label">ç”£åœ°:</div><div class="info-value">Scotland, Islay</div><div class="info-label">ã‚¿ã‚¤ãƒ—:</div><div class="info-value">Single Malt Scotch Whisky</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="custom-footer">
            Powered by Nebula Hirozon Technology
        </div>
    </div>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let whiskyData = [];
        let distilleryDatabase = {};
        let distilleryMarkers = {};
        let distilleryMap = null;
        let profileChartInstance = null;
        let isRecording = false;
        let recognition = null;
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.onload = function() {
            // å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚ã‚¯ãƒªã‚¢
            sessionStorage.removeItem('lastWhiskyRecommendation');
            localStorage.removeItem('chatHistory');
            
            // ãƒšãƒ¼ã‚¸ã®åˆæœŸçŠ¶æ…‹ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            initializePageState();
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’è¨­å®š
            setActiveNavLinks();
            
            // å…±é€šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadCommonData();
        };
        
        // ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–é–¢æ•°
        function initializePageState() {
            // æ¨è–¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç©ºã«ã™ã‚‹
            const recommendationContent = document.getElementById('recommendationContent');
            if (recommendationContent) {
                recommendationContent.innerHTML = '';
            }
            
            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®åˆæœŸåŒ–
            if (typeof profileChartInstance !== 'undefined' && profileChartInstance) {
                profileChartInstance.destroy();
                profileChartInstance = null;
            }
            
            // ãƒãƒ£ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            const chartTitle = document.getElementById('chartTitle');
            if (chartTitle) {
                chartTitle.textContent = 'ã‚ãªãŸã®å¥½ã¿';
            }
            
            // å¥½ã¿ã®ã‚µãƒãƒªãƒ¼ã‚’ã‚¯ãƒªã‚¢
            const preferencesSummary = document.getElementById('preferencesSummary');
            if (preferencesSummary) {
                preferencesSummary.style.display = 'none';
            }
            
            // å››è±¡é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
            initializeTasteMatrix();
            
            // ä¾¡æ ¼ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–
            const minPriceSlider = document.getElementById('minPrice');
            const maxPriceSlider = document.getElementById('maxPrice');
            if (minPriceSlider) minPriceSlider.value = 5;
            if (maxPriceSlider) maxPriceSlider.value = 50;
            updatePriceDisplay();
            
            // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢
            const chatHistory = document.getElementById('chatHistory');
            if (chatHistory) {
                chatHistory.innerHTML = '';
                chatHistory.style.display = 'none';
            }
            
            // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.value = '';
            }
            
            // å›ºå®šé«˜ã•ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
            const fixedHeightContainer = document.getElementById('fixedHeightContainer');
            if (fixedHeightContainer) {
                fixedHeightContainer.style.display = 'none';
            }
            
            // ã‚¹ãƒ—ãƒªãƒƒãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’éè¡¨ç¤º
            const splitLayoutContainer = document.getElementById('splitLayoutContainer');
            if (splitLayoutContainer) {
                splitLayoutContainer.style.display = 'none';
            }
        }

        // å››è±¡é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
        function initializeTasteMatrix() {
            // åˆæœŸä½ç½®ã‚’ä¸­å¤®ã«è¨­å®šï¼ˆ50%, 50%ï¼‰
            document.getElementById('tasteDot1').style.left = '50%';
            document.getElementById('tasteDot1').style.top = '50%';
            document.getElementById('tasteDot2').style.left = '50%';
            document.getElementById('tasteDot2').style.top = '50%';
            
            // åº§æ¨™è¡¨ç¤ºã‚‚æ›´æ–°
            updateCoordinatesDisplay(1, 0.5, 0.5);
            updateCoordinatesDisplay(2, 0.5, 0.5);
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            const matrix1 = document.getElementById('tasteMatrix1');
            const matrix2 = document.getElementById('tasteMatrix2');
            
            matrix1.addEventListener('click', function(e) {
                handleMatrixClick(e, 1);
            });
            
            matrix2.addEventListener('click', function(e) {
                handleMatrixClick(e, 2);
            });
        }

        // å…±é€šãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        async function loadCommonData() {
            try {
                // è’¸æºœæ‰€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                await loadDistilleryData();
                
                // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                await loadWhiskyData();
                
                // ãƒãƒƒãƒ—ã®åˆæœŸåŒ–
                initializeCommonMap();
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
                setupEventListeners();
                
                console.log('Common data loaded successfully');
            } catch (err) {
                console.error('Error loading common data:', err);
            }
        }
        
        // è’¸æºœæ‰€ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        async function loadDistilleryData() {
            try {
                // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’fetchã—ã¦èª­ã¿è¾¼ã¿
                const response = await fetch('distillery_data.json');
                if (response.ok) {
                    const data = await response.json();
                    distilleryDatabase = data.distilleries;
                    console.log('Distillery data loaded successfully:', distilleryDatabase);
                    return distilleryDatabase;
                } else {
                    throw new Error('Failed to fetch distillery data');
                }
            } catch (err) {
                console.warn('Error loading distillery data:', err);
                return getDefaultDistilleryData();
            }
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        async function loadWhiskyData() {
            try {
                // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’fetchã—ã¦èª­ã¿è¾¼ã¿
                const response = await fetch('whisky_data.json');
                if (response.ok) {
                    const data = await response.json();
                    whiskyData = data.whiskies;
                    
                    // UIã‚’æ›´æ–°
                    updateWhiskyCountDisplay();
                    
                    console.log('Whisky data loaded successfully:', whiskyData);
                    return whiskyData;
                } else {
                    throw new Error('Failed to fetch whisky data');
                }
            } catch (err) {
                console.warn('Error loading whisky data:', err);
                whiskyData = getDefaultWhiskyData();
                updateWhiskyCountDisplay();
                return whiskyData;
            }
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®UIã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã‚’æ›´æ–°
        function updateWhiskyCountDisplay() {
            if (whiskyData && whiskyData.length > 0) {
                document.getElementById('whiskyCount').textContent = whiskyData.length;
                document.getElementById('totalWhiskies').textContent = whiskyData.length;
                
                // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªç”£åœ°ã®æ•°ã‚’é›†è¨ˆ
                const uniqueRegions = new Set();
                whiskyData.forEach(whisky => {
                    if (whisky.region) {
                        uniqueRegions.add(whisky.region);
                    }
                });
                document.getElementById('uniqueRegions').textContent = uniqueRegions.size;
            }
        }
        
        // ãƒãƒƒãƒ—åˆæœŸåŒ–å…±é€šé–¢æ•°
        function initializeCommonMap() {
            const mapElement = document.getElementById('distilleryMap');
            if (!mapElement) return;
            
            // ã‚ˆã‚Šæ˜ã‚‹ã„ãƒ¢ãƒãƒˆãƒ¼ãƒ³åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«
            const mapStyle = {
                tiles: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                maxZoom: 19
            };
            
            // Leafletãƒãƒƒãƒ—ã®åˆæœŸåŒ–
            distilleryMap = L.map('distilleryMap', {
                center: [55.0, -3.0],  // ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ä¸­å¿ƒ
                zoom: 6,
                zoomControl: false
            });
            
            // ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ãªã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼
            L.tileLayer(mapStyle.tiles, {
                attribution: mapStyle.attribution,
                maxZoom: mapStyle.maxZoom,
                opacity: 0.8  // å°‘ã—é€éã•ã›ã¦èƒŒæ™¯è‰²ã¨èª¿å’Œ
            }).addTo(distilleryMap);
            
            // ãƒãƒƒãƒ—ã®èƒŒæ™¯è‰²ã‚’èª¿æ•´
            document.querySelector('.leaflet-container').style.backgroundColor = '#333';
            
            // ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å³ä¸‹ã«çµ±ä¸€
            L.control.zoom({
                position: 'bottomright'
            }).addTo(distilleryMap);
            
            // ã‚µã‚¤ã‚ºã‚’æ›´æ–°
            setTimeout(() => {
                distilleryMap.invalidateSize();
            }, 100);
        }
        
        // ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
        function handleMatrixClick(e, matrixNumber) {
            const matrix = e.currentTarget;
            const rect = matrix.getBoundingClientRect();
            const dot = document.getElementById(`tasteDot${matrixNumber}`);
            
            // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚’è¨ˆç®—ï¼ˆç›¸å¯¾åº§æ¨™ï¼‰
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            // ãƒ‰ãƒƒãƒˆã®ä½ç½®ã‚’æ›´æ–°ï¼ˆãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå€¤ï¼‰
            dot.style.left = `${x * 100}%`;
            dot.style.top = `${y * 100}%`;
            
            // åº§æ¨™è¡¨ç¤ºã‚’æ›´æ–°
            updateCoordinatesDisplay(matrixNumber, x, y);
        }
        
        // åº§æ¨™è¡¨ç¤ºã®æ›´æ–°
        function updateCoordinatesDisplay(matrixNumber, x, y) {
            const coordsElement = document.getElementById(`coordinates${matrixNumber}`);
            coordsElement.textContent = `åº§æ¨™: X: ${x.toFixed(2)}, Y: ${y.toFixed(2)}`;
        }
        
        // ä¾¡æ ¼è¡¨ç¤ºã®æ›´æ–°
        function updatePriceDisplay() {
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            
            document.getElementById('minPriceDisplay').textContent = `Â¥${minPrice},000`;
            document.getElementById('maxPriceDisplay').textContent = `Â¥${maxPrice},000`;
        }
        
        // å‘³è¦šåº§æ¨™ã®å–å¾—
        function getTasteCoordinate(matrixNumber) {
            const dot = document.getElementById(`tasteDot${matrixNumber}`);
            const matrix = document.getElementById(`tasteMatrix${matrixNumber}`);
            
            if (!dot || !matrix) return { x: 0.5, y: 0.5 };
            
            // ãƒ‰ãƒƒãƒˆã®ä½ç½®ã‚’å–å¾—ï¼ˆ%å€¤ã‹ã‚‰å°æ•°ã«å¤‰æ›ï¼‰
            const left = dot.style.left;
            const top = dot.style.top;
            
            const x = parseFloat(left) / 100;
            const y = parseFloat(top) / 100;
            
            return { x, y };
        }
        
        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®å…±é€šã‚ªãƒ—ã‚·ãƒ§ãƒ³
        const chartOptions = {
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        color: 'rgba(255, 255, 255, 0.8)',
                        font: {
                            size: 14
                        },
                        boxWidth: 15
                    }
                },
                tooltip: {
                    enabled: true,
                    backgroundColor: 'rgba(0, 0, 0, 0.7)'
                }
            },
            scales: {
                r: {  // Chart.js v3ä»¥é™ã§ã¯'r'ã‚’ä½¿ç”¨
                    angleLines: {
                        display: true,
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    pointLabels: {
                        font: {
                            size: 16  // æŒ‡æ¨™ãƒ©ãƒ™ãƒ«ã®ã‚µã‚¤ã‚ºã‚’å¤§ãã
                        },
                        color: 'rgba(255, 255, 255, 0.9)'
                    },
                    ticks: {
                        display: false,  // æ•°å­—ã‚’éè¡¨ç¤º
                        backdropColor: 'transparent',  // èƒŒæ™¯ã‚‚é€æ˜ã«
                        count: 5
                    },
                    beginAtZero: true,
                    min: 0,
                    max: 5
                }
            },
            maintainAspectRatio: false,
            responsive: true
        };

        // è’¸ç•™æ‰€ãƒãƒ¼ã‚«ãƒ¼æ›´æ–°ã®å…±é€šé–¢æ•°
        function updateDistilleryMarkers(activeName) {
            // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            clearAllMarkers();
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªè’¸ç•™æ‰€ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆï¼ˆèµ¤è‰²ï¼‰
            if (activeName && distilleryDatabase[activeName]) {
                const distillery = distilleryDatabase[activeName];
                createMarker(distillery, true);  // true = ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆèµ¤è‰²ï¼‰
            }
            
            // ãã®ä»–ã®è’¸ç•™æ‰€ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆï¼ˆç·‘è‰²ï¼‰
            Object.keys(distilleryDatabase).forEach(name => {
                if (name !== activeName && name !== 'NaN' && distilleryDatabase[name]) {
                    createMarker(distilleryDatabase[name], false);  // false = éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆç·‘è‰²ï¼‰
                }
            });
        }

        // ãƒãƒ¼ã‚«ãƒ¼ä½œæˆå…±é€šé–¢æ•°
        function createMarker(distillery, isActive) {
            if (!distillery || !distillery.location) return;
            
            // åº§æ¨™ã®æ¤œè¨¼
            if (!isValidCoordinate(distillery.location.lat, distillery.location.lng)) return;
            
            // ãƒãƒ¼ã‚«ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–=èµ¤ã€éã‚¢ã‚¯ãƒ†ã‚£ãƒ–=ç·‘ï¼‰
            const markerColor = isActive ? '#ff6b6b' : '#4ecdc4';
            const markerOptions = {
                radius: isActive ? 10 : 6,  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¼ã‚«ãƒ¼ã‚’å¤§ãã
                fillColor: markerColor,
                color: '#fff',  // ç™½ã„ç¸å–ã‚Š
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8,
                zIndexOffset: isActive ? 1000 : 0  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¼ã‚«ãƒ¼ã‚’æœ€å‰é¢ã«
            };
            
            // ãƒãƒ¼ã‚«ãƒ¼ä½œæˆ
            const marker = L.circleMarker([distillery.location.lat, distillery.location.lng], markerOptions)
                .addTo(distilleryMap);
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            marker.on('click', () => showDistilleryInfo(distillery));
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚‰è¿½åŠ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆãƒ‘ãƒ«ã‚¹ï¼‰
            if (isActive) {
                marker.bringToFront();
                
                // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                const pulseOptions = {
                    radius: 20,
                    fillColor: 'rgba(255, 107, 107, 0.2)',
                    color: markerColor,
                    weight: 1,
                    opacity: 0.6,
                    fillOpacity: 0.3
                };
                
                const pulseCircle = L.circleMarker(
                    [distillery.location.lat, distillery.location.lng], 
                    pulseOptions
                ).addTo(distilleryMap);
                
                pulseCircle.bringToBack();  // ãƒ‘ãƒ«ã‚¹ã¯èƒŒé¢ã«
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
                let isGrowing = true;
                let currentRadius = 20;
                
                const pulseInterval = setInterval(() => {
                    if (isGrowing) {
                        currentRadius += 1;
                        if (currentRadius >= 30) isGrowing = false;
                    } else {
                        currentRadius -= 1;
                        if (currentRadius <= 15) isGrowing = true;
                    }
                    
                    pulseCircle.setRadius(currentRadius);
                }, 100);
                
                // ãƒãƒ¼ã‚«ãƒ¼ã«ãƒ‘ãƒ«ã‚¹æƒ…å ±ã‚’ç´ã¥ã‘
                marker.pulse = {
                    circle: pulseCircle,
                    interval: pulseInterval
                };
            }
            
            // ãƒãƒ¼ã‚«ãƒ¼ä¿å­˜
            distilleryMarkers[distillery.name] = marker;
            return marker;
        }

        // åº§æ¨™æ¤œè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function isValidCoordinate(lat, lng) {
            return lat && lng && !isNaN(lat) && !isNaN(lng) && 
                lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180;
        }

        // å…¨ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªã‚¢é–¢æ•°
        function clearAllMarkers() {
            Object.values(distilleryMarkers).forEach(marker => {
                // ãƒ‘ãƒ«ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒã‚ã‚Œã°åœæ­¢ãƒ»å‰Šé™¤
                if (marker.pulse) {
                    clearInterval(marker.pulse.interval);
                    if (marker.pulse.circle) {
                        distilleryMap.removeLayer(marker.pulse.circle);
                    }
                }
                distilleryMap.removeLayer(marker);
            });
            
            // ãƒãƒ¼ã‚«ãƒ¼é…åˆ—ã‚¯ãƒªã‚¢
            distilleryMarkers = {};
        }

        // è’¸ç•™æ‰€æƒ…å ±è¡¨ç¤ºé–¢æ•°
        function showDistilleryInfo(distillery) {
            if (!distillery) return;
            
            // è’¸ç•™æ‰€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            document.getElementById('distillerySection').classList.add('active');
            
            // è’¸ç•™æ‰€åã‚’è¡¨ç¤º
            document.getElementById('distilleryName').textContent = distillery.name || 'ä¸æ˜ãªè’¸ç•™æ‰€';
            
            // è’¸ç•™æ‰€è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
            const detailsContainer = document.getElementById('distilleryDetails');
            detailsContainer.innerHTML = '';
            
            // æ‰€åœ¨åœ°
            if (distillery.region) {
                appendDistilleryDetail(detailsContainer, 'æ‰€åœ¨åœ°:', distillery.region);
            }
            
            // å‰µæ¥­å¹´
            if (distillery.foundedYear && distillery.foundedYear > 0) {
                appendDistilleryDetail(detailsContainer, 'å‰µæ¥­å¹´:', distillery.foundedYear);
            }
            
            // ç¾åœ¨ã®çŠ¶æ³
            if (distillery.status) {
                const statusClass = distillery.status.includes('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–') ? 'status-active' : 
                                    distillery.status.includes('é–‰é–') ? 'status-closed' : 'status-unknown';
                
                appendDistilleryDetail(detailsContainer, 'ç¾åœ¨ã®çŠ¶æ³:', 
                    `<span class="${statusClass}">${distillery.status}</span>`);
            }
            
            // æ¦‚è¦ï¼ˆèª¬æ˜æ–‡ï¼‰
            if (distillery.description) {
                const descItem = document.createElement('div');
                descItem.className = 'info-label';
                descItem.style.gridColumn = 'span 2';
                descItem.style.marginTop = '15px';
                descItem.textContent = 'æ¦‚è¦:';
                detailsContainer.appendChild(descItem);
                
                const descValue = document.createElement('div');
                descValue.style.gridColumn = 'span 2';
                descValue.innerHTML = distillery.description;
                detailsContainer.appendChild(descValue);
            }
            
            // åœ°å›³ã‚’è’¸ç•™æ‰€ã«ç§»å‹•
            if (distillery.location && isValidCoordinate(distillery.location.lat, distillery.location.lng)) {
                distilleryMap.setView(
                    [distillery.location.lat, distillery.location.lng],
                    distillery.zoomLevel || 8
                );
            }
        }

        // è’¸ç•™æ‰€è©³ç´°æƒ…å ±ã®è¿½åŠ ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function appendDistilleryDetail(container, label, value) {
            const labelElem = document.createElement('div');
            labelElem.className = 'info-label';
            labelElem.textContent = label;
            container.appendChild(labelElem);
            
            const valueElem = document.createElement('div');
            valueElem.className = 'info-value';
            valueElem.innerHTML = value;
            container.appendChild(valueElem);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            // ä¾¡æ ¼ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('minPrice').addEventListener('input', updatePriceDisplay);
            document.getElementById('maxPrice').addEventListener('input', updatePriceDisplay);
            
            // æ¨è–¦ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('getRecommendation').addEventListener('click', handleGetRecommendation);
            
            // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('refreshRecommendation').addEventListener('click', handleRefreshRecommendation);
            
            // åˆ¥ã®ææ¡ˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('getAnotherRecommendation').addEventListener('click', handleGetAnotherRecommendation);
            
            // é€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('sendChatBtn').addEventListener('click', handleSendChat);
            
            // ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ã®Enterã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSendChat();
                }
            });
            
            // è³ªå•ä¾‹ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('.question-example').forEach(example => {
                example.addEventListener('click', function() {
                    document.getElementById('chatInput').value = this.getAttribute('data-question');
                });
            });
            
            // éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('voiceInputBtn').addEventListener('click', toggleSpeechRecognition);
        }
        
        // æ¨è–¦ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleGetRecommendation() {
            // å›ºå®šé«˜ã•ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
            document.getElementById('fixedHeightContainer').style.display = 'block';
            document.getElementById('splitLayoutContainer').style.display = 'none';
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = 'block';
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            setTimeout(() => {
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
                loadingIndicator.style.display = 'none';
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤º
                const progressContainer = document.getElementById('progressContainer');
                progressContainer.style.display = 'block';
                
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 5;
                    if (progress > 100) {
                        clearInterval(progressInterval);
                        
                        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹çµ‚äº†å¾Œã€çµæœã‚’è¡¨ç¤º
                        progressContainer.style.display = 'none';
                        document.getElementById('fixedHeightContainer').style.display = 'none';
                        showRecommendationResults();
                    } else {
                        document.getElementById('progressFill').style.width = `${progress}%`;
                        document.getElementById('progressPercentage').textContent = `${progress}%`;
                    }
                }, 100);
            }, 1500);
        }
        
        // æ¨è–¦çµæœã®è¡¨ç¤º
        function showRecommendationResults() {
            // å¥½ã¿ã®å‚¾å‘ã®èª¬æ˜ã‚’ç”Ÿæˆ
            updatePreferencesSummary();
            
            // ãŠã™ã™ã‚ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’é¸å®š
            const recommendations = selectRecommendedWhiskies();
            
            // çµæœãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
            document.getElementById('splitLayoutContainer').style.display = 'grid';
            
            // æ¨è–¦ãƒªã‚¹ãƒˆã«è¡¨ç¤º
            displayRecommendations(recommendations);
            
            // ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤º
            updateChartWithUserPreference();
            
            // è’¸ç•™æ‰€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('distillerySection').classList.add('active');
        }
        
        // å¥½ã¿ã®å‚¾å‘ã®èª¬æ˜ã®æ›´æ–°
        function updatePreferencesSummary() {
            const tasteCoord1 = getTasteCoordinate(1);
            const tasteCoord2 = getTasteCoordinate(2);
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            
            // å‘³ã®å‚¾å‘ã®èª¬æ˜
            let tasteDesc = '';
            if (tasteCoord1.x < 0.33) {
                tasteDesc += 'ãƒ©ã‚¤ãƒˆã§';
            } else if (tasteCoord1.x > 0.66) {
                tasteDesc += 'ãƒ˜ãƒ“ãƒ¼ã§';
            } else {
                tasteDesc += 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸ';
            }
            
            if (tasteCoord1.y < 0.33) {
                tasteDesc += 'ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªå‘³ã‚ã„ã‚’å¥½ã‚€';
            } else if (tasteCoord1.y > 0.66) {
                tasteDesc += 'ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªå‘³ã‚ã„ã‚’å¥½ã‚€';
            } else {
                tasteDesc += 'å‘³ã‚ã„ã‚’å¥½ã‚€';
            }
            
            // è¤‡é›‘ã•ã®å¥½ã¿ã®èª¬æ˜
            let complexityDesc = '';
            if (tasteCoord2.x < 0.33) {
                complexityDesc += 'è‹¥ã„';
            } else if (tasteCoord2.x > 0.66) {
                complexityDesc += 'ç†Ÿæˆã•ã‚ŒãŸ';
            } else {
                complexityDesc += 'ä¸­ç¨‹åº¦ã®ç†Ÿæˆã®';
            }
            
            complexityDesc += 'ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã§';
            
            if (tasteCoord2.y < 0.33) {
                complexityDesc += 'ã¾ã‚ã‚„ã‹ãªè¤‡é›‘ã•ã‚’å¥½ã‚€';
            } else if (tasteCoord2.y > 0.66) {
                complexityDesc += 'å¼·çƒˆãªè¤‡é›‘ã•ã‚’å¥½ã‚€';
            } else {
                complexityDesc += 'ä¸­ç¨‹åº¦ã®è¤‡é›‘ã•ã‚’å¥½ã‚€';
            }
            
            // ä¾¡æ ¼å¸¯ã®èª¬æ˜
            const priceRangeDesc = `Â¥${minPrice},000 - Â¥${maxPrice},000`;
            
            // å¥½ã¿ã®ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
            document.getElementById('tasteDescription').textContent = tasteDesc;
            document.getElementById('complexityDescription').textContent = complexityDesc;
            document.getElementById('priceRangeDescription').textContent = priceRangeDesc;
            document.getElementById('preferencesSummary').style.display = 'block';
        }
        
        // ãŠã™ã™ã‚ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®é¸å®š
        function selectRecommendedWhiskies() {
            if (!whiskyData || whiskyData.length === 0) {
                return getDefaultRecommendations();
            }
            
            const tasteCoord1 = getTasteCoordinate(1);
            const tasteCoord2 = getTasteCoordinate(2);
            const minPrice = parseInt(document.getElementById('minPrice').value) * 1000;
            const maxPrice = parseInt(document.getElementById('maxPrice').value) * 1000;
            
            // ä¾¡æ ¼ã‚’ãƒ‘ãƒ¼ã‚¹
            const parsedWhiskies = whiskyData.map(whisky => {
                const priceMatch = whisky.price.match(/[\d,]+/);
                const price = priceMatch ? parseInt(priceMatch[0].replace(/,/g, '')) : 0;
                return { ...whisky, parsedPrice: price };
            });
            
            // ä¾¡æ ¼å¸¯ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const filteredByPrice = parsedWhiskies.filter(whisky => {
                return whisky.parsedPrice >= minPrice && whisky.parsedPrice <= maxPrice;
            });
            
            if (filteredByPrice.length === 0) {
                return getDefaultRecommendations();
            }
            
            // å‘³ã‚ã„ã®ãƒãƒƒãƒåº¦ã‚’è¨ˆç®—
            const whiskiesWithScore = filteredByPrice.map(whisky => {
                const profile = whisky.taste_profile;
                if (!profile) return { ...whisky, score: 0 };
                
                // ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼/ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼è»¸ã®è¨ˆç®—
                const fruitySmokyScore = 1 - Math.abs(tasteCoord1.y - (profile.smoky / 5));
                
                // ãƒ©ã‚¤ãƒˆ/ãƒ˜ãƒ“ãƒ¼è»¸ã®è¨ˆç®—
                const lightHeavyScore = 1 - Math.abs(tasteCoord1.x - (profile.body / 5));
                
                // è‹¥ã„/ç†Ÿæˆè»¸ã®è¨ˆç®—
                const youngAgedScore = 1 - Math.abs(tasteCoord2.x - (profile.complexity / 5));
                
                // ã¾ã‚ã‚„ã‹/å¼·çƒˆè»¸ã®è¨ˆç®—
                const mildIntenseScore = 1 - Math.abs(tasteCoord2.y - ((profile.spicy + profile.body) / 10));
                
                // ç·åˆã‚¹ã‚³ã‚¢
                const totalScore = (fruitySmokyScore + lightHeavyScore + youngAgedScore + mildIntenseScore) / 4;
                
                return {
                    ...whisky,
                    score: totalScore,
                    matchPercentage: Math.round(totalScore * 100)
                };
            });
            
            // ã‚¹ã‚³ã‚¢ã§ä¸¦ã¹æ›¿ãˆ
            const sortedWhiskies = whiskiesWithScore.sort((a, b) => b.score - a.score);
            
            // ãƒˆãƒƒãƒ—3ã‚’è¿”å´
            return sortedWhiskies.slice(0, 3);
        }
        
        // æ¨è–¦çµæœã®è¡¨ç¤º
        function displayRecommendations(recommendations) {
            const contentContainer = document.getElementById('recommendationContent');
            contentContainer.innerHTML = '';
            
            if (!recommendations || recommendations.length === 0) {
                contentContainer.innerHTML = '<div class="error">æ¡ä»¶ã«åˆã†ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>';
                return;
            }
            
            recommendations.forEach((whisky, index) => {
                const isFeatured = index === 0;
                const whiskyCard = document.createElement('div');
                whiskyCard.className = `whisky-card ${isFeatured ? 'featured' : ''}`;
                whiskyCard.onclick = function() { selectWhisky(whisky.id); };
                
                // ã‚«ãƒ¼ãƒ‰å†…å®¹ã‚’æ§‹ç¯‰
                let cardHTML = '';
                
                if (isFeatured) {
                    cardHTML += '<div class="featured-label">â­ æœ€ã‚‚ãŠã™ã™ã‚</div>';
                }
                
                cardHTML += `<h3 class="text-xl font-bold mb-2">${whisky.name}</h3>`;
                cardHTML += `<div class="flex justify-between items-center mb-2">
                    <span class="text-lg font-semibold text-green-400">${whisky.price}</span>
                    <span class="text-sm bg-blue-600 px-2 py-1 rounded">${whisky.region}</span>
                </div>`;
                
                cardHTML += `<p class="text-sm text-gray-300 mb-2">${whisky.subcategory || ''}</p>`;
                
                // ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒˆã‚’çŸ­ã
                let tastingNote = whisky.tastingNote_ja || '';
                if (tastingNote.length > 100) {
                    tastingNote = tastingNote.substring(0, 100) + '...';
                }
                cardHTML += `<p class="text-sm mb-3">${tastingNote}</p>`;
                
                // ãƒãƒƒãƒåº¦ã®ãƒãƒ¼
                cardHTML += `<div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">é©åˆåº¦: ${whisky.matchPercentage || 0}%</span>
                    <div class="w-24 h-2 bg-gray-700 rounded-full">
                        <div class="h-full bg-gradient-to-r from-red-500 to-green-500 rounded-full" style="width: ${whisky.matchPercentage || 0}%"></div>
                    </div>
                </div>`;
                
                whiskyCard.innerHTML = cardHTML;
                contentContainer.appendChild(whiskyCard);
            });
            
            // æœ€åˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’é¸æŠ
            selectWhisky(recommendations[0].id);
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’é¸æŠ
        function selectWhisky(whiskyId) {
            const whisky = whiskyData.find(w => w.id === whiskyId);
            if (!whisky) return;
            
            // å…¨ã‚«ãƒ¼ãƒ‰ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’å‰Šé™¤
            document.querySelectorAll('.whisky-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚«ãƒ¼ãƒ‰ã«é¸æŠçŠ¶æ…‹ã‚’è¿½åŠ 
            const clickedCard = [...document.querySelectorAll('.whisky-card')].find(card => {
                return card.querySelector('h3').textContent === whisky.name;
            });
            
            if (clickedCard) {
                clickedCard.classList.add('selected');
            }
            
            // ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°
            updateProfileChart(whisky.taste_profile, getUserPreferenceProfile());
            
            // ãƒãƒ£ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
            document.getElementById('chartTitle').textContent = `ã‚ãªãŸã®å¥½ã¿ vs ${whisky.name}`;
            
            // è’¸ç•™æ‰€æƒ…å ±ã‚’è¡¨ç¤º
            updateDistilleryInfoForWhisky(whisky);
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®è’¸ç•™æ‰€æƒ…å ±ã‚’æ›´æ–°
        function updateDistilleryInfoForWhisky(whisky) {
            // è’¸ç•™æ‰€åã®ç‰¹å®šã‚’è©¦ã¿ã‚‹
            const distilleryName = findDistilleryNameForWhisky(whisky);
            
            if (distilleryName && distilleryDatabase[distilleryName]) {
                // è’¸ç•™æ‰€æƒ…å ±ã‚’è¡¨ç¤º
                const distillery = distilleryDatabase[distilleryName];
                showDistilleryInfo(distillery);
                
                // ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°
                updateDistilleryMarkers(distilleryName);
                
                // èµ¤ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’æœ€å‰é¢ã«
                setTimeout(() => {
                    const marker = distilleryMarkers[distilleryName];
                    if (marker) {
                        marker.bringToFront();
                    }
                }, 100);
            } else {
                // ç”£åœ°æƒ…å ±ã§ä»£ç”¨
                showRegionInfo(whisky);
            }
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã«å¯¾å¿œã™ã‚‹è’¸ç•™æ‰€åã‚’è¤‡æ•°ã®æ–¹æ³•ã§ç‰¹å®šã™ã‚‹é–¢æ•°
        function findDistilleryNameForWhisky(whisky) {
            if (!whisky || !distilleryDatabase) return null;
            
            // æ–¹æ³•1: brandToDistilleryãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç¢ºèª
            if (distilleryDatabase.brandToDistillery && distilleryDatabase.brandToDistillery[whisky.name]) {
                return distilleryDatabase.brandToDistillery[whisky.name];
            }
            
            // æ–¹æ³•2: åå‰ã®ãƒãƒƒãƒãƒ³ã‚°ã‚’è©¦ã¿ã‚‹
            for (const name in distilleryDatabase) {
                // æ—¥æœ¬èªåã§ç¢ºèª
                if (whisky.name.includes(name)) {
                    return name;
                }
                
                // è‹±èªåã§ç¢ºèªï¼ˆã‚«ãƒƒã‚³å†…ã‚’æŠ½å‡ºï¼‰
                const distilleryInfo = distilleryDatabase[name];
                const englishNameMatch = distilleryInfo?.name?.match(/\((.*?)\)/);
                if (englishNameMatch) {
                    const englishName = englishNameMatch[1].replace(' Distillery', '');
                    if (whisky.name.toLowerCase().includes(englishName.toLowerCase())) {
                        return name;
                    }
                }
            }
            
            return null;
        }
        
        // ç”£åœ°æƒ…å ±ã®è¡¨ç¤º
        function showRegionInfo(whisky) {
            if (!whisky || !whisky.region) return;
            
            // è’¸ç•™æ‰€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            document.getElementById('distillerySection').classList.add('active');
            
            // è’¸ç•™æ‰€åã‚’è¡¨ç¤º
            const regionName = whisky.region.includes('Scotland') ? 
                `ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ ${whisky.region.replace('Scotland', '').trim()}` : whisky.region;
            
            document.getElementById('distilleryName').textContent = regionName;
            
            // è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
            const detailsContainer = document.getElementById('distilleryDetails');
            detailsContainer.innerHTML = '';
            
            appendDistilleryDetail(detailsContainer, 'ç”£åœ°:', whisky.region);
            if (whisky.subcategory) {
                appendDistilleryDetail(detailsContainer, 'ã‚¿ã‚¤ãƒ—:', whisky.subcategory);
            }
            
            // åœ°å›³ã‚’ç”£åœ°ã«åˆã‚ã›ã‚‹
            updateMapForRegion(whisky.region);
        }
        
        // ç”£åœ°ã«åŸºã¥ã„ã¦åœ°å›³ã‚’æ›´æ–°
        function updateMapForRegion(regionName) {
            // ãƒªãƒ¼ã‚¸ãƒ§ãƒ³åã‹ã‚‰å ´æ‰€ã‚’æ±ºå®š
            let center, zoom;
            
            if (regionName.includes('Islay')) {
                center = [55.75, -6.15];
                zoom = 10;
            } else if (regionName.includes('Speyside')) {
                center = [57.45, -3.20];
                zoom = 9;
            } else if (regionName.includes('Highland')) {
                center = [57.5, -4.5];
                zoom = 8;
            } else if (regionName.includes('Scotland')) {
                center = [56.5, -4.0];
                zoom = 7;
            } else if (regionName.includes('Japan')) {
                center = [36.0, 138.0];
                zoom = 5;
            } else {
                center = [55.0, -3.0];
                zoom = 6;
            }
            
            // åœ°å›³ã‚’ç§»å‹•
            distilleryMap.setView(center, zoom);
            
            // ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            clearAllMarkers();
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¥½ã¿ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—
        function getUserPreferenceProfile() {
            const tasteCoord1 = getTasteCoordinate(1);
            const tasteCoord2 = getTasteCoordinate(2);
            
            // xè»¸ã¯bodyï¼ˆãƒ©ã‚¤ãƒˆ/ãƒ˜ãƒ“ãƒ¼ï¼‰ã«å¯¾å¿œ
            const body = Math.round(tasteCoord1.x * 5);
            
            // yè»¸ã¯smokyï¼ˆãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼/ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ï¼‰ã«å¯¾å¿œ
            const smoky = Math.round(tasteCoord1.y * 5);
            
            // ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã¯smokyã®é€†
            const fruity = 5 - smoky;
            
            // xè»¸ã¯ç†Ÿæˆåº¦ï¼ˆè‹¥ã„/ç†Ÿæˆï¼‰ã«å¯¾å¿œ
            const complexity = Math.round(tasteCoord2.x * 5);
            
            // yè»¸ã¯ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã¨ç”˜ã•ã«é–¢é€£
            const spicy = Math.round(tasteCoord2.y * 5);
            const sweetness = 5 - Math.round(tasteCoord2.y * 3);  // ç”˜ã•ã¯å¼·çƒˆã•ã®é€†ã ãŒã€å°‘ã—èª¿æ•´
            
            return {
                fruity,
                spicy,
                body,
                smoky,
                sweetness,
                complexity
            };
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼å¥½ã¿ã§ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°
        function updateChartWithUserPreference() {
            const userProfile = getUserPreferenceProfile();
            
            // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å€¤ã‚’é…åˆ—ã«å¤‰æ›
            const profileValues = [
                userProfile.fruity,
                userProfile.spicy,
                userProfile.body,
                userProfile.smoky,
                userProfile.sweetness,
                userProfile.complexity
            ];
            
            // ãƒãƒ£ãƒ¼ãƒˆä½œæˆ
            updateProfileChart(null, profileValues);
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateProfileChart(whiskyProfile, userProfile) {
            const ctx = document.getElementById('combinedProfileChart').getContext('2d');
            
            if (profileChartInstance) {
                profileChartInstance.destroy();
            }
            
            const datasets = [];
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°è¿½åŠ 
            if (userProfile) {
                datasets.push({
                    label: 'ã‚ãªãŸã®å¥½ã¿',
                    data: Array.isArray(userProfile) ? userProfile : [
                        userProfile.fruity,
                        userProfile.spicy,
                        userProfile.body,
                        userProfile.smoky,
                        userProfile.sweetness,
                        userProfile.complexity
                    ],
                    backgroundColor: 'rgba(78, 205, 196, 0.2)',
                    borderColor: '#4ecdc4',
                    pointBackgroundColor: '#4ecdc4',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#4ecdc4'
                });
            }
            
            // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°è¿½åŠ 
            if (whiskyProfile) {
                datasets.push({
                    label: 'ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«',
                    data: [
                        whiskyProfile.fruity,
                        whiskyProfile.spicy,
                        whiskyProfile.body,
                        whiskyProfile.smoky,
                        whiskyProfile.sweetness,
                        whiskyProfile.complexity
                    ],
                    backgroundColor: 'rgba(255, 107, 107, 0.2)',
                    borderColor: '#ff6b6b',
                    pointBackgroundColor: '#ff6b6b',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#ff6b6b'
                });
            }
            
            profileChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼', 'ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼', 'ãƒœãƒ‡ã‚£', 'ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼', 'ç”˜ã•', 'è¤‡é›‘ã•'],
                    datasets: datasets
                },
                options: chartOptions
            });
        }
        
        // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleRefreshRecommendation() {
            initializePageState();
        }
        
        // åˆ¥ã®ææ¡ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleGetAnotherRecommendation() {
            // ãŠã™ã™ã‚ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’å†é¸å®šï¼ˆç¾åœ¨é¸ã°ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’é™¤ãï¼‰
            const selectedWhiskyCards = document.querySelectorAll('.whisky-card.selected');
            const excludeIds = Array.from(selectedWhiskyCards).map(card => {
                const whiskyName = card.querySelector('h3').textContent;
                const whisky = whiskyData.find(w => w.name === whiskyName);
                return whisky ? whisky.id : null;
            }).filter(id => id !== null);
            
            // ä¾¡æ ¼å¸¯ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const minPrice = parseInt(document.getElementById('minPrice').value) * 1000;
            const maxPrice = parseInt(document.getElementById('maxPrice').value) * 1000;
            
            const filteredWhiskies = whiskyData.filter(whisky => {
                const priceMatch = whisky.price.match(/[\d,]+/);
                const price = priceMatch ? parseInt(priceMatch[0].replace(/,/g, '')) : 0;
                
                return price >= minPrice && price <= maxPrice && !excludeIds.includes(whisky.id);
            });
            
            if (filteredWhiskies.length > 0) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
                const randomIndices = [];
                const recommendCount = Math.min(3, filteredWhiskies.length);
                
                while (randomIndices.length < recommendCount) {
                    const randomIndex = Math.floor(Math.random() * filteredWhiskies.length);
                    if (!randomIndices.includes(randomIndex)) {
                        randomIndices.push(randomIndex);
                    }
                }
                
                const randomRecommendations = randomIndices.map(index => {
                    return {
                        ...filteredWhiskies[index],
                        matchPercentage: Math.floor(Math.random() * 50) + 30  // ãƒ©ãƒ³ãƒ€ãƒ ãªãƒãƒƒãƒåº¦
                    };
                });
                
                displayRecommendations(randomRecommendations);
            }
        }
        
        // ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function handleSendChat() {
            const userInput = document.getElementById('chatInput').value.trim();
            if (!userInput) return;
            
            // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’è¡¨ç¤ºçŠ¶æ…‹ã«
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.style.display = 'block';
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            appendUserMessage(userInput);
            
            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('chatInput').value = '';
            
            // AIã®ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const loadingMsgId = showThinkingMessage();
            
            // Claude APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æº–å‚™
            const tasteCoord1 = getTasteCoordinate(1);
            const tasteCoord2 = getTasteCoordinate(2);
            const minPrice = document.getElementById('minPrice').value;
            const maxPrice = document.getElementById('maxPrice').value;
            
            const params = {
                minPrice: parseInt(minPrice) * 1000,
                maxPrice: parseInt(maxPrice) * 1000,
                tasteX: tasteCoord1.x,
                tasteY: tasteCoord1.y, 
                additionalPreferences: userInput
            };
            
            // Claude APIå‘¼ã³å‡ºã—
            callClaudeAPI(params)
                .then(response => {
                    // ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
                    removeThinkingMessage(loadingMsgId);
                    
                    if (response && response.data) {
                        // AIã®è¿”ä¿¡ã‚’è¡¨ç¤º
                        appendAIMessage(response.data.content || response.data);
                    } else {
                        throw new Error('Invalid API response');
                    }
                })
                .catch(error => {
                    console.error('Chat error:', error);
                    
                    // ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
                    removeThinkingMessage(loadingMsgId);
                    
                    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    appendAIMessage('ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                });
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¿½åŠ 
        function appendUserMessage(message) {
            const chatHistory = document.getElementById('chatHistory');
            const msgElement = document.createElement('div');
            msgElement.className = 'chat-message user-message';
            msgElement.textContent = message;
            chatHistory.appendChild(msgElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¿½åŠ 
        function appendAIMessage(message) {
            const chatHistory = document.getElementById('chatHistory');
            const msgElement = document.createElement('div');
            msgElement.className = 'chat-message ai-message';
            msgElement.textContent = message;
            chatHistory.appendChild(msgElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        // ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showThinkingMessage() {
            const chatHistory = document.getElementById('chatHistory');
            const msgElement = document.createElement('div');
            msgElement.className = 'chat-message ai-message';
            msgElement.id = 'thinking-message-' + Date.now();
            msgElement.textContent = 'è€ƒãˆä¸­...';
            chatHistory.appendChild(msgElement);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            return msgElement.id;
        }
        
        // ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        function removeThinkingMessage(messageId) {
            const messageElement = document.getElementById(messageId);
            if (messageElement) {
                messageElement.remove();
            }
        }
        
        // Claude APIå‘¼ã³å‡ºã—
        async function callClaudeAPI(params) {
            try {
                // APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆ
                const endpoints = [
                    'http://Bedroc-Proxy-wEBSZeIAE9sX-1369774611.us-east-1.elb.amazonaws.com/api/v1/chat/completions',
                    'http://Bedroc-Proxy-wEBSZeIAE9sX-1369774611.us-east-1.elb.amazonaws.com/v1/messages',
                    'http://Bedroc-Proxy-wEBSZeIAE9sX-1369774611.us-east-1.elb.amazonaws.com/api/v1',
                    'http://Bedroc-Proxy-wEBSZeIAE9sX-1369774611.us-east-1.elb.amazonaws.com/'
                ];
                
                // ãƒ¢ãƒƒã‚¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½œæˆï¼ˆAPIãŒåˆ©ç”¨ã§ããªã„ç’°å¢ƒç”¨ï¼‰
                const mockResponse = {
                    success: true,
                    data: {
                        content: createAIResponse(params.additionalPreferences)
                    }
                };
                
                return mockResponse;
                
                // å®Ÿéš›ã®APIãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
                /*
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Bearer YOUR_API_KEY_HERE',
                                'anthropic-version': '2023-06-01'
                            },
                            body: JSON.stringify({
                                model: "us.anthropic.claude-3-7-sonnet-20250219-v1:0",
                                max_tokens: 2000,
                                temperature: 0.7,
                                messages: [{
                                    role: "user",
                                    content: `ã‚ãªãŸã¯ã€Œæ˜¼ã®æœˆãƒãƒ¼ã€ã®ç†Ÿç·´ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚½ãƒ ãƒªã‚¨ã§ã™ã€‚
                                    é¡§å®¢ã®å¥½ã¿ã«æœ€é©ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
                                    
                                    é¡§å®¢ã®å¥½ã¿:
                                    - ä¾¡æ ¼å¸¯: ${params.minPrice}å††ã€œ${params.maxPrice}å††
                                    - å‘³è¦šåº§æ¨™: Xè»¸=${params.tasteX.toFixed(2)}ï¼ˆ0=ãƒ©ã‚¤ãƒˆâ†’1=ãƒ˜ãƒ“ãƒ¼ï¼‰, Yè»¸=${params.tasteY.toFixed(2)}ï¼ˆ0=ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼â†’1=ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ï¼‰
                                    - è¿½åŠ è¦æœ›: ${params.additionalPreferences}
                                    
                                    ã€é¡§å®¢ã‹ã‚‰ã®è³ªå•ã€‘
                                    "${params.additionalPreferences}"
                                    `
                                }]
                            })
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            return { success: true, data };
                        }
                    } catch (error) {
                        console.error(`Failed to call ${endpoint}:`, error);
                    }
                }
                
                // ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤±æ•—ã—ãŸå ´åˆ
                throw new Error('All API endpoints failed');
                */
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }
        
        // ãƒ¢ãƒƒã‚¯å¿œç­”ã®ç”Ÿæˆ
        function createAIResponse(question) {
            const responses = {
                'ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼ˆæœ€é«˜é¡80,400å††ï¼‰ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦': 
                    'ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ã¯ã€ã‚¹ã‚«ã‚¤å³¶ã®æ­´å²ã‚ã‚‹è’¸ç•™æ‰€ã‹ã‚‰2018å¹´ã«ç™ºå£²ã•ã‚ŒãŸç‰¹åˆ¥ãªé™å®šãƒœãƒˆãƒ«ã§ã™ã€‚1971å¹´ã«è’¸ç•™ã•ã‚Œã€44å¹´é–“ç†Ÿæˆã•ã‚ŒãŸå¸Œå°‘ãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€ã‚ãšã‹2,000æœ¬ã®ã¿ã®ç”Ÿç”£ã§ã™ã€‚\n\né¦™ã‚Šã¯æµ·ã®å¡©æ°—ã€ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã€æŸ‘æ©˜é¡ã®çš®ã€ãã—ã¦æ§ãˆã‚ãªã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã•ãŒç‰¹å¾´ã§ã™ã€‚å‘³ã‚ã„ã¯éå¸¸ã«è¤‡é›‘ã§ã€æµ·å¡©ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ã€ãƒ€ãƒ¼ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã€ã‚¹ãƒ‘ã‚¤ã‚¹ã€ç†Ÿã—ãŸãƒ•ãƒ«ãƒ¼ãƒ„ãŒå±¤ã«ãªã£ã¦ãŠã‚Šã€å¾Œå‘³ã«ã¯é•·ãç¶šãæ¸©ã‹ã¿ã®ã‚ã‚‹ä½™éŸ»ãŒã‚ã‚Šã¾ã™ã€‚\n\nç‰¹ç­†ã™ã¹ãã¯ã€ã“ã®ã‚ˆã†ãªé•·æœŸç†Ÿæˆã§ã‚ã‚ŠãªãŒã‚‰ã€ã‚¿ãƒªã‚¹ã‚«ãƒ¼ç‰¹æœ‰ã®æµ·ã®é¢¨å‘³ã¨ç¹Šç´°ãªã‚¹ãƒ¢ãƒ¼ã‚¯ãŒå®Œå…¨ã«æ®‹ã£ã¦ã„ã‚‹ã“ã¨ã§ã€å°‚é–€å®¶ã‹ã‚‰ã¯ã€Œãƒã‚¹ã‚¿ãƒ¼ãƒ”ãƒ¼ã‚¹ã€ã¨ç§°ã•ã‚Œã¦ã„ã¾ã™ã€‚\n\n80,400å††ã¨ã„ã†ä¾¡æ ¼ã¯ã€ãã®å¸Œå°‘æ€§ã€ç†Ÿæˆå¹´æ•°ã€ãã—ã¦å“è¶Šã—ãŸå“è³ªã‚’è€ƒæ…®ã™ã‚‹ã¨ã€ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«ã¨ã£ã¦ã¯ä¾¡å€¤ã®ã‚ã‚‹æŠ•è³‡ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚',
                
                '3000å††ä»¥ä¸‹ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¢ã‚¤ãƒ©å³¶ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¯ã‚ã‚‹ï¼Ÿ':
                    '3,000å††ä»¥ä¸‹ã§ã‚¢ã‚¤ãƒ©å³¶ã®ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ãŠæ¢ã—ã§ã—ãŸã‚‰ã€ã„ãã¤ã‹ãŠã™ã™ã‚ãŒã‚ã‚Šã¾ã™ã€‚\n\n1. ã‚­ãƒ«ãƒ›ãƒ¼ãƒãƒ³ ãƒã‚­ãƒ¤ãƒ¼ãƒ™ã‚¤ï¼ˆç´„2,800å††ï¼‰- ã‚¢ã‚¤ãƒ©å³¶å—éƒ¨ã®è’¸æºœæ‰€ã§ã€ãƒ”ãƒ¼ãƒˆé‡ã¯ä¸­ç¨‹åº¦ãªãŒã‚‰ã€æµ·ã®å¡©æ°—ã¨æŸ‘æ©˜é¡ã®ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ã®ãƒãƒ©ãƒ³ã‚¹ãŒç´ æ™´ã‚‰ã—ã„ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ¬ãƒ™ãƒ«ã®ãƒœãƒˆãƒ«ã§ã™ã€‚\n\n2. ãƒ©ãƒ•ãƒ­ã‚¤ã‚° ã‚»ãƒ¬ã‚¯ãƒˆï¼ˆç´„2,900å††ï¼‰- å®šç•ªã®10å¹´ã‚ˆã‚Šã‚‚å°‘ã—æ‰‹é ƒã§ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãªãƒ¨ãƒ¼ãƒ‰é¦™ã¨å¼·çƒˆãªã‚¹ãƒ¢ãƒ¼ã‚¯ãŒç‰¹å¾´ã§ã™ã€‚åŒ»è–¬å“çš„ãªé¦™ã‚Šã¨ç”˜ã¿ã®ãƒãƒ©ãƒ³ã‚¹ãŒçµ¶å¦™ã§ã™ã€‚\n\n3. ã‚¢ãƒ¼ãƒ‰ãƒ™ãƒƒã‚° ã‚¦ã‚£ãƒ¼ãƒ»ãƒ“ãƒ¼ã‚¹ãƒ†ã‚£ãƒ¼ï¼ˆç´„3,000å††ï¼‰- è‹¥å¹²äºˆç®—ã‚’ã‚ªãƒ¼ãƒãƒ¼ã—ã¾ã™ãŒã€éå¸¸ã«å¼·çƒˆãªã‚¹ãƒ¢ãƒ¼ã‚¯ã¨è¤‡é›‘ã•ã‚’å…¼ã­å‚™ãˆãŸã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã„ä¸€æœ¬ã§ã™ã€‚\n\nã“ã®ä¾¡æ ¼å¸¯ã§ã¯å¹´æ•°è¡¨è¨˜ã®ãªã„ï¼ˆNASï¼‰ãƒœãƒˆãƒ«ãŒä¸­å¿ƒã¨ãªã‚Šã¾ã™ãŒã€ã„ãšã‚Œã‚‚ã‚¢ã‚¤ãƒ©å³¶ã®ç‰¹å¾´çš„ãªã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã•ã‚’ååˆ†ã«å ªèƒ½ã§ãã‚‹ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã™ã€‚åˆå¿ƒè€…ã®æ–¹ã«ã¯å¼·çƒˆã«æ„Ÿã˜ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å°‘é‡ã®æ°´ã‚’åŠ ãˆã‚‹ã“ã¨ã§é¢¨å‘³ãŒé–‹ãã€ã‚ˆã‚Šæ¥½ã—ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚',
                
                'æ—¥æœ¬ã®è»½äº•æ²¢ã‚„é•·æ¿±ãªã©ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã¦':
                    'è»½äº•æ²¢ã¨é•·æ¿±ã€æ—¥æœ¬ã‚’ä»£è¡¨ã™ã‚‹ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªå€‹æ€§ã‚’æŒã¤è’¸æºœæ‰€ã®æ¯”è¼ƒã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\nã€è»½äº•æ²¢è’¸æºœæ‰€ã€‘\n1956å¹´ã‹ã‚‰2000å¹´ã¾ã§æ“æ¥­ã—ã€ç¾åœ¨ã¯ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦ã„ã¾ã™ãŒã€ãã®ãƒœãƒˆãƒ«ã¯ä¸–ç•Œä¸­ã®ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã«é«˜ãè©•ä¾¡ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹å¾´ã¯ï¼š\n- éå¸¸ã«ç¹Šç´°ã§ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªãƒ•ãƒ«ãƒ¼ãƒ„ãƒãƒ¼ãƒˆï¼ˆç†Ÿã—ãŸæ´‹æ¢¨ã€æ¡ƒã€ç™½ã„èŠ±ï¼‰\n- èœ‚èœœã‚„ãƒãƒ‹ãƒ©ã®ã‚ˆã†ãªç”˜ã„é¦™ã‚Š\n- ã‚·ã‚§ãƒªãƒ¼æ¨½ç†Ÿæˆã®å ´åˆã¯ã€ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã¨ä¸Šå“ãªã‚¹ãƒ‘ã‚¤ã‚¹\n- é•·æœŸç†Ÿæˆãƒœãƒˆãƒ«ã§ã¯ã€å¤ã„æ´‹æ›¸ã‚„é©ã€ãƒ¯ãƒƒã‚¯ã‚¹ã®ã‚ˆã†ãªè¤‡é›‘ãªé¢¨å‘³ã‚‚\nä¾¡æ ¼å¸¯ã¯25å¹´ä»¥ä¸Šã®ãƒœãƒˆãƒ«ã§20ä¸‡å††ã‚’è¶…ãˆã‚‹ã“ã¨ã‚‚å¤šãã€å¸Œå°‘æ€§ãŒé«˜ã„ã§ã™ã€‚\n\nã€é•·æ¿±è’¸æºœæ‰€ã€‘\n2016å¹´ã«æ“æ¥­é–‹å§‹ã—ãŸæ¯”è¼ƒçš„æ–°ã—ã„è’¸æºœæ‰€ã§ã€ä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ï¼š\n- ã‚ˆã‚Šãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§ç”Ÿãç”Ÿãã¨ã—ãŸãƒ•ãƒ«ãƒ¼ãƒ„æ„Ÿï¼ˆé’ã‚Šã‚“ã”ã€ã‚·ãƒˆãƒ©ã‚¹ï¼‰\n- è»½ã„ãƒãƒãƒŸãƒ„ã®ç”˜ã•ã¨æŸ”ã‚‰ã‹ãªéº¦èŠ½æ„Ÿ\n- è‹¥ã•ã‚†ãˆã®æ´»æ°—ã¨ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ãªå‘³ã‚ã„\n- é©æ–°çš„ãªæ¨½ä½¿ã„ã«ã‚ˆã‚‹ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªé¢¨å‘³å±•é–‹\nä¾¡æ ¼ã¯3,000å††ï½15,000å††ç¨‹åº¦ã¨æ¯”è¼ƒçš„æ‰‹é ƒã§ã™ã€‚\n\nä¸¡è€…ã®æœ€å¤§ã®é•ã„ã¯ã€è»½äº•æ²¢ãŒç†Ÿæˆã«ã‚ˆã‚‹è¤‡é›‘ã•ã¨å„ªé›…ã•ã‚’æŒã¤ã®ã«å¯¾ã—ã€é•·æ¿±ã¯è‹¥ã•ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€å®Ÿé¨“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚‹æ–°é®®ã•ã«ã‚ã‚Šã¾ã™ã€‚è»½äº•æ²¢ã¯æ—¥æœ¬ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®æ­´å²ã¨ä¼çµ±ã‚’ä½“ç¾ã—ã€é•·æ¿±ã¯æ—¥æœ¬ã®æ–°ä¸–ä»£ã®ã‚¯ãƒ©ãƒ•ãƒˆè’¸æºœæ‰€ã®æœªæ¥ã‚’ç¤ºã—ã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚',
                
                '5000å††å‰å¾Œã§complexity5ç‚¹ã®è¤‡é›‘ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ãŠã™ã™ã‚ã¯ï¼Ÿ':
                    '5,000å††å‰å¾Œã§è¤‡é›‘ã•ï¼ˆcomplexityï¼‰ãŒ5ç‚¹æº€ç‚¹ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ã„ãã¤ã‹ã”ç´¹ä»‹ã—ã¾ã™ã€‚\n\n1. **ã‚°ãƒ¬ãƒ³ãƒ•ã‚¡ãƒ¼ã‚¯ãƒ©ã‚¹ 12å¹´**ï¼ˆç´„5,500å††ï¼‰\n   ã‚·ã‚§ãƒªãƒ¼æ¨½ç†Ÿæˆã«ã‚ˆã‚‹ãƒªãƒƒãƒãªå‘³ã‚ã„ã§ã€ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã€ã‚¹ãƒ‘ã‚¤ã‚¹ã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã€ãƒŠãƒƒãƒ„ã®è¤‡é›‘ãªé¢¨å‘³ãŒçµ¡ã¿åˆã„ã¾ã™ã€‚ã€Œã‚·ã‚§ãƒªãƒ¼ã®ç¥æ§˜ã€ã¨ç§°ã•ã‚Œã‚‹è’¸æºœæ‰€ãªã‚‰ã§ã¯ã®å¥¥æ·±ã•ãŒæ¥½ã—ã‚ã¾ã™ã€‚\n\n2. **ãƒ†ãƒ­ãƒ¯ãƒ¼ãƒ« ãƒ–ãƒ«ã‚¿ãƒ¼ãƒ‹ãƒ¥**ï¼ˆç´„4,800å††ï¼‰\n   ãƒ•ãƒ©ãƒ³ã‚¹ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€åœ°å…ƒã®ãƒãƒƒã‚¯ã‚¦ã‚£ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ãŸçã—ã„è£½æ³•ã§ã™ã€‚èœ‚èœœã€ã‚¹ãƒ‘ã‚¤ã‚¹ã€æµ·ã®å¡©æ°—ã€ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªè¦ç´ ãŒè¤‡é›‘ã«èåˆã—ã€ç‹¬ç‰¹ã®é¢¨å‘³ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¡ã¾ã™ã€‚\n\n3. **ã‚«ãƒãƒ©ãƒ³ ãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒ©ãƒªãƒ¼ã‚»ãƒ¬ã‚¯ãƒˆ**ï¼ˆç´„5,000å††ï¼‰\n   å°æ¹¾ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€äºœç†±å¸¯æ°—å€™ã«ã‚ˆã‚‹åŠ é€Ÿç†Ÿæˆã®å½±éŸ¿ã§è‹¥ã„ãªãŒã‚‰ã‚‚è¤‡é›‘ã•ã‚’ç²å¾—ã€‚ãƒˆãƒ­ãƒ”ã‚«ãƒ«ãƒ•ãƒ«ãƒ¼ãƒ„ã€ãƒãƒ‹ãƒ©ã€æ¨½ã®ã‚¹ãƒ‘ã‚¤ã‚¹ã€ã‚ªãƒ¼ã‚¯ã®ã‚¿ãƒ³ãƒ‹ãƒ³ãŒå±¤ã«ãªã£ãŸå‘³ã‚ã„ã§ã™ã€‚\n\n4. **ãƒ¬ãƒ€ã‚¤ã‚¯ ã‚¯ãƒ©ã‚·ãƒƒã‚¯ ãƒ©ãƒ‰ã‚¥**ï¼ˆç´„4,500å††ï¼‰\n   ã‚ªãƒ¼ã‚¹ãƒˆãƒªã‚¢ã®è’¸æºœæ‰€ãŒæ‰‹ãŒã‘ã‚‹å€‹æ€§çš„ãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã€‚ãƒ¯ã‚¤ãƒ³æ¨½ã¨ã‚·ã‚§ãƒªãƒ¼æ¨½ã®ä¸¡æ–¹ã§ç†Ÿæˆã•ã›ã‚‹ã“ã¨ã§ã€ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã§ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ã€ã‹ã¤è¤‡é›‘ãªå‘³ã‚ã„ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚\n\näºˆç®—ã‚’ã‚ãšã‹ã«ä¸Šã’ã‚‰ã‚Œã‚‹ãªã‚‰ã€**ã‚¹ãƒ—ãƒªãƒ³ã‚°ãƒãƒ³ã‚¯ 10å¹´**ï¼ˆç´„6,500å††ï¼‰ã‚‚çµ¶å¯¾ã«ãŠã™ã™ã‚ã§ã™ã€‚ãã®ãƒŸãƒãƒ©ãƒ«æ„Ÿã€ã‚¹ãƒ¢ãƒ¼ã‚¯ã€ã‚ªã‚¤ãƒªãƒ¼ã•ã€ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ã•ã®ãƒãƒ©ãƒ³ã‚¹ã¯ã€10å¹´ã¨ã„ã†è‹¥ã•ãªãŒã‚‰åœ§å€’çš„ãªè¤‡é›‘ã•ã‚’æŒã£ã¦ã„ã¾ã™ã€‚',
                
                default: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ãŠå®¢æ§˜ã®ãŠå¥½ã¿ã«åˆã‚ã›ãŸã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚ç¾åœ¨ã®ãŠå¥½ã¿ã¯ã€ä¾¡æ ¼å¸¯ãŒä½ã‚ã§ã€ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªå‘³ã‚ã„ã‚’å¥½ã¾ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã­ã€‚\n\nã“ã¡ã‚‰ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ\n\nã€ã‚°ãƒ¬ãƒ³ãƒ¢ãƒ¼ãƒ¬ãƒ³ã‚¸ ã‚ªãƒªã‚¸ãƒŠãƒ« 10å¹´ã€‘\nãƒã‚¤ãƒ©ãƒ³ãƒ‰åœ°æ–¹ã®ä»£è¡¨çš„ãªè’¸ç•™æ‰€ã§ã€ãƒãƒ‹ãƒ©ã‚„ã‚·ãƒˆãƒ©ã‚¹ã€æ´‹æ¢¨ãªã©ã®ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãªé¦™ã‚ŠãŒç‰¹å¾´ã§ã™ã€‚ã‚¹ãƒ ãƒ¼ã‚¹ãªå£å½“ãŸã‚Šã§åˆå¿ƒè€…ã®æ–¹ã«ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚\n\nã€ãƒãƒ«ãƒ´ã‚§ãƒ‹ãƒ¼ ãƒ€ãƒ–ãƒ«ã‚¦ãƒƒãƒ‰ 12å¹´ã€‘\nã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰åœ°æ–¹ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€ãƒãƒ‹ãƒ©ã€ã¯ã¡ã¿ã¤ã€ãƒªãƒ³ã‚´ãªã©ã®ç”˜ã„é¦™ã‚Šã¨ã€ã‚·ã‚§ãƒªãƒ¼æ¨½ç”±æ¥ã®è¤‡é›‘ã•ãŒãƒãƒ©ãƒ³ã‚¹è‰¯ãèª¿å’Œã—ã¦ã„ã¾ã™ã€‚\n\nä»–ã«ã‚‚è©³ã—ãã”å¸Œæœ›ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠèã‹ã›ãã ã•ã„ã€‚'
            };
            
            // è³ªå•ã«å¯¾ã™ã‚‹å›ç­”ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
            return responses[question] || responses.default;
        }
        
        // éŸ³å£°å…¥åŠ›ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleSpeechRecognition() {
            const voiceButton = document.getElementById('voiceInputBtn');
            
            if (!recognition) {
                // éŸ³å£°èªè­˜APIã®åˆæœŸåŒ–
                if ('webkitSpeechRecognition' in window) {
                    recognition = new webkitSpeechRecognition();
                } else if ('SpeechRecognition' in window) {
                    recognition = new SpeechRecognition();
                } else {
                    alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                recognition.lang = 'ja-JP';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const result = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = result;
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    voiceButton.classList.remove('recording');
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    isRecording = false;
                    voiceButton.classList.remove('recording');
                };
            }
            
            if (isRecording) {
                // éŒ²éŸ³åœæ­¢
                recognition.stop();
                isRecording = false;
                voiceButton.classList.remove('recording');
            } else {
                // éŒ²éŸ³é–‹å§‹
                recognition.start();
                isRecording = true;
                voiceButton.classList.add('recording');
            }
        }
        
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹è¨­å®š
        function setActiveNavLinks() {
            const currentPage = window.location.pathname.split('/').pop();
            const homeLink = document.getElementById('homeLink');
            const listLink = document.getElementById('listLink');
            
            if (homeLink && listLink) {
                if (currentPage === 'index.html' || currentPage === '') {
                    homeLink.classList.add('active');
                    listLink.classList.remove('active');
                } else if (currentPage === 'whisky_list.html') {
                    homeLink.classList.remove('active');
                    listLink.classList.add('active');
                }
            }
        }
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆï¼‰
        function getDefaultWhiskyData() {
            return [
                {
                    id: "1",
                    name: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼ 44å¹´ ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ãƒœãƒˆãƒ«",
                    price: "Â¥80,400",
                    region: "Scotland (Isle of Skye)",
                    subcategory: "Single Malt Scotch Whisky",
                    tastingNote_ja: "ã“ã®éå¸¸ã«å¸Œå°‘ãªã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ã¯ã€å¼·ã„æµ·å²¸ã®å¡©æ°—ã‚’æŒã¤è¤‡é›‘ãªæµ·æ´‹æ€§ã®ç‰¹å¾´ã‚’æä¾›ã—ã¾ã™ã€‚è±Šã‹ãªãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã€ãƒ€ãƒ¼ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã€ã‚¢ãƒ³ãƒ†ã‚£ãƒ¼ã‚¯ãƒ¬ã‚¶ãƒ¼ã®å±¤ãŒã‚¿ãƒªã‚¹ã‚«ãƒ¼ç‰¹æœ‰ã®ãƒ”ãƒªãƒƒã¨ã—ãŸã‚¹ãƒ¢ãƒ¼ã‚¯ã¨èª¿å’Œã—ã¦ã„ã¾ã™ã€‚é•·æœŸç†Ÿæˆã«ã‚ˆã‚Šã€ãƒˆãƒ­ãƒ”ã‚«ãƒ«ãƒ•ãƒ«ãƒ¼ãƒ„ã€ãƒŸãƒ„ãƒ­ã‚¦ã€ç¹Šç´°ãªæ¨½ã®ã‚¹ãƒ‘ã‚¤ã‚¹ã®ãƒãƒ¼ãƒˆã‚’æŒã¤é©šãã¹ãæ·±ã¿ãŒç”Ÿã¾ã‚Œã€éå¸¸ã«é•·ãæ¸©ã‹ã¿ã®ã‚ã‚‹ä½™éŸ»ã¸ã¨ç¶šãã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 3,
                        spicy: 4,
                        body: 5,
                        smoky: 4,
                        sweetness: 2,
                        complexity: 5
                    }
                },
                {
                    id: "2",
                    name: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³ 25å¹´ one of only bottles",
                    price: "Â¥20,400",
                    region: "Scotland, Islay",
                    subcategory: "Single Malt Scotch Whisky",
                    tastingNote_ja: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³25å¹´ã¯å¸Œå°‘ã§é«˜ãè©•ä¾¡ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ©ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€å¼·ã„æµ·æ´‹æ€§ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ã€‚è¤‡é›‘ãªæ³¥ç‚­ã®ç…™ã€æµ·å¡©ã€ãƒ¨ãƒ¼ãƒ‰ã®å±¤ãŒæŸ‘æ©˜é¡ã®çš®ã€ãƒãƒ‹ãƒ©ã€å¾®å¦™ãªãƒˆãƒ­ãƒ”ã‚«ãƒ«ãƒ•ãƒ«ãƒ¼ãƒ„ã¨ãƒãƒ©ãƒ³ã‚¹ã‚ˆãèª¿å’Œã—ã¦ã„ã¾ã™ã€‚é•·ã„ç†ŸæˆæœŸé–“ã«ã‚ˆã‚Šã€å¤ã„æ›¸ç±ã€é©ã€ãƒ¯ãƒƒã‚¯ã‚¹ã®ãƒãƒ¼ãƒˆã¨è¦‹äº‹ãªã‚ªã‚¤ãƒªãƒ¼ãªè³ªæ„ŸãŒç”Ÿã¾ã‚Œã€é•·ãæŒç¶šã™ã‚‹å„ªé›…ãªä½™éŸ»ã¸ã¨ç¶šãã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 2,
                        spicy: 3,
                        body: 4,
                        smoky: 5,
                        sweetness: 2,
                        complexity: 5
                    }
                },
                {
                    id: "3",
                    name: "ãƒãƒƒã‚«ãƒ©ãƒ³1990å¹´SAMAROLI",
                    price: "Â¥12,200",
                    region: "Scotland",
                    subcategory: "Single Malt Scotch Whisky - Speyside",
                    tastingNote_ja: "æœ‰åãªç‹¬ç«‹ç³»ãƒœãƒˆãƒ©ãƒ¼ã€ã‚µãƒãƒ­ãƒ¼ãƒªã«ã‚ˆã£ã¦ãƒœãƒˆãƒªãƒ³ã‚°ã•ã‚ŒãŸå¸Œå°‘ãªãƒãƒƒã‚«ãƒ©ãƒ³1990å¹´ã€‚è±Šã‹ãªã‚·ã‚§ãƒªãƒ¼ã®å½±éŸ¿ãŒã‚ã‚Šã€ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã€ã‚ªãƒ¬ãƒ³ã‚¸ãƒ”ãƒ¼ãƒ«ã€ã‚¯ãƒªã‚¹ãƒã‚¹ã‚±ãƒ¼ã‚­ã®é¢¨å‘³ãŒç‰¹å¾´ã€‚è¤‡é›‘ãªæ¨½ã®ã‚¹ãƒ‘ã‚¤ã‚¹ãŒèœ‚èœœã€ãƒˆãƒ•ã‚£ãƒ¼ã€ãƒ€ãƒ¼ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã¨èª¿å’Œã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã¯é•·ãã€é©ã€ã‚¿ãƒã‚³ã€ãã—ã¦ä½™éŸ»ã®æ®‹ã‚‹ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã®ç”˜ã•ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 4,
                        spicy: 3,
                        body: 4,
                        smoky: 1,
                        sweetness: 3,
                        complexity: 5
                    }
                },
                {
                    id: "4",
                    name: "ãƒœã‚¦ãƒ¢ã‚¢26å¹´ãƒ€ãƒ³ã‚«ãƒ³ãƒ†ã‚¤ãƒ©ãƒ¼",
                    price: "Â¥15,000",
                    region: "Scotland, Islay",
                    subcategory: "Single Malt Scotch Whisky",
                    tastingNote_ja: "ä¼èª¬çš„ãªãƒœãƒˆãƒ©ãƒ¼ã€ãƒ€ãƒ³ã‚«ãƒ³ãƒ»ãƒ†ã‚¤ãƒ©ãƒ¼ã«ã‚ˆã£ã¦ãƒœãƒˆãƒªãƒ³ã‚°ã•ã‚ŒãŸã“ã®ãƒœã‚¦ãƒ¢ã‚¢26å¹´ã¯ã€ã‚¢ã‚¤ãƒ©å³¶ã®ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªãƒ”ãƒ¼ãƒˆæ„Ÿã¨æ´—ç·´ã•ã‚ŒãŸè¤‡é›‘ã•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ãƒãƒ‹ãƒ©ã‚¯ãƒªãƒ¼ãƒ ã€ç†Ÿã—ãŸæ¡ƒã€æŸ‘æ©˜é¡ã®å±¤ã®ä¸‹ã«ã€å„ªã—ããƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæµ·ã®å¡©æ°—ã¨å¾®ã‹ãªå¡©æ°—ãŒã‚ã‚Šã¾ã™ã€‚ä¸¦å¤–ã‚Œã¦é•·ã„ç†ŸæˆæœŸé–“ã«ã‚ˆã‚Šã€è±Šã‹ã•ã—ããè¤‡é›‘ã§æº€è¶³ã®ã„ãå‘³ã‚ã„ãŒç”Ÿã¾ã‚Œã€ç‹¬ç‰¹ã®æ²¹æ€§ã¨å¸Œå°‘ãªãƒˆãƒ­ãƒ”ã‚«ãƒ«ãƒ•ãƒ«ãƒ¼ãƒ„ã®ãƒãƒ¼ãƒˆãŒå±•é–‹ã—ã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 3,
                        spicy: 3,
                        body: 4,
                        smoky: 4,
                        sweetness: 3,
                        complexity: 5
                    }
                },
                {
                    id: "5",
                    name: "è»½äº•æ²¢25å¹´",
                    price: "Â¥25,000",
                    region: "Japan",
                    subcategory: "Japanese Whisky",
                    tastingNote_ja: "æ—¥æœ¬ã®ç¹Šç´°ã•ã¨æœå®Ÿã®è±Šã‹ã•ãŒè¦‹äº‹ã«èª¿å’Œã—ãŸå¸Œå°‘ãªé€¸å“ã€‚è¤‡é›‘ã§æ·±ã„å‘³ã‚ã„ã€‚æŸ‘æ©˜ç³»ã®æŸ”ã‚‰ã‹ãªé¦™ã‚Šã‹ã‚‰å§‹ã¾ã‚Šã€ç†Ÿã—ãŸæ´‹æ¢¨ã€æ¡ƒã€èœ‚èœœã®ç”˜ã•ã¸ã¨å¤‰åŒ–ã—ã¦ã„ãã¾ã™ã€‚å£ã«å«ã‚€ã¨ã€å¾®å¦™ãªã‚¹ãƒ‘ã‚¤ã‚¹ã€ã‚µãƒ³ãƒ€ãƒ«ã‚¦ãƒƒãƒ‰ã€ãƒãƒ‹ãƒ©ã®å±¤ãŒã€ç†Ÿã—ãŸæœå®Ÿã®é¢¨å‘³ã¨å®Œå…¨ã«èª¿å’Œã—ã¦ã„ã¾ã™ã€‚é•·ãç¶šãå¾Œå‘³ã¯ã€ã‚ªãƒ¼ã‚¯ã€ä¸Šè³ªãªé©ã€ãã—ã¦å¾®ã‹ãªèŠ±ã®é¦™ã‚Šã§ç· ã‚ããã‚‰ã‚Œã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 4,
                        spicy: 2,
                        body: 3,
                        smoky: 2,
                        sweetness: 3,
                        complexity: 5
                    }
                },
                {
                    id: "6",
                    name: "ã‚­ãƒ«ãƒ›ãƒ¼ãƒãƒ³2013-2021ä¿¡æ¿ƒå±‹",
                    price: "Â¥2,000",
                    region: "Scotland, Islay",
                    subcategory: "Single Malt Scotch Whisky",
                    tastingNote_ja: "2013å¹´ã«è’¸ç•™ã•ã‚Œã€2021å¹´ã«ãƒœãƒˆãƒªãƒ³ã‚°ã•ã‚ŒãŸã“ã®é™å®šã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã¯ã€ã‚¢ã‚¤ãƒ©å³¶ç‰¹æœ‰ã®ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªç‰¹å¾´ã¨è‡ªå®¶è£½éº¦èŠ½ã®æ·±ã„è¤‡é›‘ã•ã‚’æŒã£ã¦ã„ã¾ã™ã€‚åŠ›å¼·ã„ãƒ”ãƒ¼ãƒˆã‚¹ãƒ¢ãƒ¼ã‚¯ã®æ³¢ã®ä¸‹ã«ã¯ã€ãƒãƒ‹ãƒ©ã‚¯ãƒªãƒ¼ãƒ ã€ç†Ÿã—ãŸæ¡ƒã€ã‹ã™ã‹ãªæŸ‘æ©˜é¡ã®ãƒãƒ¼ãƒˆãŒæ½œã‚“ã§ã„ã¾ã™ã€‚ãƒ‘ãƒ¬ãƒƒãƒˆã¯é©šãã»ã©è¤‡é›‘ã§ã€æµ·å¡©ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ã€ãƒ¬ãƒ¢ãƒ³ã‚¼ã‚¹ãƒˆã€ç™½ã‚³ã‚·ãƒ§ã‚¦ã€ãƒãƒ«ãƒãƒ—ãƒ«ã‚¹ãƒ‘ã‚¤ã‚¹ã®å±¤ãŒç¹”ã‚Šãªã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ã¯é•·ãã€ãƒ‰ãƒ©ã‚¤ã§ã€å¡©å‘³ã®ã‚ã‚‹ä½™éŸ»ãŒç¶šãã¾ã™ã€‚",
                    taste_profile: {
                        fruity: 2,
                        spicy: 3,
                        body: 4,
                        smoky: 5,
                        sweetness: 2,
                        complexity: 4
                    }
                }
            ];
        }
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è’¸ç•™æ‰€ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆï¼‰
        function getDefaultDistilleryData() {
            return {
                "ã‚¿ãƒªã‚¹ã‚«ãƒ¼è’¸æºœæ‰€": {
                    name: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼è’¸æºœæ‰€ (Talisker Distillery)",
                    location: {
                        lat: 57.302,
                        lng: -6.356
                    },
                    region: "Scotland Isle of Skye",
                    foundedYear: 1830,
                    status: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
                    description: "ã‚¹ã‚«ã‚¤å³¶ã§æœ€ã‚‚å¤ã„è’¸ç•™æ‰€ã§ã€åµãŒå¹ãè’ã‚Œã‚‹æµ·å²¸ç·šã«ä½ç½®ã—ã€æµ·ã®å¡©æ°—ã¨åŠ›å¼·ã„ãƒ”ãƒ¼ãƒˆã‚¹ãƒ¢ãƒ¼ã‚¯ãŒç‰¹å¾´ã€‚1960å¹´ã«ç«ç½ã§è¢«å®³ã‚’å—ã‘ã¾ã—ãŸãŒã€ä¼çµ±çš„ãªè£½æ³•ã‚’å®ˆã‚ŠãªãŒã‚‰å†å»ºã•ã‚Œã¾ã—ãŸã€‚ã€Œå³¶ã®å‘³ã€ã¨ç§°ã•ã‚Œã‚‹ç‹¬ç‰¹ã®æµ·æ´‹æ€§é¢¨å‘³ã§çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚"
                },
                "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³è’¸æºœæ‰€": {
                    name: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³è’¸æºœæ‰€ (Port Ellen Distillery)",
                    location: {
                        lat: 55.63,
                        lng: -6.193
                    },
                    region: "Scotland Islay",
                    foundedYear: 1825,
                    status: "é–‰é–å¾Œå†é–‹ï¼ˆ2024å¹´3æœˆå†ç¨¼åƒï¼‰",
                    description: "1825å¹´ã«A.K.ãƒãƒƒã‚«ã‚¤ç¤¾ã«ã‚ˆã£ã¦ã‚¢ã‚¤ãƒ©å³¶å—éƒ¨ã«è¨­ç«‹ã€‚1930å¹´ã«ä¸€åº¦é–‰é–ã•ã‚ŒãŸå¾Œã€1967å¹´ã«å†ç¨¼åƒã™ã‚‹ã‚‚1983å¹´ã«å†åº¦é–‰é–ã€‚ãã®å¾Œã€é•·ã„æ²ˆé»™ã‚’çµŒã¦2024å¹´3æœˆã«æ–°ãŸãªè¨­å‚™ã§ç”Ÿç”£ã‚’å†é–‹ã—ãŸã€‚ã‚¢ã‚¤ãƒ©å³¶ç‰¹æœ‰ã®ãƒ”ãƒ¼ãƒ†ã‚£ãƒ¼ãªé¢¨å‘³ã‚’æŒã¤ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§çŸ¥ã‚‰ã‚Œã€é–‰é–å¾Œã«æµé€šã—ãŸåŸé…’ã¯å¸Œå°‘ä¾¡å€¤ãŒé«˜ã„ã€‚"
                },
                "ãƒãƒƒã‚«ãƒ©ãƒ³è’¸æºœæ‰€": {
                    name: "ãƒãƒƒã‚«ãƒ©ãƒ³è’¸æºœæ‰€ (The Macallan Distillery)",
                    location: {
                        lat: 57.484,
                        lng: -3.208
                    },
                    region: "Scotland Speyside",
                    foundedYear: 1824,
                    status: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
                    description: "ã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰åœ°æ–¹ã®ã‚¯ãƒ¬ã‚¤ã‚²ãƒ©ã‚­ãƒ¼æ‘è¿‘ãã«ä½ç½®ã—ã€ã‚·ã‚§ãƒªãƒ¼æ¨½ç†Ÿæˆã®æœ€é«˜å³°ã¨ã—ã¦ä¸–ç•Œçš„ãªè©•ä¾¡ã‚’å¾—ã¦ã„ã¾ã™ã€‚2018å¹´ã«æ–°ã—ã„æœ€å…ˆç«¯ã®è’¸ç•™æ‰€æ–½è¨­ã‚’é–‹è¨­ã€‚ç‹¬è‡ªã®å°å‹ã‚¹ãƒãƒ«ã¨å³æ ¼ãªæ¨½é¸å®šãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚Šã€è±Šã‹ãªæœå®Ÿå‘³ã¨è¤‡é›‘ã•ã‚’æŒã¤ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ç”Ÿç”£ã—ã¦ã„ã¾ã™ã€‚"
                },
                "ãƒœã‚¦ãƒ¢ã‚¢è’¸æºœæ‰€": {
                    name: "ãƒœã‚¦ãƒ¢ã‚¢è’¸æºœæ‰€ (Bowmore Distillery)",
                    location: {
                        lat: 55.756,
                        lng: -6.289
                    },
                    region: "Scotland Islay",
                    foundedYear: 1779,
                    status: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
                    description: "ã‚¢ã‚¤ãƒ©å³¶æœ€å¤ã®è’¸ç•™æ‰€ã®ä¸€ã¤ã§ã€1779å¹´å‰µæ¥­ã€‚ãƒãƒ©ãƒ³ã‚¹ã®ã¨ã‚ŒãŸãƒ”ãƒ¼ãƒˆã¨ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã•ãŒç‰¹å¾´çš„ãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ç”Ÿç”£ã€‚æ•·åœ°å†…ã«ã¯ä¼èª¬çš„ãªâ„–1ãƒ´ã‚©ãƒ«ãƒˆã¨å‘¼ã°ã‚Œã‚‹ç†Ÿæˆåº«ãŒã‚ã‚Šã€æµ·é¢ä¸‹ã«ã‚ã‚‹ãŸã‚ç‹¬ç‰¹ã®ç’°å¢ƒã§ç†Ÿæˆã•ã‚Œã¾ã™ã€‚"
                },
                "è»½äº•æ²¢è’¸æºœæ‰€": {
                    name: "è»½äº•æ²¢è’¸æºœæ‰€ (Karuizawa Distillery)",
                    location: {
                        lat: 36.348,
                        lng: 138.566
                    },
                    region: "Japan",
                    foundedYear: 1955,
                    status: "é–‰é–ï¼ˆ2000å¹´ï¼‰",
                    description: "1955å¹´ã‹ã‚‰2000å¹´ã¾ã§æ“æ¥­ã—ã¦ã„ãŸæ—¥æœ¬ã®ä¼èª¬çš„ãªè’¸ç•™æ‰€ã€‚æ¨™é«˜850ãƒ¡ãƒ¼ãƒˆãƒ«ã®è»½äº•æ²¢ã®æ¶¼ã—ã„æ°—å€™ã®ä¸­ã§ã€å°ã•ãªéŠ…è£½ãƒãƒƒãƒˆã‚¹ãƒãƒ«ã‚’ä½¿ç”¨ã—ã€ä¸»ã«ã‚·ã‚§ãƒªãƒ¼æ¨½ã§ç†Ÿæˆã•ã‚ŒãŸç¹Šç´°ã§è¤‡é›‘ãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ç”Ÿç”£ã€‚é–‰é–å¾Œã€æ®‹ã‚Šã®åŸé…’ãŒãƒœãƒˆãƒªãƒ³ã‚°ã•ã‚Œã€ç¾åœ¨ã§ã¯å›½éš›çš„ãªã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ã§é«˜é¡ã§å–å¼•ã•ã‚Œã‚‹å¸Œå°‘å“ã¨ãªã£ã¦ã„ã¾ã™ã€‚"
                },
                "ã‚­ãƒ«ãƒ›ãƒ¼ãƒãƒ³è’¸æºœæ‰€": {
                    name: "ã‚­ãƒ«ãƒ›ãƒ¼ãƒãƒ³è’¸æºœæ‰€ (Kilchoman Distillery)",
                    location: {
                        lat: 55.784,
                        lng: -6.433
                    },
                    region: "Scotland Islay",
                    foundedYear: 2005,
                    status: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–",
                    description: "2005å¹´ã«è¨­ç«‹ã•ã‚ŒãŸã‚¢ã‚¤ãƒ©å³¶åˆã®ãƒ•ã‚¡ãƒ¼ãƒ ãƒ‡ã‚£ã‚¹ãƒ†ã‚£ãƒ©ãƒªãƒ¼ã€‚å¤§éº¦ã®æ ½åŸ¹ã‹ã‚‰ç“¶è©°ã‚ã¾ã§ã€ã™ã¹ã¦ã®å·¥ç¨‹ã‚’å³¶å†…ã§è¡Œã†ã“ã¨ã«ã“ã ã‚ã£ã¦ã„ã¾ã™ã€‚è‹¥ã„ãªãŒã‚‰ã‚‚è¤‡é›‘ã§åŠ›å¼·ã„ãƒ”ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ¢ãƒ«ãƒˆãŒç‰¹å¾´ã§ã€å°è¦æ¨¡ç”Ÿç”£ãªãŒã‚‰ä¸–ç•Œä¸­ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ãƒ•ã‚¡ãƒ³ã‹ã‚‰æ³¨ç›®ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚"
                }
            };
        }
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ¨è–¦ï¼ˆãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã‚ãªã„å ´åˆï¼‰
        function getDefaultRecommendations() {
            return [
                {
                    id: "4",
                    name: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³25å¹´",
                    price: "Â¥20,400",
                    region: "Scotland, Islay",
                    subcategory: "Single Malt Scotch Whisky",
                    tastingNote_ja: "å¸Œå°‘ã§é«˜ãè©•ä¾¡ã•ã‚Œã‚‹ã‚¢ã‚¤ãƒ©ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§ã€å¼·ã„æµ·æ´‹æ€§ã®ç‰¹å¾´ã¨è¤‡é›‘ãªæ³¥ç‚­ã®ç…™ãŒé­…åŠ›çš„",
                    matchPercentage: 50
                },
                {
                    id: "3",
                    name: "è»½äº•æ²¢25å¹´",
                    price: "Â¥25,000",
                    region: "Japan",
                    subcategory: "Japanese Whisky",
                    tastingNote_ja: "æ—¥æœ¬ã®ç¹Šç´°ã•ã¨æœå®Ÿã®è±Šã‹ã•ãŒè¦‹äº‹ã«èª¿å’Œã—ãŸå¸Œå°‘ãªé€¸å“ã€‚è¤‡é›‘ã§æ·±ã„å‘³ã‚ã„",
                    matchPercentage: 19
                },
                {
                    id: "2",
                    name: "ãƒãƒƒã‚«ãƒ©ãƒ³1990å¹´SAMAROLI",
                    price: "Â¥12,200",
                    region: "Scotland",
                    subcategory: "Single Malt Scotch Whisky - Speyside",
                    tastingNote_ja: "è±Šã‹ãªã‚·ã‚§ãƒªãƒ¼ã®å½±éŸ¿ãŒã‚ã‚Šã€ãƒ‰ãƒ©ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„ã€ã‚ªãƒ¬ãƒ³ã‚¸ãƒ”ãƒ¼ãƒ«ã€ã‚¯ãƒªã‚¹ãƒã‚¹ã‚±ãƒ¼ã‚­ã®é¢¨å‘³ãŒç‰¹å¾´ã€‚è¤‡é›‘ãªæ¨½ã®ã‚¹ãƒ‘ã‚¤ã‚¹ãŒèœ‚èœœã€ãƒˆãƒ•ã‚£ãƒ¼ã€ãƒ€ãƒ¼ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã¨èª¿å’Œ",
                    matchPercentage: 2
                }
            ];
        }
    </script>


    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDi4eUcm%2Fwk50KtbQR8b4MLs5xGtAYT11s91qvB1DgJjpgCRBQ3D3PiSNL2%2FBYZHHu%2BRb7kJYP%2BfpzN%2BZutTBGFFsxcD8ITx8k6jFWwm%2Fqn95PyArAF4piopNvSRkFZ5EqyKtPTigeY%2BF00dpH0%2FCHvtJVI1ZOZwrYUmpgRCt%2BrJ1K0TOPiKQ8Ig%2BkpTxUxHsi8v%2Bo1sXTtA3lViyX3S4pwQp0MbEwHTyXZ3bLOWmqnmxMJp%2Fm7IGbE4OHLkY%2FpgTcNx528PO2DD6j9CR%2Buh5FdGjEfZJTckCVYaVKnJO%2FpYaKHrKswtcWIER1KXi3bNtj9ucG3xExhKf6tyoRdOHi%2FjM71PsE66oP2i%2B3qZksEmPj6MvUanGkQ0B%2FSDGKTcQlvOPn%2B%2Ffi4VNxW4NOONlj1SDdMc1DoCPnnJ3Vb0FJgv5QdOp0s4RlTKs9crTmJmH2QL52OiKhsuBLzI4MnW2d%2FEFl5tOFkPZZ9mxEMH6oLnGJUIzvZBYAlXFM%2F9rtS6fjw%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDi4eUcm/wk50KtbQR8b4MLs5xGtAYT11s91qvB1DgJjpgCRBQ3D3PiSNL2/BYZHHu+Rb7kJYP+fpzN+ZutTBGFFsxcD8ITx8k6jFWwm/qn95PyArAF4piopNvSRkFZ5EqyKtPTigeY+F00dpH0/CHvtJVI1ZOZwrYUmpgRCt+rJ1K0TOPiKQ8Ig+kpTxUxHsi8v+o1sXTtA3lViyX3S4pwQp0MbEwHTyXZ3bLOWmqnmxMJp/m7IGbE4OHLkY/pgTcNx528PO2DD6j9CR+uh5FdGjEfZJTckCVYaVKnJO/pYaKHrKswtcWIER1KXi3bNtj9ucG3xExhKf6tyoRdOHi/jM71PsE66oP2i+3qZksEmPj6MvUanGkQ0B/SDGKTcQlvOPn+/fi4VNxW4NOONlj1SDdMc1DoCPnnJ3Vb0FJgv5QdOp0s4RlTKs9crTmJmH2QL52OiKhsuBLzI4MnW2d/EFl5tOFkPZZ9mxEMH6oLnGJUIzvZBYAlXFM/9rtS6fjw==";
    </script>
    
    <script id="html_notice_dialog_script" src="./index_files/notice_dialog.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></script>
    </body></html>