<!DOCTYPE html>
<!-- saved from url=(0130)https://gensparkpublicblob.blob.core.windows.net/user-upload-image/page/tooluse_LBd2w0vdTtOf_OswSt8juA/whisky_sommelier_final.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- HTMLã®headã‚¿ã‚°å†…ã«Google Fontsã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ  -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¼ã®æœˆã€‚AIã‚½ãƒ ãƒªã‚¨</title>
    <link href="./index_files/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./index_files/all.min.css">
    <script src="./index_files/chart.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></script>
    <!-- Leaflet.jsåœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <link rel="stylesheet" href="./index_files/leaflet.css" crossorigin="">
    <script src="./index_files/leaflet.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" crossorigin=""></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Noto Sans JP', sans-serif;
        }
        .header-container {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo {
            width: 90px;
            height: 90px;
            object-fit: contain;
            border-radius: 8px;
            background: rgba(78, 205, 197, 0);
            border: 2px solid #4ecdc500;
            padding: 5px;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´ */
        .header-title {
            color: #fff;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            margin: 0;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.7);
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ffffff, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        .header-title:after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(78, 205, 196, 0.7), transparent);
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px rgba(78, 205, 196, 0.5);
            }
            to {
                text-shadow: 0 0 15px rgba(78, 205, 196, 0.8), 0 0 20px rgba(255, 107, 107, 0.5);
            }
        }

        /* ç¿»è¨³ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .translate-link {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 5px 10px;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .translate-link:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateY(-2px);
        }

        .translate-icon {
            margin-right: 6px;
        }

        /* è¨€èªãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .language-links {
            display: flex;
            margin-left: 15px;
        }

        .language-links .nav-link {
            margin-left: 10px;
            font-size: 14px;
            padding: 5px 8px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ - ç”»é¢ãŒç‹­ã„å ´åˆ */
        @media (max-width: 768px) {
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .language-links {
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
        }

        .container-custom {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px 20px;
        }
        .taste-matrix {
            width: 300px;
            height: 300px;
            border: 2px solid #fff;
            position: relative;
            background: linear-gradient(to right, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%), 
                        linear-gradient(to top, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%);
        }
        .taste-dot {
            width: 24px;
            height: 24px;
            background-color: #ff6b6b;
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }
        .dual-matrix-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 20px;
        }
        .matrix-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .matrix-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #4ecdc4;
        }
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
        }

        /* è¦‹å‡ºã—ã®ä½™ç™½ã‚’èª¿æ•´ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .card h2 {
            padding-top: 0px;      /* ä¸Šéƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
            padding-bottom: 15px;   /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
            line-height: 0.8;       /* è¡Œã®é«˜ã•ã‚’èª¿æ•´ */
            margin-bottom: 20px;    /* ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’è¨­å®šï¼ˆmb-4ã‚’ä¸Šæ›¸ãï¼‰ */
        }

        /* split-layoutã®èª¿æ•´ - ãƒ‘ãƒãƒ«é–“ã®é–“éš”ã‚’åºƒã’ã‚‹ */
        .split-layout {
            gap: 400px;               /* ãƒ‘ãƒãƒ«é–“ã®é–“éš”ã‚’ã‚ˆã‚Šåºƒã */
        }

        .whisky-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .whisky-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: #4ecdc4;
            transform: translateY(-2px);
        }
        .whisky-card.selected {
            background: rgba(78, 205, 196, 0.15);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        .whisky-card.featured {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 215, 0, 0.10));
            border: 2px solid #FFA500;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.4);
            animation: pulse-orange 2s infinite;
        }
        @keyframes pulse-orange {
            0% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.6); }
            100% { box-shadow: 0 0 20px rgba(255, 165, 0, 0.4); }
        }
        .featured-label {
            position: absolute;
            top: -10px;
            right: 10px;
            background: linear-gradient(45deg, #FFA500, #FFD700);
            color: #000;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .loading {
            display: none;
            text-align: center;
            color: #4ecdc4;
        }
        .progress-container {
            display: none;
            margin-top: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            width: 0%;
            transition: width 0.3s ease;
        }
        .progress-text {
            color: #4ecdc4;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .progress-percentage {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        .success {
            color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        .price-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            margin: 10px 0;
        }
        .price-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
        }
        .price-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ecdc4;
            cursor: pointer;
            border: none;
        }
        .voice-input-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .voice-input-btn:hover {
            background: rgba(78, 205, 196, 0.3);
        }
        .voice-input-btn.recording {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }
        
       /* split-layoutã®ä¿®æ­£ - ä½™ç™½ã‚’å¢—ã‚„ã™ */
        .split-layout {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å‡ç­‰ã«åˆ†å‰² */
            gap: 30px; /* é–“éš”ã‚’åºƒã’ã‚‹ï¼ˆå…ƒã¯20pxï¼‰ */
            align-items: start;
            margin-bottom: 30px; /* ä¸‹éƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
        }
        
        /* ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ«ã®ä¿®æ­£ */
        .recommendations-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
            max-height: 85vh; /* å°‘ã—é«˜ã•ã‚’å¢—ã‚„ã™ */
            overflow-y: auto;
            margin-bottom: 30px; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆãƒ‘ãƒãƒ«ã®ä¿®æ­£ - é‡è¦ãªä¿®æ­£éƒ¨åˆ† */
        .chart-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px 20px; /* ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™ */
            backdrop-filter: blur(10px);
            position: sticky;
            top: 130px; /* å°‘ã—ä¸‹ã’ã‚‹ */
            max-height: 85vh; /* å°‘ã—é«˜ã•ã‚’å¢—ã‚„ã™ */
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(78, 205, 196, 0.5) rgba(255, 255, 255, 0.1);
            margin-bottom: 20px; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }
        
        .chart-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .chart-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .chart-panel::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 4px;
        }
        
        /* ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠã®ä¿®æ­£ */
        .chart-container {
            height: 380px; /* é«˜ã•ã‚’å¢—ã‚„ã™ï¼ˆå…ƒã¯350pxï¼‰ */
            width: 100%;
            position: relative;
            margin-bottom: 30px; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }
        /* ãƒãƒ£ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠã®è¦‹å‡ºã—ä¿®æ­£ */
        .chart-container h3 {
            text-align: center;
            margin-bottom: 25px; /* ä½™ç™½ã‚’å¢—ã‚„ã™ */
            color: #4ecdc4;
            font-size: 16px;
            padding-top: 10px; /* ä¸Šéƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }
        /* ãƒãƒ£ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒã‚¹ã®ä¿®æ­£ */
        .chart-canvas {
            height: 350px !important;
            width: 100% !important;
            margin-top: 15px; /* ä¸Šéƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }

        #combinedProfileChart {
            height: 350px !important; /* é«˜ã•ã‚’å¢—ã‚„ã™ï¼ˆå…ƒã¯320pxï¼‰ */
            width: 100% !important;
            margin-top: 20px; /* ä¸Šéƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
            margin-bottom: 20px; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
        }
        .recommendation-summary {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            color: #4ecdc4;
        }
        
        .custom-footer {
            display: none;
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 40px;
        }
        
        .whisky-overview {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(255, 107, 107, 0.1));
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .whisky-overview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .whisky-overview h2 {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #4ecdc4, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        
        .whisky-overview .subtitle {
            font-size: 1.2rem;
            color: #4ecdc4;
            margin-bottom: 15px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .whisky-overview .description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            z-index: 1;
        }
        
        .whisky-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            margin-bottom: 24px;  /* ä¸‹ãƒãƒ¼ã‚¸ãƒ³ã‚’å¢—ã‚„ã™ï¼ˆæ•°å€¤ã¯èª¿æ•´å¯èƒ½ï¼‰ */
            position: relative;
            z-index: 1;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }
        
        .taste-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            fill: #4ecdc4;
        }

        .chat-section {
            margin-top: 30px;
        }

        .chat-examples {
            display: grid;
            grid-template-columns: 1fr 1fr;  /* 2åˆ—ã«è¨­å®š */
            grid-template-rows: auto auto;   /* 2è¡Œã«è¨­å®š */
            gap: 10px;
            background: rgba(78, 205, 196, 0.05);
            border: 1px solid rgba(78, 205, 196, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        /* è³ªå•ä¾‹ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¨å¹…ã« */
        .chat-examples .mb-3 {
            grid-column: 1 / -1;  /* 1åˆ—ç›®ã‹ã‚‰æœ€å¾Œã®åˆ—ã¾ã§åºƒã’ã‚‹ */
        }

        .question-example {
            /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            display: flex;
            align-items: center;
            justify-content: center;  /* æ¨ªæ–¹å‘ã‚‚ä¸­å¤®æƒãˆ */
            height: 100%;
            margin-bottom: 0;
            padding: 8px 12px;
            
            /* ã‚¹ã‚¿ã‚¤ãƒ« */
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 6px;
            color: #4ecdc4;
            
            /* ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* ãƒ›ãƒãƒ¼åŠ¹æœã¯ç¶­æŒ */
        .question-example:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateY(-1px);
        }

        .question-example:hover {
            background: rgba(78, 205, 196, 0.2);
            transform: translateY(-1px);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
        }

        .chat-history {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 14px;
        }

        /* AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
        .ai-message {
            text-align: left;  /* å·¦å¯„ã›ã«è¨­å®š */
            background: rgba(78, 205, 196, 0.15);
            border-left: 3px solid #4ecdc4;
            color: #fff;
        }

        /* å¿…è¦ã«å¿œã˜ã¦é€šå¸¸ã®ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚å·¦å¯„ã›ã« */
        .chat-message {
            text-align: left;  /* å·¦å¯„ã›ã«è¨­å®š */
            /* ãã®ä»–ã®æ—¢å­˜ã‚¹ã‚¿ã‚¤ãƒ« */
        }

        .user-message {
            background: rgba(255, 107, 107, 0.15);
            border-left: 3px solid #ff6b6b;
            color: #fff;
        }

        .chat-history::-webkit-scrollbar {
            width: 6px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 3px;
        }
        
       /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®ä¿®æ­£ */
        @media (max-width: 1024px) {
            .split-layout {
                grid-template-columns: 1fr;
                gap: 30px; /* é–“éš”ã‚’åºƒã’ã‚‹ */
            }
            
            .chart-panel {
                position: static;
                margin-top: 30px; /* ä¸Šéƒ¨ã®ä½™ç™½ã‚’è¿½åŠ  */
                padding: 30px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‡ç­‰ã« */
            }
            
            .whisky-overview h2 {
                font-size: 2rem;
            }
            
            .whisky-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .dual-matrix-container {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .custom-footer {
                display: block;
            }
            
            .whisky-overview h2 {
                font-size: 1.8rem;
            }
            
            .whisky-overview .subtitle {
                font-size: 1rem;
            }
            
            .whisky-overview .description {
                font-size: 1rem;
            }
        }
        
        .recommendations-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .recommendations-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .recommendations-panel::-webkit-scrollbar-thumb {
            background: rgba(78, 205, 196, 0.5);
            border-radius: 4px;
        }
        
        .recommendations-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(78, 205, 196, 0.7);
        }

        /* è’¸ç•™æ‰€ãƒãƒƒãƒ—ã¨æƒ…å ±ãƒ‘ãƒãƒ« */
        .distillery-section {
            margin-top: 20px;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.8s ease, height 0.8s ease;
        }

        .distillery-section.active {
            opacity: 1;
            height: auto;
        }

        .distillery-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-container {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(78, 205, 196, 0.3);
            background-color: #1a1a1a;
        }

        #distilleryMap {
            height: 100%;
            width: 100%;
            background-color: #242424;
        }

        .distillery-info {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 12px;
            padding: 16px;
            color: #fff;
        }

        .distillery-info h3 {
            color: #4ecdc4;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(78, 205, 196, 0.3);
            padding-bottom: 8px;
        }

        .distillery-info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px 16px;
            margin-top: 15px;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }

        .info-value {
            color: rgba(255, 255, 255, 0.9);
        }

        /* distilleryDescriptionã‚’å·¦å¯„ã›ã«ã™ã‚‹CSSä¿®æ­£ */
        .distillery-description {
            margin-top: 15px;
            line-height: 1.6;
            text-align: left; /* å·¦å¯„ã›ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š */
        }
        .status-active {
            color: #4ecdc4;
            font-weight: bold;
        }

        .status-closed {
            color: #ff6b6b;
            font-weight: bold;
        }

        .status-unknown {
            color: #ffb347;
            font-weight: bold;
        }

        /* Leafletãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        .leaflet-container {
            background-color: #242424 !important;
        }
        .leaflet-tile-pane {
            opacity: 0.9;
        }
        .leaflet-popup-content-wrapper {
            background-color: rgba(40, 44, 52, 0.95) !important;
            color: #fff !important;
            border: 1px solid rgba(78, 205, 196, 0.5);
        }
        .leaflet-popup-tip {
            background-color: rgba(40, 44, 52, 0.95) !important;
        }
        .leaflet-control-zoom a {
            background-color: rgba(40, 44, 52, 0.8) !important;
            color: #fff !important;
            border-color: rgba(78, 205, 196, 0.3) !important;
        }
        .leaflet-control-zoom a:hover {
            background-color: rgba(78, 205, 196, 0.3) !important;
        }
        
        /* éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .voice-input-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }

        .voice-input-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            transform: translateY(-2px);
        }

        .voice-input-btn.recording {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            color: #ff6b6b;
            animation: pulse-recording 1.5s infinite;
        }

        @keyframes pulse-recording {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .error-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            animation: slide-in 0.5s ease-out;
        }

        .notification-content {
            background-color: rgba(255, 107, 107, 0.9);
            color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
        }

        .notification-icon {
            font-size: 24px;
            margin-right: 15px;
        }

        .notification-message {
            flex-grow: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            margin-left: 10px;
        }

        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ - å³ç«¯ã«é…ç½® */
        .nav-links {
            position: absolute;
            right: 20px;
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s ease;
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .nav-link:hover {
            color: #fff;
            background: rgba(78, 205, 196, 0.2);
        }
        
        .nav-link.active {
            color: #fff;
            background: rgba(78, 205, 196, 0.3);
            border-bottom: 2px solid #4ecdc4;
        }

        /* AIææ¡ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿®æ­£ */
        .ai-recommendation-message {
            background: rgba(78, 205, 196, 0.15);
            border-left: 3px solid #4ecdc4;
            color: #fff;
            padding: 20px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™ */
            border-radius: 8px;
            margin-bottom: 25px; /* ä¸‹éƒ¨ã®ä½™ç™½ã‚’å¢—ã‚„ã™ */
            line-height: 1.8; /* è¡Œé–“ã‚’åºƒã’ã‚‹ */
        }

        @keyframes thinking {
            0% { content: "è€ƒãˆã¦ã„ã¾ã™"; }
            25% { content: "è€ƒãˆã¦ã„ã¾ã™."; }
            50% { content: "è€ƒãˆã¦ã„ã¾ã™.."; }
            75% { content: "è€ƒãˆã¦ã„ã¾ã™..."; }
            100% { content: "è€ƒãˆã¦ã„ã¾ã™...."; }
        }

        .thinking-animation {
            position: relative;
        }

        .thinking-animation::after {
            content: "è€ƒãˆã¦ã„ã¾ã™";
            animation: thinking 1.5s infinite;
        }

    </style>
<style>
    .genspark-notice-dialog {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10001;
      align-items: center;
      justify-content: center;
    }

    .genspark-notice-content {
      background-color: white;
      border-radius: 8px;
      max-width: 600px;
      width: 90%;
      box-sizing: border-box;
      padding: 10px 30px 30px 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      font-size: 16px;
    }

    .genspark-notice-title {
      color: #000;
      font-family: Arial;
      font-size: 20px;
      font-style: normal;
      font-weight: 700;
      line-height: 150%; 
    }

    .genspark-notice-list {
      margin: 24px 0;
      
      color: #606366;
      font-family: Arial;
      font-size: 14px;
      font-style: normal;
      font-weight: 400;
      line-height: 150%;
      padding-left: 12px;
    }

    .genspark-notice-list li {
      margin-bottom: 12px;
      list-style-type: disc;
    }

    .genspark-notice-list li a {
      color: #606366;
      text-decoration: underline;
    }

    .genspark-notice-checkbox {
      display: flex;
      align-items: center;
      margin-top: 20px;
      gap: 10px;

      color: #232425;

      font-family: Arial;
      font-size: 14px;
      font-style: normal;
      font-weight: 400;
      line-height: normal;
    }

    .genspark-notice-actions {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
      
    .genspark-notice-ok {
      color: #232425;

      text-align: center;
      font-family: Arial;
      font-size: 16px;
      font-style: normal;
      font-weight: 700;
      line-height: 150%; 

      cursor: pointer;
      display: flex;
      height: 40px;
      padding: 6px 14px;
      justify-content: center;
      align-items: center;
      gap: 10px;
      align-self: stretch;
      border-radius: 8px;
      border: 1px solid #000;
      box-sizing: border-box;
      width: 100%;
    }
    /* è’¸æºœæ‰€ãƒãƒ¼ã‚«ãƒ¼ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
.distillery-tooltip {
    background-color: rgba(40, 44, 52, 0.95);
    color: #fff;
    border: 1px solid rgba(78, 205, 196, 0.5);
    border-radius: 4px;
    padding: 5px 8px;
    font-size: 12px;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

    
  </style></head>
        <body>
        <div class="header-container">
            <a href="https://www.hirunotsuki.com/" target="_blank" style="position: absolute; left: 20px; width: 90px; height: 90px; display: block;">
    <img class="logo" src="./NH_bar_logo_fin_white.png" alt="æ˜¼ã®æœˆãƒãƒ¼ãƒ­ã‚´">
</a>
            <h1 class="header-title">æ˜¼ã®æœˆã€‚AIã‚½ãƒ ãƒªã‚¨</h1>
            <div class="nav-links">
                <a href="whisky_list.html" class="nav-link" id="listLink">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªã‚¹ãƒˆä¸€è¦§</a>
                
                <!-- 1ã¤ã®ç¿»è¨³ãƒœã‚¿ãƒ³ã«çµ±åˆ -->
                <a href="#" onclick="openGoogleTranslate(); return false;" class="nav-link translate-link">
                    <span class="translate-icon">ğŸŒ</span> ç¿»è¨³
                </a>
            </div>
        </div>
    
    <div class="container-custom">
        <div class="whisky-overview">
            <h2>ğŸ· ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h2>
            <div class="subtitle">æœ¬æ—¥ã¯å³é¸ã•ã‚ŒãŸ<span id="whiskyCount">0</span>æœ¬ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‹ã‚‰</div>
            <div class="description">
                <strong>ã‚ãªãŸã®å‘³è¦šã«å®Œç’§ã«ãƒãƒƒãƒã™ã‚‹</strong>æœ€é«˜ã®ä¸€æœ¬ã‚’<br>
                AIæŠ€è¡“ã§åˆ†æãƒ»ææ¡ˆã„ãŸã—ã¾ã™
            </div>
            <div class="whisky-stats">
            <div class="stat-item">
                <span class="stat-number" id="totalWhiskies">0</span>
                <div class="stat-label">å³é¸éŠ˜æŸ„</div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="uniqueRegions">0</span>
                <div class="stat-label">ç”£åœ°</div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="distilleryCount">0</span>
                <div class="stat-label">è’¸æºœæ‰€ã®æ•°</div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="aiTechnology">AI</span>
                <div class="stat-label">åˆ†ææŠ€è¡“</div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-2xl font-bold mb-4">
                ğŸ’ ä¾¡æ ¼å¸¯è¨­å®š
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block mb-2">ä¸‹é™ä¾¡æ ¼: <span id="minPriceDisplay">Â¥5,000</span></label>
                    <input type="range" id="minPrice" class="price-slider" min="1" max="80" value="5" step="1">
                </div>
                <div>
                    <label class="block mb-2">ä¸Šé™ä¾¡æ ¼: <span id="maxPriceDisplay">Â¥50,000</span></label>
                    <input type="range" id="maxPrice" class="price-slider" min="1" max="80" value="50" step="1">
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="text-xl font-bold mb-3 text-center" style="margin-top: 10px; margin-bottom: 10px; padding-bottom: 15px; line-height: 2;">
                ğŸŒŸ å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
            </h2>
            <p class="mb-6">2ã¤ã®å››è§’å†…ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã‚Œãã‚Œã®å¥½ã¿ã®ä½ç½®ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            
            <div class="dual-matrix-container">
                <div class="matrix-wrapper">
                    <div class="matrix-title">åŸºæœ¬çš„ãªå‘³ã®å‚¾å‘</div>
                    <div class="relative">
                        <div class="taste-matrix" id="tasteMatrix1">
                            <div class="taste-dot" id="tasteDot1" style="left: 50%; top: 50%;"></div>
                        </div>
                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-sm">ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼</div>
                        <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-sm">ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼</div>
                        <div class="absolute -left-12 top-1/2 transform -translate-y-1/2 text-sm">ãƒ©ã‚¤ãƒˆ</div>
                        <div class="absolute -right-12 top-1/2 transform -translate-y-1/2 text-sm">ãƒ˜ãƒ“ãƒ¼</div>
                    </div>
                    <div class="text-center mt-4">
                        <span id="coordinates1" class="text-xs text-gray-400">åº§æ¨™: X: 0.50, Y: 0.50</span>
                    </div>
                </div>
                
                <div class="matrix-wrapper">
                    <div class="matrix-title">è¤‡é›‘ã•ã®å¥½ã¿</div>
                    <div class="relative">
                        <div class="taste-matrix" id="tasteMatrix2">
                            <div class="taste-dot" id="tasteDot2" style="left: 50%; top: 50%;"></div>
                        </div>
                        <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-sm">ã¾ã‚ã‚„ã‹</div>
                        <div class="absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-sm">å¼·çƒˆ</div>
                        <div class="absolute -left-12 top-1/2 transform -translate-y-1/2 text-sm">è‹¥ã„</div>
                        <div class="absolute -right-12 top-1/2 transform -translate-y-1/2 text-sm">ç†Ÿæˆ</div>
                    </div>
                    <div class="text-center mt-4">
                        <span id="coordinates2" class="text-xs text-gray-400">åº§æ¨™: X: 0.50, Y: 0.50</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card chat-section">
            <h2 class="text-xl font-bold mb-3 text-center" style="margin-top: 10px; margin-bottom: 10px; padding-bottom: 15px; line-height: 2;">
                ğŸ—¨ï¸ AIã‚½ãƒ ãƒªã‚¨ã¨ãƒãƒ£ãƒƒãƒˆ
            </h2>
            
            <div class="chat-examples">
                <div class="mb-3 text-sm text-gray-300">è³ªå•ä¾‹ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å…¥åŠ›ï¼‰ï¼š</div>
                <div class="question-example" data-question="ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼ˆæœ€é«˜é¡80,400å††ï¼‰ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦">ğŸ’ ã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼ˆæœ€é«˜é¡80,400å††ï¼‰ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦</div>
                <div class="question-example" data-question="3000å††ä»¥ä¸‹ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¢ã‚¤ãƒ©å³¶ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¯ã‚ã‚‹ï¼Ÿ">ğŸŒŠ 3000å††ä»¥ä¸‹ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªã‚¢ã‚¤ãƒ©å³¶ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¯ã‚ã‚‹ï¼Ÿ</div>
                <div class="question-example" data-question="æ—¥æœ¬ã®è»½äº•æ²¢ã‚„é•·æ¿±ãªã©ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã¦">ğŸ¯ æ—¥æœ¬ã®è»½äº•æ²¢ã‚„é•·æ¿±ãªã©ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’æ¯”è¼ƒã—ã¦</div>
                <div class="question-example" data-question="5000å††å‰å¾Œã§è¤‡é›‘ãªå‘³ã‚ã„ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ãŠã™ã™ã‚ã¯ï¼Ÿ">â­ 5000å††å‰å¾Œã§è¤‡é›‘ãªå‘³ã‚ã„ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ãŠã™ã™ã‚ã¯ï¼Ÿ</div>
            </div>

            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
                <button id="voiceInputBtn" class="voice-input-btn">
                    ğŸ™ï¸
                </button>
                <button id="sendChatBtn" class="btn-primary">ğŸ’¬ è³ªå•ã™ã‚‹</button>
            </div>

            <div id="chatHistory" class="chat-history" style="display: none;"></div>
        </div>
        
        <div class="text-center mb-8">
            <button id="getRecommendation" class="btn-primary text-lg mr-4">ğŸ¯ AIã‚¦ã‚£ã‚¹ã‚­ãƒ¼ææ¡ˆã‚’å—ã‘ã‚‹</button>
            <button id="refreshRecommendation" class="btn-secondary text-lg">
                ğŸ”„ ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦å†ææ¡ˆ
            </button>
        </div>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="animate-spin text-4xl mb-4">ğŸ·</div>
            <p class="mt-2">AIãŒæœ€é©ãªã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’åˆ†æä¸­...</p>
        </div>
        
        <div id="progressContainer" class="progress-container" style="display: none;">
            <div id="progressText" class="progress-text">çµæœã‚’ç”Ÿæˆä¸­...</div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <div id="progressPercentage" class="progress-percentage">0%</div>
        </div>
        
        <div id="splitLayoutContainer" class="split-layout" style="display: none;">
            <div id="recommendationsPanel" class="recommendations-panel">
                <h2 class="text-2xl font-bold mb-4" style="margin-top: 0px; margin-bottom: 10px; padding-bottom: 15px; line-height: 2;">
                    ğŸŒ™ AIææ¡ˆçµæœ
                </h2>
                <div id="preferencesSummary" class="recommendation-summary" style="display: block;">
                    <h3 class="text-lg font-bold mb-3">ğŸ¯ ã‚ãªãŸã®å¥½ã¿ã®å‚¾å‘</h3>
                    <div class="space-y-2 text-sm">
                        <div><strong>åŸºæœ¬çš„ãªå‘³ã®å‚¾å‘:</strong> <span id="tasteDescription">ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸ</span></div>
                        <div><strong>è¤‡é›‘ã•ã®å¥½ã¿:</strong> <span id="complexityDescription">ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„è¤‡é›‘ã•ã‚’å¥½ã‚€</span></div>
                        <div><strong>ä¾¡æ ¼å¸¯:</strong> <span id="priceRange">Â¥5,000 - Â¥50,000</span></div>
                
                        <div class="mt-3 pt-2 border-t border-gray-600">
                            AIãŒç·åˆçš„ã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ã„ã¦ã€æœ€é©ãª3éŠ˜æŸ„ã‚’å³é¸ã—ã¾ã—ãŸã€‚
                        </div>
                    </div>
                </div>
                <div id="recommendationContent"></div>
                <div class="text-center mt-6">
                    <button id="getAnotherRecommendation" class="btn-secondary">
                        ğŸ”„ åˆ¥ã®ææ¡ˆã‚’å—ã‘ã‚‹
                    </button>
                </div>
            </div>
            
            <div id="chartPanel" class="chart-panel">
                <h2 class="text-2xl font-bold mb-4" style="margin-top: 0px; margin-bottom: 10px; padding-bottom: 15px; line-height: 2;">
                    ğŸ•¸ï¸ å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ¯”è¼ƒ
                </h2>
                <div class="chart-container">
                    <h3 id="chartTitle">ã‚ãªãŸã®å¥½ã¿</h3>
                    <canvas id="combinedProfileChart" class="chart-canvas"></canvas>
                </div>
                
                <!-- è’¸ç•™æ‰€ãƒãƒƒãƒ—ã¨æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div id="distillerySection" class="distillery-section">
                    <h2 class="text-xl font-bold mb-3 text-center" style="margin-top: 0px; margin-bottom: 10px; padding-bottom: 15px; line-height: 2;">
                        ğŸ—¾ è’¸æºœæ‰€æƒ…å ±
                    </h2>
                    <div class="distillery-container">
                        <div class="map-container">
                            <div id="distilleryMap"></div>
                        </div>
                        
                        <div class="distillery-info" id="distilleryInfo">
                            <h3 id="distilleryName">è’¸ç•™æ‰€å</h3>
                            <div class="distillery-info-grid" id="distilleryDetails">
                                <div class="info-label">æ‰€åœ¨åœ°:</div>
                                <div class="info-value" id="distilleryRegion">-</div>
                                
                                <div class="info-label">å‰µæ¥­å¹´:</div>
                                <div class="info-value" id="distilleryFounded">-</div>
                                
                                <div class="info-label">ç¾åœ¨ã®çŠ¶æ³:</div>
                                <div class="info-value" id="distilleryStatus">-</div>
                            </div>
                            
                            <div class="distillery-description" id="distilleryDescription">
                                ç¾åœ¨æƒ…å ±ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="custom-footer">
            Powered by Nebula Hirozon Technology
        </div>
    </div>
    
       <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
 // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®è¨­å®šï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ã®ãŸã‚æ®‹ã—ã¦ãŠãï¼‰
    let whiskyData = [];
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼å¥½ã¿ã®çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¤‰æ•°
    let x1 = 0.5, y1 = 0.5;  // å‘³è¦šãƒãƒˆãƒªãƒƒã‚¯ã‚¹1ã®åº§æ¨™
    let x2 = 0.5, y2 = 0.5;  // è¤‡é›‘ã•ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®åº§æ¨™
    let savedUserPreferences = "";  // ãƒãƒ£ãƒƒãƒˆã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸè¿½åŠ å¥½ã¿
    
    // è’¸æºœæ‰€æƒ…å ±
    const distilleryDatabase = {
        "ã‚¢ãƒ¼ãƒ‰ãƒ™ãƒƒã‚°": {
            name: "ã‚¢ãƒ¼ãƒ‰ãƒ™ãƒƒã‚°è’¸æºœæ‰€ (Ardbeg Distillery)",
            location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¢ã‚¤ãƒ©å³¶",
            founded: "1815å¹´",
            status: "ç¨¼åƒä¸­",
            latitude: 55.6406,
            longitude: -6.1089,
            description: "ã‚¢ãƒ¼ãƒ‰ãƒ™ãƒƒã‚°ã¯ã‚¢ã‚¤ãƒ©å³¶å—éƒ¨ã«ä½ç½®ã™ã‚‹è’¸æºœæ‰€ã§ã€å¼·ã„æ³¥ç‚­ã¨ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªç‰¹å¾´ã‚’æŒã¤ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã§çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ãã®ç‹¬ç‰¹ãªé¢¨å‘³ã¯ãƒ”ãƒ¼ãƒˆï¼ˆæ³¥ç‚­ï¼‰ã®ä½¿ç”¨é‡ãŒå¤šã„ã“ã¨ã«èµ·å› ã—ã¾ã™ã€‚"
        },
        "ã‚¿ãƒªã‚¹ã‚«ãƒ¼": {
            name: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼è’¸æºœæ‰€ (Talisker Distillery)",
            location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¹ã‚«ã‚¤å³¶",
            founded: "1830å¹´",
            status: "ç¨¼åƒä¸­",
            latitude: 57.302,
            longitude: -6.356,
            description: "ã‚¹ã‚«ã‚¤å³¶å”¯ä¸€ã®è’¸æºœæ‰€ã§ã‚ã‚‹ã‚¿ãƒªã‚¹ã‚«ãƒ¼ã¯ã€æµ·ã®è¿‘ãã«ä½ç½®ã—ã€ãã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã¯æµ·ã®å¡©æ°—ã¨ç…™ã®ç‰¹å¾´ã‚’ä½µã›æŒã¡ã¾ã™ã€‚æ³¢æ‰“ã¡éš›ã®è’¸æºœæ‰€ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹åŠ›å¼·ã„é¢¨å‘³ã¯ã€å¤šãã®æ„›å¥½å®¶ã«æ”¯æŒã•ã‚Œã¦ã„ã¾ã™ã€‚"
        },
        "ãƒãƒƒã‚«ãƒ©ãƒ³": {
            name: "ãƒãƒƒã‚«ãƒ©ãƒ³è’¸æºœæ‰€ (The Macallan Distillery)",
            location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰",
            founded: "1824å¹´",
            status: "ç¨¼åƒä¸­",
            latitude: 57.4843,
            longitude: -3.2079,
            description: "ãƒãƒƒã‚«ãƒ©ãƒ³ã¯ã‚·ã‚§ãƒªãƒ¼æ¨½ç†Ÿæˆã®ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ä»£è¡¨æ ¼ã§ã€é«˜å“è³ªãªã‚ªãƒ¼ã‚¯æ¨½ã®é¸å®šã«å®šè©•ãŒã‚ã‚Šã¾ã™ã€‚ã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰åœ°æ–¹ã®è’¸æºœæ‰€ã®ä¸­ã§ã‚‚ç‰¹ã«é«˜ç´šã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã¨ã—ã¦ä¸–ç•Œçš„ã«çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚"
        },
        "å±±å´": {
            name: "ã‚µãƒ³ãƒˆãƒªãƒ¼å±±å´è’¸æºœæ‰€",
            location: "æ—¥æœ¬, å¤§é˜ªåºœ",
            founded: "1923å¹´",
            status: "ç¨¼åƒä¸­",
            latitude: 34.8916,
            longitude: 135.6733,
            description: "æ—¥æœ¬æœ€å¤ã®ãƒ¢ãƒ«ãƒˆã‚¦ã‚¤ã‚¹ã‚­ãƒ¼è’¸æºœæ‰€ã§ã‚ã‚‹å±±å´ã¯ã€äº¬éƒ½ã¨å¤§é˜ªã®å¢ƒç•Œã«ã‚ã‚‹è‡ªç„¶è±Šã‹ãªåœ°ã«ä½ç½®ã—ã¦ã„ã¾ã™ã€‚ãã®æ°´è³ªã®è‰¯ã•ã¨å››å­£ã®å¤‰åŒ–ãŒã€è¤‡é›‘ã§ç¹Šç´°ãªæ—¥æœ¬ã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã™ã€‚"
        },
        "ãƒã‚¦ãƒ¢ã‚¢": {
            name: "ãƒã‚¦ãƒ¢ã‚¢è’¸æºœæ‰€ (Bowmore Distillery)",
            location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¢ã‚¤ãƒ©å³¶",
            founded: "1779å¹´",
            status: "ç¨¼åƒä¸­",
            latitude: 55.7561,
            longitude: -6.2897,
            description: "ã‚¢ã‚¤ãƒ©å³¶ã§æœ€ã‚‚å¤ã„è’¸æºœæ‰€ã®ä¸€ã¤ã§ã‚ã‚‹ãƒã‚¦ãƒ¢ã‚¢ã¯ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ”ãƒ¼ãƒˆé¦™ã¨æµ·ã®é¢¨å‘³ãŒç‰¹å¾´ã§ã™ã€‚ä¼çµ±çš„ãªè£½æ³•ã‚’å®ˆã‚ŠãªãŒã‚‰ã‚‚ã€è¿‘ä»£çš„ãªæŠ€è¡“ã‚‚å–ã‚Šå…¥ã‚ŒãŸé«˜å“è³ªãªã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã‚’ç”Ÿç”£ã—ã¦ã„ã¾ã™ã€‚"
        }
    };
    
    // åˆæœŸåŒ–é–¢æ•°
    document.addEventListener('DOMContentLoaded', function() {
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
        whiskyData = getDefaultWhiskyData();
        
        // æ¨è–¦ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById("getRecommendationBtn").addEventListener("click", getRecommendation);
        
        // ä¾¡æ ¼ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById("minPrice").addEventListener("input", updateMinPriceDisplay);
        document.getElementById("maxPrice").addEventListener("input", updateMaxPriceDisplay);
        
        // ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById("sendChatBtn").addEventListener("click", sendChatMessage);
        
        // ãƒãƒ£ãƒƒãƒˆã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById("chatInput").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                e.preventDefault();
                sendChatMessage();
            }
        });
        
        // è³ªå•ä¾‹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.querySelectorAll(".question-example").forEach(example => {
            example.addEventListener("click", function() {
                document.getElementById("chatInput").value = this.textContent;
                sendChatMessage();
            });
        });

         // ãƒãƒ£ãƒƒãƒˆå±¥æ­´è¡¨ç¤ºã‚’æœ‰åŠ¹åŒ–
        const chatHistoryElement = document.getElementById("chatHistory");
        if (chatHistoryElement) {
            chatHistoryElement.style.display = "block";
        }

        // è³ªå•ä¾‹ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
        document.querySelectorAll('.question-example').forEach(question => {
            question.addEventListener('click', function() {
                document.getElementById("chatInput").value = this.textContent.trim();
            });
        });

        // ãƒãƒ£ãƒƒãƒˆé€ä¿¡ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        const sendButton = document.getElementById("sendChatButton");
        if (sendButton) {
            sendButton.addEventListener('click', () => sendChatMessage());
        }

        // Enterã‚­ãƒ¼ã§ã®é€ä¿¡
        const chatInput = document.getElementById("chatInput");
        if (chatInput) {
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
        }
    });
        
        // éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®è¨­å®šï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰
        const voiceInputBtn = document.getElementById("voiceInputBtn");
        if (voiceInputBtn && 'webkitSpeechRecognition' in window) {
            setupVoiceInput();
        }
        
        // å‘³è¦šãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
        initializeTasteMatrix();
        
        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        updateStatistics(whiskyData.length);
    });
    
    // å‘³è¦šãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–
    function initializeTasteMatrix() {
        const tasteMatrix1 = document.getElementById("tasteMatrix1");
        const tasteDot1 = document.getElementById("tasteDot1");
        
        const tasteMatrix2 = document.getElementById("tasteMatrix2");
        const tasteDot2 = document.getElementById("tasteDot2");
        
        if (tasteMatrix1 && tasteDot1) {
            // ãƒãƒˆãƒªãƒƒã‚¯ã‚¹1ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            tasteMatrix1.addEventListener("click", function(e) {
                const rect = tasteMatrix1.getBoundingClientRect();
                x1 = (e.clientX - rect.left) / rect.width;
                y1 = (e.clientY - rect.top) / rect.height;
                
                tasteDot1.style.left = (x1 * 100) + "%";
                tasteDot1.style.top = (y1 * 100) + "%";
                
                document.getElementById("tasteCoordinates1").textContent = 
                    `åº§æ¨™: X: ${x1.toFixed(2)}, Y: ${y1.toFixed(2)}`;
            });
        }
        
        if (tasteMatrix2 && tasteDot2) {
            // ãƒãƒˆãƒªãƒƒã‚¯ã‚¹2ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            tasteMatrix2.addEventListener("click", function(e) {
                const rect = tasteMatrix2.getBoundingClientRect();
                x2 = (e.clientX - rect.left) / rect.width;
                y2 = (e.clientY - rect.top) / rect.height;
                
                tasteDot2.style.left = (x2 * 100) + "%";
                tasteDot2.style.top = (y2 * 100) + "%";
                
                document.getElementById("tasteCoordinates2").textContent = 
                    `åº§æ¨™: X: ${x2.toFixed(2)}, Y: ${y2.toFixed(2)}`;
            });
        }
    }
    
    // ä¾¡æ ¼è¡¨ç¤ºã®æ›´æ–°é–¢æ•°
    function updateMinPriceDisplay() {
        const value = document.getElementById("minPrice").value;
        document.getElementById("minPriceDisplay").textContent = `Â¥${numberWithCommas(value * 1000)}`;
    }
    
    function updateMaxPriceDisplay() {
        const value = document.getElementById("maxPrice").value;
        document.getElementById("maxPriceDisplay").textContent = `Â¥${numberWithCommas(value * 1000)}`;
    }
    
    // æ•°å€¤ã«ã‚«ãƒ³ãƒã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function getDefaultWhiskyData() {
        return [
            {
                id: "1",
                name: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼ 44å¹´ ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«ãƒœãƒˆãƒ«",
                price: "Â¥80,400",
                region: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ / ã‚¹ã‚«ã‚¤å³¶",
                subcategory: "ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆ",
                abv: "48.0",
                tastingNote_ja: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼ç‹¬ç‰¹ã®ãƒ”ãƒ¼ãƒˆã¨æµ·ã®é¢¨å‘³ã«åŠ ãˆã€44å¹´ã®ç†Ÿæˆã«ã‚ˆã‚‹æ·±ã„ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã•ã¨è¤‡é›‘ã•ãŒç‰¹å¾´ã€‚ã‚¹ã‚«ã‚¤å³¶ã®æ½®é¢¨ã¨é•·ã„å¹´æœˆãŒã‚‚ãŸã‚‰ã™ç¨€å°‘ãªä¸€æœ¬ã€‚",
                taste_profile: {
                    fruity: 3,
                    spicy: 4,
                    smoky: 4,
                    body: 5,
                    sweetness: 3,
                    complexity: 5
                },
                distillery_info: {
                    name: "ã‚¿ãƒªã‚¹ã‚«ãƒ¼è’¸æºœæ‰€",
                    location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¹ã‚«ã‚¤å³¶",
                    founded: "1830å¹´",
                    status: "ç¨¼åƒä¸­",
                    latitude: 57.302,
                    longitude: -6.356,
                    description: "ã‚¹ã‚«ã‚¤å³¶å”¯ä¸€ã®è’¸æºœæ‰€ã§ã‚ã‚‹ã‚¿ãƒªã‚¹ã‚«ãƒ¼ã¯ã€æµ·ã®è¿‘ãã«ä½ç½®ã—ã€ãã®ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã¯æµ·ã®å¡©æ°—ã¨ç…™ã®ç‰¹å¾´ã‚’ä½µã›æŒã¡ã¾ã™ã€‚"
                }
            },
            {
                id: "2",
                name: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³ 25å¹´ one of only bottles",
                price: "Â¥21,500",
                region: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ / ã‚¢ã‚¤ãƒ©å³¶",
                subcategory: "ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆ",
                abv: "56.2",
                tastingNote_ja: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³25å¹´ã¯è€ƒãˆã‚‰ã‚Œã‚‹ã‹ãã‚Šå¸Œå°‘ãªéŠ˜æŸ„ã€‚å¼·çƒˆãªã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼æ„Ÿã¨ç†Ÿæˆã«ã‚ˆã‚‹ã‚³ã‚¯ãŒç‰¹å¾´ã€‚é•·ã„ä½™éŸ»ã¨ãƒ€ãƒ¼ã‚¯ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã¨ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚é»’ç³–ã€ã‚³ãƒ¼ãƒ‰ã€ã‚¿ãƒ¼ãƒ¡ãƒªãƒƒã‚¯ã€å®Œç†Ÿæœå®Ÿã®åºƒãŒã‚ŠãŒã‚ã‚Šã¾ã™ã€‚",
                taste_profile: {
                    fruity: 2,
                    spicy: 4,
                    smoky: 5,
                    body: 4,
                    sweetness: 2,
                    complexity: 5
                },
                distillery_info: {
                    name: "ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³è’¸æºœæ‰€",
                    location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¢ã‚¤ãƒ©å³¶",
                    founded: "1825å¹´",
                    status: "é–‰é–ï¼ˆ1983å¹´ï¼‰",
                    latitude: 55.6301,
                    longitude: -6.2035,
                    description: "1983å¹´ã«é–‰é–ã•ã‚ŒãŸãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³ã¯ã‚¢ã‚¤ãƒ©å³¶ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨ã•ã‚Œã€æ®‹ã•ã‚ŒãŸãƒœãƒˆãƒ«ã¯å¸Œå°‘ä¾¡å€¤ãŒé«˜ã„ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚ºã‚¢ã‚¤ãƒ†ãƒ ã¨ãªã£ã¦ã„ã¾ã™ã€‚"
                }
            },
            {
                id: "3",
                name: "ãƒãƒƒã‚«ãƒ©ãƒ³ 1990å¹´ SAMAROLI",
                price: "Â¥58,000",
                region: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ / ã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰",
                subcategory: "ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆ",
                abv: "45.0",
                tastingNote_ja: "ä¼èª¬ã®ãƒœãƒˆãƒ©ãƒ¼ã€ã‚µãƒãƒ­ãƒ¼ãƒªã«ã‚ˆã‚‹ãƒãƒƒã‚«ãƒ©ãƒ³1990å¹´ã€‚ã‚·ã‚§ãƒªãƒ¼æ¨½ã®å½±éŸ¿ã«ã‚ˆã‚‹è±Šã‹ãªæœå®Ÿå‘³ã¨è¤‡é›‘ãªé¦™ã‚ŠãŒç‰¹å¾´ã€‚é•·ã„ä½™éŸ»ã¨æ´—ç·´ã•ã‚ŒãŸå‘³ã‚ã„ãŒæ¥½ã—ã‚ã¾ã™ã€‚",
                taste_profile: {
                    fruity: 4,
                    spicy: 3,
                    smoky: 1,
                    body: 5,
                    sweetness: 4,
                    complexity: 5
                },
                distillery_info: {
                    name: "ãƒãƒƒã‚«ãƒ©ãƒ³è’¸æºœæ‰€",
                    location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¹ãƒšã‚¤ã‚µã‚¤ãƒ‰",
                    founded: "1824å¹´",
                    status: "ç¨¼åƒä¸­",
                    latitude: 57.4843,
                    longitude: -3.2079,
                    description: "ãƒãƒƒã‚«ãƒ©ãƒ³ã¯ã‚·ã‚§ãƒªãƒ¼æ¨½ç†Ÿæˆã®ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆã‚¦ã‚¤ã‚¹ã‚­ãƒ¼ã®ä»£è¡¨æ ¼ã§ã€é«˜å“è³ªãªã‚ªãƒ¼ã‚¯æ¨½ã®é¸å®šã«å®šè©•ãŒã‚ã‚Šã¾ã™ã€‚"
                }
            },
            {
                id: "4",
                name: "ãƒã‚¦ãƒ¢ã‚¢18å¹´ ãƒ‡ã‚£ãƒ¼ãƒ—&ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹",
                price: "Â¥8,200",
                region: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ / ã‚¢ã‚¤ãƒ©å³¶",
                subcategory: "ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆ",
                abv: "43.0",
                tastingNote_ja: "Body:4ã€Smoky:4ã€Complexity:4ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã¤ã€ã‚¢ã‚¤ãƒ©å³¶ã®å®šç•ªéŠ˜æŸ„ã€‚ãƒ˜ãƒ“ãƒ¼ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠæ¢ã—ã®æ–¹ã«ãŠã™ã™ã‚ã§ã™ã€‚18å¹´ç†Ÿæˆã«ã‚ˆã‚Šã€ã‚¢ã‚¤ãƒ©ãƒ¢ãƒ«ãƒˆã®ç‰¹æœ‰ã®æµ·ã®é¦™ã‚Šã‚„ã€è¤‡é›‘ãªå‘³ã®å±•é–‹ãŒæ¥½ã—ã‚ã¾ã™ã€‚",
                taste_profile: {
                    fruity: 2,
                    spicy: 3,
                    smoky: 4,
                    body: 4,
                    sweetness: 2,
                    complexity: 4
                },
                distillery_info: {
                    name: "ãƒã‚¦ãƒ¢ã‚¢è’¸æºœæ‰€",
                    location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¢ã‚¤ãƒ©å³¶",
                    founded: "1779å¹´",
                    status: "ç¨¼åƒä¸­",
                    latitude: 55.7561,
                    longitude: -6.2897,
                    description: "ã‚¢ã‚¤ãƒ©å³¶ã§æœ€ã‚‚å¤ã„è’¸æºœæ‰€ã®ä¸€ã¤ã§ã‚ã‚‹ãƒã‚¦ãƒ¢ã‚¢ã¯ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ”ãƒ¼ãƒˆé¦™ã¨æµ·ã®é¢¨å‘³ãŒç‰¹å¾´ã§ã™ã€‚"
                }
            },
            {
                id: "5",
                name: "ãƒœã‚¦ãƒ¢ã‚¢IsBS ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹",
                price: "Â¥8,200",
                region: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ / ã‚¢ã‚¤ãƒ©å³¶",
                subcategory: "ã‚·ãƒ³ã‚°ãƒ«ãƒ¢ãƒ«ãƒˆ",
                abv: "43.0",
                tastingNote_ja: "Body:4ã€Smoky:4ã€Complexity:4ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ˜ãƒ“ãƒ¼ã§ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠæ¢ã—ã®æ–¹ã«ãŠã™ã™ã‚ã§ã™ã€‚18å¹´ç†Ÿæˆã«ã‚ˆã‚Šã€ã‚¢ã‚¤ãƒ©ãƒ¢ãƒ«ãƒˆã®ç‰¹æœ‰ã®æµ·ã®é¦™ã‚Šã‚„ã€è¤‡é›‘ãªå‘³ã®å±•é–‹ãŒæ¥½ã—ã‚ã¾ã™ã€‚ã‚ˆã‚Šå¼·ã„ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼ã•ã‚’æ±‚ã‚ã‚‹ãªã‚‰ã€åŒã˜ã‚¢ã‚¤ãƒ©å³¶ã®ã€Œãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³25å¹´ã€ã‚‚ãŠã™ã™ã‚ã§ã™ã€‚",
                taste_profile: {
                    fruity: 2,
                    spicy: 3,
                    smoky: 4,
                    body: 4,
                    sweetness: 2,
                    complexity: 4
                },
                distillery_info: {
                    name: "ãƒã‚¦ãƒ¢ã‚¢è’¸æºœæ‰€",
                    location: "ã‚¹ã‚³ãƒƒãƒˆãƒ©ãƒ³ãƒ‰, ã‚¢ã‚¤ãƒ©å³¶",
                    founded: "1779å¹´",
                    status: "ç¨¼åƒä¸­",
                    latitude: 55.7561,
                    longitude: -6.2897,
                    description: "ã‚¢ã‚¤ãƒ©å³¶ã§æœ€ã‚‚å¤ã„è’¸æºœæ‰€ã®ä¸€ã¤ã§ã‚ã‚‹ãƒã‚¦ãƒ¢ã‚¢(Bowmore)ã¯ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸãƒ”ãƒ¼ãƒˆé¦™ã¨æµ·ã®é¢¨å‘³ãŒç‰¹å¾´ã§ã™ã€‚"
                }
            }
        ];
    }
    
    // AIæ¨è–¦ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆæ”¹ä¿®ï¼‰
async function getRecommendation() {
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¡¨ç¤º
    showProgress();
    try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’å–å¾—
        const userPreferences = {
            minPrice: parseFloat(document.getElementById("minPrice").value) * 1000,
            maxPrice: parseFloat(document.getElementById("maxPrice").value) * 1000,
            tasteX: x1,
            tasteY: y1,
            complexityX: x2,
            complexityY: y2,
            additionalPreferences: savedUserPreferences || "",
            chatHistory: chatHistory // ãƒãƒ£ãƒƒãƒˆå±¥æ­´å…¨ä½“ã‚’é€ä¿¡
        };
        
        // Claude APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        const response = await fetch('/.netlify/functions/claude-api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                ...userPreferences,
                requestType: "full_recommendation",
                outputFormat: "json"
            })
        });
        
        if (!response.ok) throw new Error('APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        
        const data = await response.json();
        
        // APIã‹ã‚‰ã®JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
        if (data.success && data.data && data.data.content) {
            // APIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’JSONè§£æ
            const responseText = data.data.content[0].text;
            let jsonStartIndex = responseText.indexOf('{');
            let jsonEndIndex = responseText.lastIndexOf('}') + 1;
            
            if (jsonStartIndex >= 0 && jsonEndIndex > jsonStartIndex) {
                const jsonString = responseText.substring(jsonStartIndex, jsonEndIndex);
                try {
                    const apiResponse = JSON.parse(jsonString);
                    // æ¨è–¦çµæœã®è¡¨ç¤º
                    displayApiRecommendations(apiResponse);
                    
                    // æˆåŠŸã—ãŸã‚‰AIã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦è¿½åŠ 
                    if (apiResponse && apiResponse.summary) {
                        const aiMessage = `ä»¥ä¸‹ã®3ã¤ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’ãŠã™ã™ã‚ã—ã¾ã™:\n\n${apiResponse.summary}`;
                        addMessageToHistory("assistant", aiMessage);
                    }
                } catch (error) {
                    console.error('JSONè§£æã‚¨ãƒ©ãƒ¼:', error);
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    const matchingWhiskies = findMatchingWhiskies();
                    displayLocalRecommendations(matchingWhiskies);
                }
            } else {
                // JSONå½¢å¼ã§ãªã„å ´åˆã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                const matchingWhiskies = findMatchingWhiskies();
                displayLocalRecommendations(matchingWhiskies);
            }
        } else {
            throw new Error('APIã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™');
        }
    } catch (error) {
        console.error('æ¨è–¦å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§å¯¾å¿œ
        const matchingWhiskies = findMatchingWhiskies();
        displayLocalRecommendations(matchingWhiskies);
    } finally {
        hideProgress();
    }
}
    
    // APIã‹ã‚‰ã®æ¨è–¦çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆæ”¹ä¿®ï¼‰
function displayApiRecommendations(apiResponse) {
    const recommendationContent = document.getElementById("recommendationContent");
    recommendationContent.innerHTML = "";
    
    // è¦ç´„ã®è¡¨ç¤º
    if (apiResponse.summary) {
        const summary = document.createElement('div');
        summary.className = 'recommendation-summary';
        summary.innerHTML = `<p>${escapeHtml(apiResponse.summary)}</p>`;
        recommendationContent.appendChild(summary);
    }
    
    // å„ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
    apiResponse.recommendations.forEach((whisky, index) => {
        const whiskeyCard = document.createElement('div');
        whiskeyCard.className = 'whisky-card';
        if (index === 0) {
            whiskeyCard.classList.add('featured', 'selected');
        }
        
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰ã®å†…å®¹ã‚’è¨­å®š
        whiskeyCard.innerHTML = `
            ${index === 0 ? '<div class="featured-label">ãŠã™ã™ã‚</div>' : ''}
            <div class="flex justify-between mb-2">
                <h3 class="text-lg font-bold text-cyan-400">${escapeHtml(whisky.name)}</h3>
                <span class="text-pink-500 font-bold">${escapeHtml(whisky.price)}</span>
            </div>
            <div class="mb-2">
                <span class="text-gray-400 text-sm">
                    ${escapeHtml(whisky.region || 'N/A')} | ${escapeHtml(whisky.type || 'Whisky')}
                    ${whisky.abv ? ` | ${whisky.abv}% ABV` : ''}
                </span>
            </div>
            <p class="text-sm mb-3 text-left">${escapeHtml(whisky.description || 'æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚')}</p>
            <div class="grid grid-cols-3 gap-2 text-center text-xs">
                <div>
                    <span class="block text-yellow-400">ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼</span>
                    <span class="block">${'â˜…'.repeat((whisky.taste_profile?.fruity || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.fruity || 0))}</span>
                </div>
                <div>
                    <span class="block text-yellow-400">ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼</span>
                    <span class="block">${'â˜…'.repeat((whisky.taste_profile?.smoky || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.smoky || 0))}</span>
                </div>
                <div>
                    <span class="block text-yellow-400">è¤‡é›‘ã•</span>
                    <span class="block">${'â˜…'.repeat((whisky.taste_profile?.complexity || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.complexity || 0))}</span>
                </div>
            </div>
        `;
        
        // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ 
        whiskeyCard.addEventListener('click', () => selectWhisky(whisky, index));
        recommendationContent.appendChild(whiskeyCard);
        
        // è’¸ç•™æ‰€æƒ…å ±ã‚’è¨­å®šï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
        if (whisky.distillery_info && whisky.distillery_info.latitude && whisky.distillery_info.longitude) {
            updateDistilleryInfo(whisky.distillery_info);
        }
    });
    
    // æœ€åˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’é¸æŠçŠ¶æ…‹ã«
    if (apiResponse.recommendations.length > 0) {
        selectWhisky(apiResponse.recommendations[0], 0);
    }
    
    // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
    updateStatistics(apiResponse.recommendations.length);
    
    // ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
    document.querySelector(".recommendations-panel").style.display = "block";
}
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®æ¨è–¦çµæœã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆAPIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
    function displayLocalRecommendations(whiskies) {
        const recommendationContent = document.getElementById("recommendationContent");
        recommendationContent.innerHTML = "";
        
        whiskies.forEach((whisky, index) => {
            const whiskeyCard = document.createElement('div');
            whiskeyCard.className = 'whisky-card';
            if (index === 0) {
                whiskeyCard.classList.add('featured', 'selected');
            }
            
            whiskeyCard.innerHTML = `
                ${index === 0 ? '<div class="featured-label">ãŠã™ã™ã‚</div>' : ''}
                <div class="flex justify-between mb-2">
                    <h3 class="text-lg font-bold text-cyan-400">${escapeHtml(whisky.name)}</h3>
                    <span class="text-pink-500 font-bold">${escapeHtml(whisky.price)}</span>
                </div>
                <div class="mb-2">
                    <span class="text-gray-400 text-sm">
                        ${escapeHtml(whisky.region || 'N/A')} | ${escapeHtml(whisky.subcategory || 'Whisky')}
                        ${whisky.abv ? ` | ${whisky.abv}% ABV` : ''}
                    </span>
                </div>
                <p class="text-sm mb-3 text-left">${escapeHtml(whisky.tastingNote_ja || 'æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“ã€‚')}</p>
                <div class="grid grid-cols-3 gap-2 text-center text-xs">
                    <div>
                        <span class="block text-yellow-400">ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼</span>
                        <span class="block">${'â˜…'.repeat((whisky.taste_profile?.fruity || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.fruity || 0))}</span>
                    </div>
                    <div>
                        <span class="block text-yellow-400">ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼</span>
                        <span class="block">${'â˜…'.repeat((whisky.taste_profile?.smoky || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.smoky || 0))}</span>
                    </div>
                    <div>
                        <span class="block text-yellow-400">è¤‡é›‘ã•</span>
                        <span class="block">${'â˜…'.repeat((whisky.taste_profile?.complexity || 0))}${'â˜†'.repeat(5 - (whisky.taste_profile?.complexity || 0))}</span>
                    </div>
                </div>
            `;
            
            // ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¿½åŠ 
            whiskeyCard.addEventListener('click', () => selectWhisky(whisky, index));
            
            recommendationContent.appendChild(whiskeyCard);
        });
        
        // æœ€åˆã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã‚’é¸æŠçŠ¶æ…‹ã«
        if (whiskies.length > 0) {
            selectWhisky(whiskies[0], 0);
        }
        
        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        updateStatistics(whiskies.length);
    }
    
    // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼é¸æŠæ™‚ã®å‡¦ç†é–¢æ•°
    function selectWhisky(whisky, index) {
        // ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’è§£é™¤
        const cards = document.querySelectorAll('.whisky-card');
        cards.forEach(card => card.classList.remove('selected'));
        
        // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’å¼·èª¿è¡¨ç¤º
        if (cards[index]) {
            cards[index].classList.add('selected');
        }
        
        // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°
        updateTasteProfileChart(whisky);
        
        // è’¸æºœæ‰€æƒ…å ±ã®æ›´æ–°
        if (whisky.distillery_info) {
            updateDistilleryInfo(whisky.distillery_info);
        } else {
            // è’¸æºœæ‰€æƒ…å ±ãŒãªã„å ´åˆã€éŠ˜æŸ„åã‹ã‚‰æ¨æ¸¬
            const distilleryName = whisky.name.split(' ')[0];
            const distillery = distilleryDatabase[distilleryName];
            if (distillery) {
                updateDistilleryInfo(distillery);
            }
        }
    }
    
    // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®æ›´æ–°é–¢æ•°
    function updateTasteProfileChart(whisky) {
        // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚Œã°ç ´æ£„
        if (window.tasteProfileChart) {
            window.tasteProfileChart.destroy();
        }
        
        // å‘³è¦šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
        const tasteProfile = whisky.taste_profile || {};
        
        // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
        const data = {
            labels: ['ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼', 'ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼', 'ãƒœãƒ‡ã‚£', 'ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼', 'ç”˜ã•', 'è¤‡é›‘ã•'],
            datasets: [
                {
                    label: whisky.name,
                    data: [
                        tasteProfile.fruity || 0,
                        tasteProfile.spicy || 0,
                        tasteProfile.body || 0,
                        tasteProfile.smoky || 0,
                        tasteProfile.sweetness || 0,
                        tasteProfile.complexity || 0
                    ],
                    fill: true,
                    backgroundColor: 'rgba(255, 107, 107, 0.2)',
                    borderColor: 'rgb(255, 107, 107)',
                    pointBackgroundColor: 'rgb(255, 107, 107)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(255, 107, 107)'
                }
            ]
        };
        
        // ãƒãƒ£ãƒ¼ãƒˆè¨­å®š
        const config = {
            type: 'radar',
            data: data,
            options: {
                scales: {
                    r: {
                        angleLines: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        },
                        grid: {
                            color: 'rgba(255, 255, 255, 0.2)'
                        },
                        pointLabels: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            font: {
                                size: 12
                            }
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            backdropColor: 'transparent',
                            z: 100,
                            font: {
                                size: 10
                            }
                        },
                        suggestedMin: 0,
                        suggestedMax: 5
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'rgba(255, 255, 255, 0.8)',
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        };
        
        // ãƒãƒ£ãƒ¼ãƒˆã®ä½œæˆ
        const ctx = document.getElementById('tasteProfileChart').getContext('2d');
        window.tasteProfileChart = new Chart(ctx, config);
    }
    
    // è’¸æºœæ‰€æƒ…å ±ã®æ›´æ–°é–¢æ•°
    function updateDistilleryInfo(distilleryInfo) {
        // è’¸æºœæ‰€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
        const distillerySection = document.getElementById('distillerySection');
        if (distillerySection) {
            distillerySection.classList.add('active');
        }
        
        // è’¸æºœæ‰€æƒ…å ±ã®æ›´æ–°
        const distilleryName = document.getElementById('distilleryName');
        const distilleryLocation = document.getElementById('distilleryLocation');
        const distilleryFounded = document.getElementById('distilleryFounded');
        const distilleryStatus = document.getElementById('distilleryStatus');
        const distilleryDescription = document.getElementById('distilleryDescription');
        
        if (distilleryName) distilleryName.textContent = distilleryInfo.name || 'N/A';
        if (distilleryLocation) distilleryLocation.textContent = distilleryInfo.location || 'N/A';
        if (distilleryFounded) distilleryFounded.textContent = distilleryInfo.founded || 'N/A';
        if (distilleryStatus) {
            distilleryStatus.textContent = distilleryInfo.status || 'N/A';
            distilleryStatus.className = getStatusClass(distilleryInfo.status);
        }
        if (distilleryDescription) distilleryDescription.textContent = distilleryInfo.description || 'è©³ç´°æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
        
        // ãƒãƒƒãƒ—ã®æ›´æ–°
        updateDistilleryMap(distilleryInfo);
    }
    
    // è’¸æºœæ‰€ã®ãƒãƒƒãƒ—æ›´æ–°é–¢æ•°
    function updateDistilleryMap(distilleryInfo) {
        // ãƒãƒƒãƒ—ã®åˆæœŸåŒ–
        if (!window.distilleryMap) {
            window.distilleryMap = L.map('distilleryMap').setView([57.5, -4.5], 6);
            
            // ã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿½åŠ 
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(window.distilleryMap);
        }
        
        // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ãŒã‚ã‚Œã°å‰Šé™¤
        if (window.distilleryMarker) {
            window.distilleryMap.removeLayer(window.distilleryMarker);
        }
        
        // ç·¯åº¦ãƒ»çµŒåº¦ãŒã‚ã‚Œã°ã€ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
        if (distilleryInfo.latitude && distilleryInfo.longitude) {
            const lat = distilleryInfo.latitude;
            const lng = distilleryInfo.longitude;
            
            // ãƒãƒƒãƒ—ã®ä¸­å¿ƒã‚’æ›´æ–°
            window.distilleryMap.setView([lat, lng], 10);
            
            // ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆã¨è¿½åŠ 
            const customIcon = L.divIcon({
                className: 'distillery-marker',
                html: `<div style="background-color: rgba(255,107,107,0.8); width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>`,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                popupAnchor: [0, -10]
            });
            
            window.distilleryMarker = L.marker([lat, lng], { icon: customIcon })
                .addTo(window.distilleryMap)
                .bindPopup(`<b>${distilleryInfo.name}</b><br>${distilleryInfo.location || ''}`)
                .openPopup();
        }
    }
    
    // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°é–¢æ•°
    function updateStatistics(whiskyCount) {
        // ã‚¦ã‚£ã‚¹ã‚­ãƒ¼æ•°ã®æ›´æ–°
        document.getElementById('whiskyCount').textContent = whiskyCount;
        document.getElementById('totalWhiskies').textContent = whiskyCount;
        
        // ä»–ã®çµ±è¨ˆæƒ…å ±ã‚‚å¿…è¦ã«å¿œã˜ã¦æ›´æ–°
        const regions = new Set();
        const distilleries = new Set();
        
        // ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰æƒ…å ±ã‚’å–å¾—
        const cards = document.querySelectorAll('.whisky-card');
        cards.forEach(card => {
            const regionText = card.querySelector('.text-gray-400').textContent;
            const region = regionText.split('|')[0].trim();
            regions.add(region);
            
            // è’¸æºœæ‰€æƒ…å ±ãŒã‚ã‚Œã°è¿½åŠ 
            const name = card.querySelector('.text-lg').textContent;
            distilleries.add(name.split(' ')[0]); // ç°¡æ˜“çš„ã«éŠ˜æŸ„ã®æœ€åˆã®å˜èªã‚’è’¸æºœæ‰€ã¨ã¿ãªã™
        });
        
        // çµ±è¨ˆè¡¨ç¤ºã®æ›´æ–°
        document.getElementById('uniqueRegions').textContent = regions.size;
        document.getElementById('distilleryCount').textContent = distilleries.size;
    }
    
    // ãƒãƒ£ãƒƒãƒˆã§ã®è³ªå•ã«å¯¾ã™ã‚‹AIå¿œç­”ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆæ”¹ä¿®ï¼‰
async function getAIResponse(message) {
    try {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’å–å¾—
        const userPreferences = {
            minPrice: parseFloat(document.getElementById("minPrice").value) * 1000,
            maxPrice: parseFloat(document.getElementById("maxPrice").value) * 1000,
            tasteX: x1,
            tasteY: y1,
            complexityX: x2,
            complexityY: y2,
            additionalPreferences: message
        };
        
        // APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚‚å«ã‚ã‚‹ï¼‰
        const response = await fetch('/.netlify/functions/claude-api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                ...userPreferences,
                chatHistory: chatHistory.slice(-10) // ç›´è¿‘10ä»¶ã®å±¥æ­´ã‚’é€ä¿¡
            })
        });
        
        if (!response.ok) throw new Error('APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        
        const data = await response.json();
        
        // APIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
        if (data.success && data.data && data.data.content) {
            return data.data.content[0].text;
        } else {
            throw new Error('APIã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™');
        }
    } catch (error) {
        console.error('AIå¿œç­”å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”
        return "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ç¾åœ¨AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒä½¿ãˆã¾ã›ã‚“ã€‚å¾Œã»ã©ãŠè©¦ã—ãã ã•ã„ã€‚";
    }
}

// ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‹ã‚‰AIææ¡ˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ï¼ˆæ–°è¦ï¼‰
async function updateRecommendationsFromChatAI(message) {
    try {
        showProgress();
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’å–å¾—ï¼ˆãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ å¥½ã¿ã¨ã—ã¦ï¼‰
        const userPreferences = {
            minPrice: parseFloat(document.getElementById("minPrice").value) * 1000,
            maxPrice: parseFloat(document.getElementById("maxPrice").value) * 1000,
            tasteX: x1,
            tasteY: y1,
            complexityX: x2,
            complexityY: y2,
            additionalPreferences: message,
            chatHistory: chatHistory.slice(-10) // ç›´è¿‘10ä»¶ã®å±¥æ­´ã‚’é€ä¿¡
        };
        
        // APIå‘¼ã³å‡ºã—ï¼ˆæ¨è–¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
        const response = await fetch('/.netlify/functions/claude-api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                ...userPreferences,
                requestType: "full_recommendation",
                outputFormat: "json"
            })
        });
        
        if (!response.ok) throw new Error('APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        
        const data = await response.json();
        
        // APIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†
        if (data.success && data.data && data.data.content) {
            const responseText = data.data.content[0].text;
            let jsonStartIndex = responseText.indexOf('{');
            let jsonEndIndex = responseText.lastIndexOf('}') + 1;
            
            if (jsonStartIndex >= 0 && jsonEndIndex > jsonStartIndex) {
                const jsonString = responseText.substring(jsonStartIndex, jsonEndIndex);
                try {
                    const apiResponse = JSON.parse(jsonString);
                    displayApiRecommendations(apiResponse);
                } catch (error) {
                    console.error('JSONè§£æã‚¨ãƒ©ãƒ¼:', error);
                    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    const matchingWhiskies = findMatchingWhiskies();
                    displayLocalRecommendations(matchingWhiskies);
                }
            } else {
                // JSONå½¢å¼ã§ãªã„å ´åˆ
                const matchingWhiskies = findMatchingWhiskies();
                displayLocalRecommendations(matchingWhiskies);
            }
        } else {
            throw new Error('APIã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™');
        }
    } catch (error) {
        console.error('æ¨è–¦æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        const matchingWhiskies = findMatchingWhiskies();
        displayLocalRecommendations(matchingWhiskies);
    } finally {
        hideProgress();
    }
}
    
    // ãƒãƒ£ãƒƒãƒˆã‹ã‚‰æ¨è–¦ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    async function updateRecommendationsFromChatAI(message) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’å–å¾—
        const userPreferences = {
            minPrice: parseFloat(document.getElementById("minPrice").value) * 1000,
            maxPrice: parseFloat(document.getElementById("maxPrice").value) * 1000,
            tasteX: x1,
            tasteY: y1,
            complexityX: x2,
            complexityY: y2,
            additionalPreferences: message // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ è¦æœ›ã¨ã—ã¦ä½¿ç”¨
        };
        
        try {
            // ãƒãƒ£ãƒƒãƒˆå®Œäº†å¾Œã€è‡ªå‹•çš„ã«æ¨è–¦ãƒªã‚¹ãƒˆã‚‚æ›´æ–°
            const response = await fetch('/.netlify/functions/claude-api', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    ...userPreferences,
                    requestType: "full_recommendation",
                    outputFormat: "json"
                })
            });
            
            if (!response.ok) return;
            
            const data = await response.json();
            
            if (data.success && data.data && data.data.content) {
                try {
                    // APIã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’JSONè§£æ
                    const responseText = data.data.content[0].text;
                    let jsonStartIndex = responseText.indexOf('{');
                    let jsonEndIndex = responseText.lastIndexOf('}') + 1;
                    
                    if (jsonStartIndex >= 0 && jsonEndIndex > jsonStartIndex) {
                        const jsonString = responseText.substring(jsonStartIndex, jsonEndIndex);
                        const apiResponse = JSON.parse(jsonString);
                        
                        // æ–°ã—ã„æ¨è–¦ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                        displayApiRecommendations(apiResponse);
                    }
                } catch (error) {
                    console.error('æ¨è–¦JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
        } catch (error) {
            console.error('æ¨è–¦æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }
    
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹é–¢æ•°ï¼ˆæ”¹ä¿®ï¼‰
function addMessageToHistory(role, message) {
    // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¿½åŠ 
    chatHistory.push({ role: role, content: message });
    
    // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ãŒ20ä»¶ã‚’è¶…ãˆãŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
    if (chatHistory.length > 20) {
        chatHistory.shift();
    }
    
    // UIã«è¡¨ç¤º
    const chatHistoryElement = document.getElementById("chatHistory");
    const messageElement = document.createElement('div');
    messageElement.className = `chat-message ${role}-message`;
    messageElement.textContent = message;
    chatHistoryElement.appendChild(messageElement);
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸‹ã«
    chatHistoryElement.scrollTop = chatHistoryElement.scrollHeight;
    
    // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’è¡¨ç¤ºçŠ¶æ…‹ã«
    chatHistoryElement.style.display = "block";
}
    
    // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateAIMessage(messageId, text) {
        const messageElement = document.getElementById(messageId);
        if (messageElement) {
            messageElement.innerHTML = escapeHtml(text);
        }
    }
    
    // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ï¼ˆæ”¹ä¿®ï¼‰
async function sendChatMessage() {
    const chatInput = document.getElementById("chatInput");
    const message = chatInput.value.trim();
    
    if (!message) return;
    
    // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
    chatInput.value = "";
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å±¥æ­´ã«è¿½åŠ 
    addMessageToHistory("user", message);
    
    // AIã®ã€Œè€ƒãˆä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    const aiThinkingMessage = document.createElement('div');
    aiThinkingMessage.className = 'chat-message ai-message thinking-animation';
    aiThinkingMessage.id = 'aiThinkingMessage';
    document.getElementById("chatHistory").appendChild(aiThinkingMessage);
    document.getElementById("chatHistory").scrollTop = document.getElementById("chatHistory").scrollHeight;
    
    try {
        // AIå¿œç­”ã‚’å–å¾—
        const response = await getAIResponse(message);
        
        // è€ƒãˆä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const thinkingMessage = document.getElementById('aiThinkingMessage');
        if (thinkingMessage) {
            thinkingMessage.remove();
        }
        
        // AIå¿œç­”ã‚’å±¥æ­´ã«è¿½åŠ 
        addMessageToHistory("assistant", response);
        
        // ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‹ã‚‰AIæ¨è–¦ã‚‚æ›´æ–°
        updateRecommendationsFromChatAI(message);
        
    } catch (error) {
        console.error('ãƒãƒ£ãƒƒãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
        // è€ƒãˆä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const thinkingMessage = document.getElementById('aiThinkingMessage');
        if (thinkingMessage) {
            thinkingMessage.remove();
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        addMessageToHistory("assistant", "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
    }
}
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¡¨ç¤ºé–¢æ•°
    function showProgress() {
        document.getElementById("progressContainer").style.display = "block";
        document.getElementById("getRecommendationBtn").disabled = true;
        
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        const progressFill = document.getElementById("progressFill");
        let width = 0;
        const interval = setInterval(() => {
            if (width >= 100) {
                clearInterval(interval);
            } else {
                width += 2;
                progressFill.style.width = width + "%";
                document.getElementById("progressPercentage").textContent = width + "%";
            }
        }, 100);
        
        window.progressInterval = interval;
    }
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®éè¡¨ç¤ºé–¢æ•°
    function hideProgress() {
        clearInterval(window.progressInterval);
        document.getElementById("progressFill").style.width = "100%";
        document.getElementById("progressPercentage").textContent = "100%";
        
        setTimeout(() => {
            document.getElementById("progressContainer").style.display = "none";
            document.getElementById("getRecommendationBtn").disabled = false;
        }, 500);
    }
    
    // HTMLç‰¹æ®Šæ–‡å­—ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
    function escapeHtml(text) {
        if (!text) return '';
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
    
    // è’¸æºœæ‰€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã‚¯ãƒ©ã‚¹å–å¾—é–¢æ•°
    function getStatusClass(status) {
        if (!status) return 'status-unknown';
        
        status = status.toLowerCase();
        if (status.includes('active') || status.includes('ç¨¼åƒä¸­')) {
            return 'status-active';
        } else if (status.includes('closed') || status.includes('é–‰é–')) {
            return 'status-closed';
        } else {
            return 'status-unknown';
        }
    }
    
    // éŸ³å£°å…¥åŠ›ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢æ•°
    function setupVoiceInput() {
        const voiceInputBtn = document.getElementById("voiceInputBtn");
        const chatInput = document.getElementById("chatInput");
        
        if (!voiceInputBtn || !chatInput) return;
        
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) return;
        
        const recognition = new SpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        
        let isRecording = false;
        
        voiceInputBtn.addEventListener("click", () => {
            if (isRecording) {
                recognition.stop();
                voiceInputBtn.classList.remove("recording");
                isRecording = false;
            } else {
                recognition.start();
                voiceInputBtn.classList.add("recording");
                isRecording = true;
            }
        });
        
        recognition.onresult = (event) => {
            const speechResult = event.results[0][0].transcript;
            chatInput.value = speechResult;
            
            // è‡ªå‹•é€ä¿¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¡ãƒ³ãƒˆè§£é™¤ï¼‰
            // sendChatMessage();
        };
        
        recognition.onend = () => {
            voiceInputBtn.classList.remove("recording");
            isRecording = false;
        };
        
        recognition.onerror = (event) => {
            console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
            voiceInputBtn.classList.remove("recording");
            isRecording = false;
            
            // é€šçŸ¥ã‚’è¡¨ç¤º
            showErrorNotification("éŸ³å£°èªè­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        };
    }
    
    // ã‚¨ãƒ©ãƒ¼é€šçŸ¥è¡¨ç¤ºé–¢æ•°
    function showErrorNotification(message) {
        // æ—¢å­˜ã®é€šçŸ¥ã‚’å‰Šé™¤
        const existingNotification = document.querySelector('.error-notification');
        if (existingNotification) {
            existingNotification.remove();
        }
        
        // æ–°ã—ã„é€šçŸ¥ã‚’ä½œæˆ
        const notification = document.createElement('div');
        notification.className = 'error-notification';
        notification.innerHTML = `
            <div class="notification-content">
                <span class="notification-icon">âš ï¸</span>
                <span class="notification-message">${message}</span>
                <button class="notification-close">&times;</button>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        const closeBtn = notification.querySelector('.notification-close');
        closeBtn.addEventListener('click', () => {
            notification.remove();
        });
        
        // 5ç§’å¾Œã«è‡ªå‹•çš„ã«æ¶ˆãˆã‚‹
        setTimeout(() => {
            if (document.body.contains(notification)) {
                notification.remove();
            }
        }, 5000);
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã®æ¤œç´¢é–¢æ•°ï¼ˆAPIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
    function findMatchingWhiskies() {
        const minPrice = parseFloat(document.getElementById("minPrice").value) * 1000;
        const maxPrice = parseFloat(document.getElementById("maxPrice").value) * 1000;
        
        // ä¾¡æ ¼ã‚’æ•°å€¤ã«å¤‰æ›
        const whiskiesWithNumericPrice = whiskyData.map(whisky => {
            const priceString = whisky.price || "Â¥0";
            const priceValue = parseFloat(priceString.replace(/[^\d]/g, ''));
            return { ...whisky, numericPrice: priceValue };
        });
        
        // ä¾¡æ ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        const priceFiltered = whiskiesWithNumericPrice.filter(whisky => {
            return whisky.numericPrice >= minPrice && whisky.numericPrice <= maxPrice;
        });
        
        // å‘³ã¨è¤‡é›‘ã•ã®ã‚¹ã‚³ã‚¢è¨ˆç®—
        const scored = priceFiltered.map(whisky => {
            const tasteProfile = whisky.taste_profile || {};
            
            // ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼(0) vs ã‚¹ãƒ¢ãƒ¼ã‚­ãƒ¼(1)ã®ã‚¹ã‚³ã‚¢ (yè»¸)
            const fruityVsSmoky = tasteProfile.smoky / 5 || 0.5;
            
            // ãƒ©ã‚¤ãƒˆ(0) vs ãƒ˜ãƒ“ãƒ¼(1)ã®ã‚¹ã‚³ã‚¢ (xè»¸)
            const lightVsHeavy = tasteProfile.body / 5 || 0.5;
            
            // è‹¥ã„(0) vs ç†Ÿæˆ(1)ã®ã‚¹ã‚³ã‚¢ (xè»¸)
            const youngVsMature = tasteProfile.complexity / 5 || 0.5;
            
            // ã¾ã‚ã‚„ã‹(0) vs å¼·çƒˆ(1)ã®ã‚¹ã‚³ã‚¢ (yè»¸)
            const smoothVsIntense = (tasteProfile.spicy || 0) / 5;
            
            // å‘³è¦šã‚¹ã‚³ã‚¢ã®è¨ˆç®—
            const tasteDistance = Math.sqrt(
                Math.pow(x1 - lightVsHeavy, 2) + 
                Math.pow(y1 - fruityVsSmoky, 2)
            );
            
            // è¤‡é›‘ã•ã‚¹ã‚³ã‚¢ã®è¨ˆç®—
            const complexityDistance = Math.sqrt(
                Math.pow(x2 - youngVsMature, 2) + 
                Math.pow(y2 - smoothVsIntense, 2)
            );
            
            // ç·åˆã‚¹ã‚³ã‚¢ï¼ˆå€¤ãŒå°ã•ã„ã»ã©å¥½ã¿ã«è¿‘ã„ï¼‰
            const totalScore = tasteDistance + complexityDistance;
            
            return { ...whisky, score: totalScore };
        });
        
        // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
        const sorted = scored.sort((a, b) => a.score - b.score);
        
        // ä¸Šä½3ä»¶ã‚’è¿”ã™
        return sorted.slice(0, 3);
    }
    
    // Googleã®ç¿»è¨³ã‚’é–‹ãé–¢æ•°
    function openGoogleTranslate() {
        const currentUrl = window.location.href;
        const translateUrl = `https://translate.google.com/translate?sl=auto&tl=en&u=${encodeURIComponent(currentUrl)}`;
        window.open(translateUrl, '_blank');
    }

</script>
<script>
// ã€Œåˆ¥ã®ææ¡ˆã‚’å—ã‘ã‚‹ã€ãƒœã‚¿ãƒ³æ©Ÿèƒ½ã®ä¿®æ­£ãƒ‘ãƒƒãƒ - æ­£ç¢ºãªIDã‚’ä½¿ç”¨
(function() {
  // DOMãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
  function initializeCustomButton() {
    // æ­£ç¢ºãªIDã§ãƒœã‚¿ãƒ³ã‚’å–å¾—
    const refreshButton = document.getElementById('getAnotherRecommendation');
    
    if (refreshButton) {
      console.log('ã€Œåˆ¥ã®ææ¡ˆã‚’å—ã‘ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æ­£ç¢ºãªIDã§ç™ºè¦‹ã—ã¾ã—ãŸ');
      
      // æ—¢å­˜ã®ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã¦ã‚¯ãƒ­ãƒ¼ãƒ³
      const newButton = refreshButton.cloneNode(true);
      refreshButton.parentNode.replaceChild(newButton, refreshButton);
      
      // æ–°ã—ã„ãƒœã‚¿ãƒ³ã«åŒã˜IDã‚’è¨­å®šï¼ˆé‡è¦ï¼‰
      newButton.id = 'getAnotherRecommendation';
      
      // å®Œå…¨ã«æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      newButton.addEventListener('click', function(e) {
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã¨ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
        if (e) {
          e.preventDefault();
          e.stopPropagation();
        }
        
        console.log('å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã®ã€Œåˆ¥ã®ææ¡ˆã‚’å—ã‘ã‚‹ã€å‡¦ç†ã‚’å®Ÿè¡Œ');
        
        // ç¾åœ¨ã®ä¾¡æ ¼è¨­å®šã‚’å–å¾—
        const minPrice = parseInt(document.getElementById('minPrice').value) * 1000;
        const maxPrice = parseInt(document.getElementById('maxPrice').value) * 1000;
        
        // ä¾¡æ ¼ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const priceFiltered = whiskyData.filter(whisky => {
          try {
            const numericPrice = parseInt(whisky.price.replace(/[^\d]/g, '')) || 0;
            return numericPrice >= minPrice && numericPrice <= maxPrice;
          } catch (err) {
            return false;
          }
        });
        
        if (priceFiltered.length < 3) {
          alert('æ¡ä»¶ã«åˆã†ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ãŒè¶³ã‚Šã¾ã›ã‚“ã€‚ä¾¡æ ¼ç¯„å›²ã‚’åºƒã’ã¦ãã ã•ã„ã€‚');
          return false;
        }
        
        // ç¾åœ¨è¡¨ç¤ºä¸­ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼åã‚’å–å¾—ã—ã¦é™¤å¤–
        const currentlyShown = [];
        document.querySelectorAll('.whisky-card h3').forEach(h3 => {
          if (h3.textContent) currentlyShown.push(h3.textContent.trim());
        });
        
        // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const notCurrentlyShown = priceFiltered.filter(w => 
          !currentlyShown.includes(w.name)
        );
        
        // å€™è£œãŒååˆ†ã«ã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        const sourceArray = notCurrentlyShown.length >= 3 ? notCurrentlyShown : priceFiltered;
        
        // å®Œå…¨ã«ãƒ©ãƒ³ãƒ€ãƒ åŒ–ã—ã¦é¸æŠ
        const randomWhiskies = [];
        const shuffled = [...sourceArray].sort(() => 0.5 - Math.random());
        
        // æœ€å¤§3ã¤é¸æŠ
        for (let i = 0; i < Math.min(3, shuffled.length); i++) {
          randomWhiskies.push(shuffled[i]);
        }
        
        console.log('ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã—ãŸã‚¦ã‚£ã‚¹ã‚­ãƒ¼:', randomWhiskies.map(w => w.name));
        
        // è¡¨ç¤ºé–¢æ•°ã‚’å‘¼ã³å‡ºã—
        if (typeof displayLocalRecommendations === 'function') {
          try {
            displayLocalRecommendations(randomWhiskies);
            if (randomWhiskies.length > 0 && typeof selectWhisky === 'function') {
              selectWhisky(randomWhiskies[0]);
            }
          } catch (error) {
            console.error('è¡¨ç¤ºå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
          }
        } else {
          console.error('displayLocalRecommendationsé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        }
        
        return false;
      });
      
      console.log('ã€Œåˆ¥ã®ææ¡ˆã‚’å—ã‘ã‚‹ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†ã‚’å®Œå…¨ã«ä¸Šæ›¸ãã—ã¾ã—ãŸ');
    } else {
      console.error('IDã€ŒgetAnotherRecommendationã€ã®ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
  }

  // æ—¢å­˜ã®å‡¦ç†ãŒå®Œäº†ã—ãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’èª¿æ•´
  if (document.readyState === 'complete') {
    // ãƒšãƒ¼ã‚¸ãŒæ—¢ã«å®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆ
    setTimeout(initializeCustomButton, 1500);
  } else {
    // ã¾ã ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ä¸­ã®å ´åˆã¯loadã‚¤ãƒ™ãƒ³ãƒˆã‚’å¾…ã¤
    window.addEventListener('load', function() {
      setTimeout(initializeCustomButton, 1500);
    });
  }
})();
</script>
<script>
// AIãƒãƒ£ãƒƒãƒˆã‹ã‚‰ã®éŠ˜æŸ„æŠ½å‡ºã¨æ¨å¥¨ãƒªã‚¹ãƒˆã®é€£æºã‚’æ”¹å–„ï¼ˆé¡ä¼¼åº¦ãƒãƒƒãƒãƒ³ã‚°ç‰ˆï¼‰
(function() {
  // AIã®å¿œç­”ã‚’å‡¦ç†ã™ã‚‹é–¢æ•°ã‚’æ”¹å–„ã™ã‚‹
  function enhanceAIResponseProcessing() {
    // å…ƒã®getAIResponseé–¢æ•°ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    const originalGetAIResponse = window.getAIResponse;
    
    // ã‚‚ã—å…ƒã®é–¢æ•°ãŒå­˜åœ¨ã—ãªã‘ã‚Œã°çµ‚äº†
    if (typeof originalGetAIResponse !== 'function') {
      console.error('å…ƒã®getAIResponseé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    
    // æ‹¡å¼µç‰ˆã®getAIResponseé–¢æ•°
    window.getAIResponse = async function(message) {
      // ã¾ãšéŠ˜æŸ„åã‚’æ¢ç´¢
      const mentionedWhiskies = findWhiskiesInText(message);
      console.log('ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰æŠ½å‡ºã—ãŸéŠ˜æŸ„:', mentionedWhiskies);
      
      // å…ƒã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦å¿œç­”ã‚’å–å¾—
      const result = await originalGetAIResponse.apply(this, arguments);
      
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã§è¨€åŠã•ã‚ŒãŸéŠ˜æŸ„ã‚’è¡¨ç¤ºãƒªã‚¹ãƒˆã«å«ã‚ã‚‹
      if (mentionedWhiskies.length > 0) {
        setTimeout(() => {
          updateRecommendationsWithMentioned(mentionedWhiskies);
        }, 1000); // AIã®å¿œç­”ãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œ
      }
      
      return result;
    };
    
    console.log('getAIResponseé–¢æ•°ã‚’æ‹¡å¼µã—ã¾ã—ãŸ - ãƒãƒ£ãƒƒãƒˆå†…ã®éŠ˜æŸ„åæŠ½å‡ºã¨è¡¨ç¤ºã‚’é€£æº');
  }
  
  // ãƒ†ã‚­ã‚¹ãƒˆå†…ã§è¨€åŠã•ã‚Œã¦ã„ã‚‹éŠ˜æŸ„ã‚’æ¤œå‡ºã™ã‚‹é–¢æ•°ï¼ˆé¡ä¼¼åº¦ã‚’ä½¿ç”¨ï¼‰
  function findWhiskiesInText(text) {
    if (!text || typeof text !== 'string') return [];
    if (!window.whiskyData || !Array.isArray(window.whiskyData)) return [];
    
    // çµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—
    const result = [];
    
    // ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰å‡¦ç†ï¼ˆå°æ–‡å­—åŒ–ã€ç©ºç™½ã®æ­£è¦åŒ–ï¼‰
    const normalizedText = text.toLowerCase().replace(/\s+/g, ' ');
    
    // ç‰¹å¾´çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¸»è¦éŠ˜æŸ„åï¼‰
    const commonWhiskyNames = [
      'å±±å´', 'ç™½å·', 'éŸ¿', 'è»½äº•æ²¢', 'é•·æ¿±', 'ã‚¿ãƒªã‚¹ã‚«ãƒ¼', 'ãƒãƒƒã‚«ãƒ©ãƒ³', 'ã‚¢ãƒ¼ãƒ‰ãƒ™ãƒƒã‚°', 
      'ãƒãƒ¼ãƒˆã‚¨ãƒ¬ãƒ³', 'NAGAHAMA', 'DAILUAINE', 'ã‚­ãƒ«ãƒ›ãƒ¼ãƒãƒ³', 'GLENLIVET', 'ABERFELDY', 
      'SPRINGBANK', 'MORTLACH', 'CAOL ILA', 'KILCHOMAN', 'ç§©çˆ¶'
    ];
    
    // ç›´æ¥çš„ãªéŠ˜æŸ„åã®æ¤œç´¢ï¼ˆå®Œå…¨ä¸€è‡´ã¾ãŸã¯ä¸»è¦éƒ¨åˆ†ãŒä¸€è‡´ï¼‰
    const matches = [];
    window.whiskyData.forEach(whisky => {
      // éŠ˜æŸ„åã‚’æ­£è¦åŒ–
      const whiskyName = whisky.name.toLowerCase();
      
      // å®Œå…¨ä¸€è‡´ã¾ãŸã¯éƒ¨åˆ†ä¸€è‡´
      if (normalizedText.includes(whiskyName) || 
          whiskyName.includes(normalizedText) || 
          textSimilarity(normalizedText, whiskyName) > 0.7) {
        matches.push({
          whisky: whisky,
          score: 1.0,
          matchType: 'direct'
        });
        return;
      }
      
      // ä¸»è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯
      for (const keyword of commonWhiskyNames) {
        const normalizedKeyword = keyword.toLowerCase();
        if ((whiskyName.includes(normalizedKeyword) || 
             normalizedKeyword.includes(whiskyName)) && 
            normalizedText.includes(normalizedKeyword)) {
          matches.push({
            whisky: whisky,
            score: 0.9,
            matchType: 'keyword'
          });
          return;
        }
      }
      
      // ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®éƒ¨åˆ†ä¸€è‡´ãƒã‚§ãƒƒã‚¯
      const whiskyTokens = whiskyName.split(/[\s\d]+/);
      const textTokens = normalizedText.split(/[\s\d]+/);
      
      for (const whiskyToken of whiskyTokens) {
        if (whiskyToken.length < 2) continue; // çŸ­ã™ãã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ç„¡è¦–
        
        for (const textToken of textTokens) {
          if (textToken.length < 2) continue; // çŸ­ã™ãã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã¯ç„¡è¦–
          
          if (whiskyToken === textToken || 
              whiskyToken.includes(textToken) || 
              textToken.includes(whiskyToken)) {
            matches.push({
              whisky: whisky,
              score: 0.8,
              matchType: 'token',
              token: whiskyToken
            });
            return;
          }
        }
      }
    });
    
    // ã‚¹ã‚³ã‚¢ã§ã‚½ãƒ¼ãƒˆ
    matches.sort((a, b) => b.score - a.score);
    
    // çµæœã®æŠ½å‡º
    return matches.map(match => match.whisky);
  }
  
  // ãƒ†ã‚­ã‚¹ãƒˆã®é¡ä¼¼åº¦ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
  function textSimilarity(text1, text2) {
    // ç°¡æ˜“çš„ãªé¡ä¼¼åº¦è¨ˆç®—ï¼ˆLevenshteinè·é›¢ã®æ­£è¦åŒ–ç‰ˆï¼‰
    function levenshteinDistance(a, b) {
      const matrix = [];
      
      // åˆæœŸåŒ–
      for (let i = 0; i <= b.length; i++) {
        matrix[i] = [i];
      }
      for (let j = 0; j <= a.length; j++) {
        matrix[0][j] = j;
      }
      
      // è¨ˆç®—
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b.charAt(i-1) === a.charAt(j-1)) {
            matrix[i][j] = matrix[i-1][j-1];
          } else {
            matrix[i][j] = Math.min(
              matrix[i-1][j-1] + 1, // ç½®æ›
              Math.min(
                matrix[i][j-1] + 1, // æŒ¿å…¥
                matrix[i-1][j] + 1  // å‰Šé™¤
              )
            );
          }
        }
      }
      
      return matrix[b.length][a.length];
    }
    
    // æœ€å¤§ã®é•·ã•
    const maxLength = Math.max(text1.length, text2.length);
    if (maxLength === 0) return 1.0; // ä¸¡æ–¹ãŒç©ºæ–‡å­—åˆ—
    
    // è·é›¢ã‚’è¨ˆç®—
    const distance = levenshteinDistance(text1, text2);
    
    // æ­£è¦åŒ–ï¼ˆ0-1ã®ç¯„å›²ã«ï¼‰
    return 1.0 - (distance / maxLength);
  }
  
  // AIã®å¿œç­”ã‹ã‚‰éŠ˜æŸ„åã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
  function extractWhiskyNamesFromAIResponse(response) {
    if (!response || typeof response !== 'string') return [];
    if (!window.whiskyData || !Array.isArray(window.whiskyData)) return [];
    
    // çµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—
    const result = [];
    
    // ã€Œã€ã‚„ã€ã€ã§å›²ã¾ã‚ŒãŸéƒ¨åˆ†ã‚’æŠ½å‡º
    const quotedMatches = response.match(/[ã€Œã€]([^ã€ã€]+)[ã€ã€]/g) || [];
    for (const match of quotedMatches) {
      const extractedName = match.replace(/[ã€Œã€ã€ã€]/g, '');
      // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã§é¡ä¼¼ã™ã‚‹éŠ˜æŸ„ã‚’æ¤œç´¢
      const similarWhisky = findSimilarWhisky(extractedName);
      if (similarWhisky && !result.includes(similarWhisky)) {
        result.push(similarWhisky);
      }
    }
    
    // å¹´æ•°ã‚’å«ã‚€ç‰¹å¾´çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡ºï¼ˆä¾‹ï¼šã‚¿ãƒªã‚¹ã‚«ãƒ¼44å¹´ï¼‰
    const ageMatches = response.match(/(\S+\s?\d+å¹´[^\sã€ã€‚,.]+)/g) || [];
    for (const match of ageMatches) {
      const similarWhisky = findSimilarWhisky(match);
      if (similarWhisky && !result.includes(similarWhisky)) {
        result.push(similarWhisky);
      }
    }
    
    return result;
  }
  
  // ãƒ†ã‚­ã‚¹ãƒˆã«æœ€ã‚‚é¡ä¼¼ã—ãŸéŠ˜æŸ„ã‚’è¦‹ã¤ã‘ã‚‹é–¢æ•°
  function findSimilarWhisky(text) {
    if (!text || !window.whiskyData) return null;
    
    let bestMatch = null;
    let highestScore = 0;
    
    for (const whisky of window.whiskyData) {
      const similarityScore = textSimilarity(
        text.toLowerCase(), 
        whisky.name.toLowerCase()
      );
      
      if (similarityScore > highestScore && similarityScore > 0.6) {
        highestScore = similarityScore;
        bestMatch = whisky;
      }
    }
    
    return bestMatch;
  }
  
  // è¨€åŠã•ã‚ŒãŸéŠ˜æŸ„ã‚’æ¨å¥¨ãƒªã‚¹ãƒˆã«å«ã‚ã‚‹
  function updateRecommendationsWithMentioned(mentionedWhiskies) {
    if (!mentionedWhiskies || mentionedWhiskies.length === 0) return;
    
    console.log('éŠ˜æŸ„æ¨å¥¨ãƒªã‚¹ãƒˆã«å«ã‚ã‚‹:', mentionedWhiskies.map(w => w.name));
    
    // ç¾åœ¨ã®ä¾¡æ ¼è¨­å®šã‚’å–å¾—
    const minPrice = parseInt(document.getElementById('minPrice').value) * 1000 || 0;
    const maxPrice = parseInt(document.getElementById('maxPrice').value) * 1000 || 100000;
    
    // ä¾¡æ ¼ç¯„å›²å†…ã®è¨€åŠéŠ˜æŸ„ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    const filteredWhiskies = mentionedWhiskies.filter(whisky => {
      try {
        const numericPrice = parseInt(whisky.price.replace(/[^\d]/g, '')) || 0;
        return numericPrice >= minPrice && numericPrice <= maxPrice;
      } catch (err) {
        return true; // ä¾¡æ ¼è§£æã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯å«ã‚ã‚‹
      }
    });
    
    if (filteredWhiskies.length === 0) {
      console.log('è¨€åŠã•ã‚ŒãŸéŠ˜æŸ„ãŒä¾¡æ ¼ç¯„å›²å¤–ã§ã™');
      return;
    }
    
    // è¶³ã‚Šãªã„å ´åˆã¯ãƒ©ãƒ³ãƒ€ãƒ ã«è¿½åŠ 
    const finalSelection = [...filteredWhiskies];
    if (finalSelection.length < 3) {
      // ç¾åœ¨ã®ã‚¦ã‚£ã‚¹ã‚­ãƒ¼ã¨è¨€åŠã•ã‚ŒãŸã‚‚ã®ã‚’é™¤å¤–ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
      const currentNames = finalSelection.map(w => w.name);
      const additionalCandidates = window.whiskyData.filter(w => {
        try {
          const numericPrice = parseInt(w.price.replace(/[^\d]/g, '')) || 0;
          return numericPrice >= minPrice && numericPrice <= maxPrice && !currentNames.includes(w.name);
        } catch (err) {
          return false;
        }
      });
      
      // ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã¹æ›¿ãˆã¦å¿…è¦ãªæ•°ã ã‘è¿½åŠ 
      const shuffled = additionalCandidates.sort(() => 0.5 - Math.random());
      while (finalSelection.length < 3 && shuffled.length > 0) {
        finalSelection.push(shuffled.pop());
      }
    }
    
    // æœ€çµ‚çš„ãªé¸æŠçµæœãŒå¾—ã‚‰ã‚ŒãŸå ´åˆã€è¡¨ç¤ºã‚’æ›´æ–°
    if (finalSelection.length > 0) {
      console.log('æœ€çµ‚çš„ã«é¸æŠã•ã‚ŒãŸéŠ˜æŸ„:', finalSelection.map(w => w.name));
      
      try {
        // æ¨å¥¨ãƒ‘ãƒãƒ«ã‚’è¡¨ç¤º
        document.getElementById('splitLayoutContainer').style.display = 'grid';
        
        // éŠ˜æŸ„ã‚’è¡¨ç¤º
        if (typeof displayLocalRecommendations === 'function') {
          displayLocalRecommendations(finalSelection);
          
          // æœ€åˆã®éŠ˜æŸ„ã‚’é¸æŠï¼ˆè¨€åŠã•ã‚ŒãŸéŠ˜æŸ„ã‚’å„ªå…ˆï¼‰
          if (filteredWhiskies.length > 0 && typeof selectWhisky === 'function') {
            selectWhisky(filteredWhiskies[0]);
          } else if (finalSelection.length > 0 && typeof selectWhisky === 'function') {
            selectWhisky(finalSelection[0]);
          }
        }
      } catch (err) {
        console.error('è¡¨ç¤ºæ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼:', err);
      }
    }
  }
  
  // å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®èª¿æ•´
  if (document.readyState === 'complete') {
    setTimeout(enhanceAIResponseProcessing, 2000);
  } else {
    window.addEventListener('load', function() {
      setTimeout(enhanceAIResponseProcessing, 2000);
    });
  }
})();
</script>


    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDq9sMzTBnkK7N3vAQixbZKInGo3%2FDuBA6s%2F4VsjkLQIldQG1vBDFOom35B3TYhS0C5loF0WIDf5yE%2FG0eL9qcC2PHM%2FfezhPsC8fofhN40jlExJ4Z2GrQNhHhSoa3luU4%2B0Sapq4VdJCyDpWhuLcSfgUGnT4f2WU37rDhgQFXxI2c%2BiEGpY7DMnGKNiptaLE9nF%2BYMDq7mzCYwQVUHEYGSiRB8xTGxpQV49PdUwIeNLp7WlAkvXWOi1eVTnGF7FqxOP%2Fhc2Wel1QtoQ08mJNhlTFLw%2F66U%2FBoCwUnkc4BJONTAnlqJyoHGYYwfAZXH6DfcXlQqu805Zulsk8hrnasqAF172mArQLBFkPWCW5mpdZrPJMSVbIvTbRYimqBuvdaT02pMiNWDG4uiDaUgDMR0rhm2%2Bu5cehH427wZ75S6ebV0t3T6Dl7JtDzvcjVPiLrSk%2F1wH1q4ZTwkNlRY8dqxyz7gY5bliH4OYy0wSaqHyncNa3jAHYAsiE0nsbiNUB0g%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDq9sMzTBnkK7N3vAQixbZKInGo3/DuBA6s/4VsjkLQIldQG1vBDFOom35B3TYhS0C5loF0WIDf5yE/G0eL9qcC2PHM/fezhPsC8fofhN40jlExJ4Z2GrQNhHhSoa3luU4+0Sapq4VdJCyDpWhuLcSfgUGnT4f2WU37rDhgQFXxI2c+iEGpY7DMnGKNiptaLE9nF+YMDq7mzCYwQVUHEYGSiRB8xTGxpQV49PdUwIeNLp7WlAkvXWOi1eVTnGF7FqxOP/hc2Wel1QtoQ08mJNhlTFLw/66U/BoCwUnkc4BJONTAnlqJyoHGYYwfAZXH6DfcXlQqu805Zulsk8hrnasqAF172mArQLBFkPWCW5mpdZrPJMSVbIvTbRYimqBuvdaT02pMiNWDG4uiDaUgDMR0rhm2+u5cehH427wZ75S6ebV0t3T6Dl7JtDzvcjVPiLrSk/1wH1q4ZTwkNlRY8dqxyz7gY5bliH4OYy0wSaqHyncNa3jAHYAsiE0nsbiNUB0g==";
    </script>
    
    <script id="html_notice_dialog_script" src="./index_files/notice_dialog.js.ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"></script>
        <!-- ãƒšãƒ¼ã‚¸æœ«å°¾ã«è¿½åŠ  -->
        <script type="text/javascript">
        function openGoogleTranslate() {
            const currentUrl = window.location.href;
            const translateUrl = `https://translate.google.com/translate?sl=auto&u=${encodeURIComponent(currentUrl)}`;
            window.open(translateUrl, '_blank');
        }
        </script>
        <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    </body></html>